<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div>
                <h1>
                    Block Contract
                </h1>
                <p>
                    This is a hackathon project for "The Building Blocks Hackathon at Consensus 2019" (
                    <a href="https://consensus2019-blockchain.devpost.com" rel="nofollow">
                        https://consensus2019-blockchain.devpost.com
                    </a>
                    ).
                </p>
                <p>
                    Block contract is to build decentralized contract that people can sign, view and trust. To protect the privacy, the content of the contract will
                    <em>
                        NOT
                    </em>
                    be hosted in the blockchain,
                    <em>
                        only the hash
                    </em>
                    of the content is store in the chain.
                </p>
                <p>
                    We use
                    <a href="#about-forge-react-starter" rel="nofollow">
                        ArcBlock's Forge React Stater
                    </a>
                    to build this application and let it handle the basic logic like DID login, so that we can focus on building the core logic.
                </p>
                <h2>
                    High level design
                </h2>
                <p>
                    The prototype of the flow of the app looks like this:
                </p>
                <p>
                    <img alt="prototype" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/prototype.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--X0XfC4AI--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/prototype.jpg">
                </p>
                <h2>
                    Contract Templates
                </h2>
                <p>
                    <a href="https://www.accordproject.org" rel="nofollow">
                        Accord Project
                    </a>
                    is a great open source tool to generate legal contracts.  The ultimate goal is integrate this project with Accord
                    <a href="https://studio.accordproject.org" rel="nofollow">
                        Legal Contract Template Studio
                    </a>
                    .
                </p>
                <h2>
                    Blockchain
                </h2>
                <p>
                    We will use ArcBlock's ForgeFrame to build a custom blockchain for this project's demo.  The block explorer lives here:
                    <a href="https://contract.abtnetwork.io/dashboard" rel="nofollow">
                        Block Contract Block Explorer
                    </a>
                </p>
                <p>
                    It's possible to use other blockchains, such as Ethereum, Bitcoin to record the contract through Open Chain Access Protocol (OCAP), but it will be limited in features.
                </p>
                <h2>
                    DB schema for contract
                </h2>
                <p>
                    For contract created by the user, we store it as the following schema in mongo:
                </p>
                <pre class="language-javascript"><code>const ContractSchema = new mongoose.Schema({
        // the did is calculated by sha3(concat(content, hash, signatures list without each sig))
  _id: { type: String, required: true, trim: true },
  requester: {type: String, required: true, trim: true},
  synopsis: { type: String, required: true, trim: true },
  content: { type: Buffer, required: true },
  hash: { type: String, required: true },
  signatures: [{
  name: { type: String, required: true, trim: true },
  email: { type: String, required: true, trim: true },
  signedAt: { type: Date },
  signature: { type: Buffer }
  }],
  finished: { type: Boolean, default: false},
  address: { type: String, default: '' },
  createdAt: { type: Date },
  updatedAt: { type: Date },
});
</code></pre>
                <h2>
                    Asset Schema for CreateAssetTx protocol
                </h2>
                <p>
                    Once a doc is finished signing, we will send a CreateAssetTx to Forge, with its data like this:
                </p>
                <pre class="language-proto"><code>message Signature {
        string name = 1;
  string email = 2;
  string signer = 3;
  google.protobuf.Timestamp signed_at = 4;
  bytes signature = 5;
}
message Contract {
// did of the contract that stored in the Block Contract app
string did = 1;
// hash of the original contract to be signed
string hash = 2;
// collected signature list
repeated Signature signatures = 3;
}
</code></pre>
                <h2>
                    Run this project from Repo
                </h2>
                <h3>
                    Install latest nodejs and mongodb
                </h3>
                <pre class="language-bash"><code>brew upgrade node
brew install mongodb
brew services start mongodb
</code></pre>
                <h3>
                    Install latest forge-cli and init forge
                </h3>
                <pre class="language-bash"><code>npm install -g @arcblock/forge-cli
forge init
forge join https://contract.abtnetwork.io/api
forge start
forge web start
</code></pre>
                <h3>
                    Start the Block Contract app
                </h3>
                <pre class="language-bash"><code>cd block-contract
make dep
</code></pre>
                <p>
                    Before running the app, you need to put a
                    <code>
                        .env
                    </code>
                    file into your repo:
                </p>
                <pre class="language-bash"><code>cat &gt; .env
MONGO_URI="mongodb://127.0.0.1:27017/block-contract"
COOKIE_SECRET="0x6721a1883a8a9c08ea431a6528faf4c1a220194e8a3c0bed6159fd9737b4b7db"
CHAIN_ID="contract-2019-05-12"
CHAIN_HOST="https://contract.abtnetwork.io/api"
APP_NAME="Block Contract"
APP_PORT="3030"
APP_SK="0x93d1b3a3a75fd5d0a989bf91958442e15896e0c1cfa6a0d542a47861fdc8559e6721a1883a8a9c08ea431a6528faf4c1a220194e8a3c0bed6159fd9737b4b7db"
APP_ID="zNKgNRoV2s12JBsEB9dCc6RiqGYt5JHKRxqv"
EMAIL_USER="&lt;your gmail address&gt;"
EMAIL_PASS="&lt;your gmail password&gt;"
BASE_URL="http://&lt;your-private-ip&gt;:3030"
</code></pre>
                <p>
                    Note that you need to put your gmail user/pass and tune the BASE_URL here.
                </p>
                <p>
                    Make sure that you have your cellphone installed
                    <a href="https://abtwallet.io/en/" rel="nofollow">
                        ABT Wallet
                    </a>
                    and it is under the same WIFI as your laptop running the app. Then:
                </p>
                <pre class="language-bash"><code>make run
</code></pre>
                <h2>
                    Screen Shots
                </h2>
                <p>
                    Pages are being added so screen shots will be gradually available:
                </p>
                <h3>
                    The new frontpage
                </h3>
                <p>
                    <img alt="Block contract" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/block_contract.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--6qUcJnkO--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/block_contract.jpg">
                </p>
                <h3>
                    Step 1: Scan QR code to login (provided by Forge React Starter kit)
                </h3>
                <p>
                    <img alt="login 1" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/login1.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--egAucLNG--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/login1.jpg">
                </p>
                <p>
                    After you scanned the QR code with ABT wallet:
                </p>
                <p>
                    <img alt="login 2" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/login2.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--Nvn5svlD--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/login2.jpg">
                </p>
                <p>
                    Then you are redirect to profile page. User can see the existing contracts:
                </p>
                <p>
                    <img alt="List contracts" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/list_contracts.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--4OmRFAva--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/list_contracts.jpg">
                </p>
                <h3>
                    Step 2: Create a new contract
                </h3>
                <p>
                    You may want to create a new contract:
                </p>
                <p>
                    <img alt="Create contract" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/create_contract.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--jts4X8dg--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/create_contract.jpg">
                </p>
                <p>
                    And all the signers will go emails like this:
                </p>
                <p>
                    <img alt="Email content" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/email.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--8Vxhbbnj--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/email.jpg">
                </p>
                <h3>
                    Step 3 (for signer): Sign the contract
                </h3>
                <p>
                    As a signer, when you got the email, if you click the "View the Contract" button or the link, you will get:
                </p>
                <p>
                    <img alt="Sign 1" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/sign1.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--7s2898Bh--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/sign1.jpg">
                </p>
                <p>
                    Then scan the QR code with the wallet app:
                </p>
                <p>
                    <img alt="Sign 2" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/sign2.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--uyn7o4Uw--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/sign2.jpg">
                </p>
                <p>
                    Once accepted, you signature will be put into the agreement. If all parties finished signing, the doc is signed:
                </p>
                <p>
                    <img alt="Signed 1" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/signed1.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--U91OJHic--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/signed1.jpg">
                </p>
                <h3>
                    Step 4 (anyone): Verify the contract in the chain
                </h3>
                <p>
                    Then anyone can check the signatures on the chain:
                </p>
                <p>
                    <img alt="Signed 2" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/signed2.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--DmvnMlcy--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/signed2.jpg">
                </p>
                <p>
                    We could make this view much better later on.
                </p>
                <hr>
                <p>
                    Below is created by forge-react-starter. Leave it just for your information.
                </p>
                <h2>
                    About Forge React Starter
                </h2>
                <p>
                    This project is generated by ArcBlock's Forge React Starter:
                </p>
                <blockquote>
                    <p>
                        Brings tons of thousands react libraries/components to dApps that run on
                        <a href="https://www.arcblock.io/en/forge-sdk" rel="nofollow">
                            forge
                        </a>
                        powered blockchain.
                    </p>
                </blockquote>
                <p>
                    <img alt="" data-canonical-url="https://github.com/mave99a/blockcontract/raw/master/docs/starter-home.png" src="https://res.cloudinary.com/devpost/image/fetch/s--fp89RHUE--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/mave99a/blockcontract/raw/master/docs/starter-home.png">
                </p>
                <p>
                    A starter project that integrates
                    <a href="https://docs.arcblock.io/forge/latest/" rel="nofollow">
                        forge
                    </a>
                    <a href="https://docs.arcblock.io/forge/latest/sdk/javascript.html" rel="nofollow">
                        javascript sdk
                    </a>
                    with mainstream javascript application batteries:
                </p>
                <ul>
                    <li>
                        <a href="https://reactjs.org/" rel="nofollow">
                            React.js
                        </a>
                        the framework for view layer
                    </li>
                    <li>
                        <a href="https://nextjs.org/" rel="nofollow">
                            Next.js
                        </a>
                        for crafting pages and SSR
                    </li>
                    <li>
                        <a href="https://material-ui.com/" rel="nofollow">
                            Material-UI
                        </a>
                        for resuable react components
                    </li>
                    <li>
                        <a href="http://expressjs.com/" rel="nofollow">
                            Express.js
                        </a>
                        as custom web server that can serve custom api
                    </li>
                    <li>
                        <a href="https://mongoosejs.com/" rel="nofollow">
                            Mongoose
                        </a>
                        as database ORM layer
                    </li>
                </ul>
                <p>
                    Forge SDK libraries included in the starter project:
                </p>
                <ul>
                    <li>
                        <a href="https://www.npmjs.com/package/@arcblock/graphql-client" rel="nofollow">
                            @arcblock/graphql-client
                        </a>
                        as communication layer between application and forge powered blockchain
                    </li>
                    <li>
                        <a href="https://www.npmjs.com/package/@arcblock/did-auth" rel="nofollow">
                            @arcblock/did-auth
                        </a>
                        help application do jwt based auth with ABT wallet
                    </li>
                    <li>
                        <a href="https://www.npmjs.com/package/@arcblock/did-auth-storage-mongo" rel="nofollow">
                            @arcblock/did-auth-storage-mongo
                        </a>
                        storage engines that powers the magic behind ABT Wallet qrcode scanning
                    </li>
                    <li>
                        <a href="https://www.npmjs.com/package/@arcblock/react-forge" rel="nofollow">
                            @arcblock/react-forge
                        </a>
                        react components that can implements basic UI elements to connect your application with ABT Wallet, such as avatar and auth dialog
                    </li>
                </ul>
                <p>
                    Other javascript project goodies:
                </p>
                <ul>
                    <li>
                        <code>
                            eslint
                        </code>
                        : for consistent coding style
                    </li>
                    <li>
                        <code>
                            prettier
                        </code>
                        : for consistent code formatting
                    </li>
                    <li>
                        <code>
                            husky
                        </code>
                        : and
                        <code>
                            lint-staged
                        </code>
                        for prepush and precommit hooks
                    </li>
                    <li>
                        <code>
                            nodemon
                        </code>
                        : for auto restart server on node.js code change
                    </li>
                    <li>
                        <code>
                            next.js
                        </code>
                        : supports hot reload on client code change
                    </li>
                    <li>
                        <code>
                            dotenv
                        </code>
                        : to load configurations from
                        <code>
                            .env
                        </code>
                        files
                    </li>
                </ul>
                <h2>
                    Folder Structure
                </h2>
                <pre class="language-terminal"><code>.
├── LICENSE
├── Makefile
├── README.md
├── app.js                    // application entry file
├── client                    // code for client side pages
│&nbsp;&nbsp; ├── babel.config.js       // custom babel configuration
│&nbsp;&nbsp; ├── components            // shared react components/layouts across all pages
│&nbsp;&nbsp; ├── hooks                 // shared react hooks
│&nbsp;&nbsp; ├── libs                  // shared utility code
│&nbsp;&nbsp; ├── next.config.js        // custom next.js configuration
│&nbsp;&nbsp; ├── pages                 // pages
│&nbsp;&nbsp; └── static                // static assets that can be loaded by browser
├── package.json
├── server                    // backend code
│&nbsp;&nbsp; ├── libs                  // shared server libs
│&nbsp;&nbsp; ├── models                // mongoose db models
│&nbsp;&nbsp; └── routes                // express routes and handlers
├── version
└── yarn.lock
</code></pre>
                <h2>
                    Runtime Requirements
                </h2>
                <ul>
                    <li>
                        Mongodb v3+
                    </li>
                    <li>
                        Node.js v10+
                    </li>
                    <li>
                        That's all
                    </li>
                </ul>
                <h2>
                    Usage
                </h2>
                <h3>
                    Create new project with forge-cli
                </h3>
                <pre class="language-terminal"><code>npm install -g @arcblock/forge-cli
forge init
forge start
forge create-project hello-forge
cd hello-forge
npm start
</code></pre>
                <h3>
                    Just use this starter repo
                </h3>
                <blockquote>
                    <p>
                        <strong>
                            Note: You have to setup an
                            <code>
                                .env
                            </code>
                            file manually.
                        </strong>
                    </p>
                </blockquote>
                <pre class="language-terminal"><code>git clone https://github.com/ArcBlock/forge-react-starter.git
cd forge-react-starter
yarn
</code></pre>
                <h2>
                    Configuration
                </h2>
                <p>
                    dApp configuration file is auto generated and stored in
                    <code>
                        .env
                    </code>
                    , example configure as:
                </p>
                <pre class="language-text"><code>MONGO_URI="mongodb://127.0.0.1:27017/forge-starter"
COOKIE_SECRET="71548f479c310ebc5bd972"
CHAIN_ID="forge"
CHAIN_HOST="http://192.168.1.6:8210/api"
APP_NAME="Forge Starter"
APP_PORT="3030"
APP_SK="0xd8ee2e2b73e0f3d7b7c5d53"
APP_ID="zNKtrS7etp2WQYnbVtknbDrVa23Q3eycdcDw"
BASE_URL="http://192.168.1.6:3030"
</code></pre>
                <blockquote>
                    <p>
                        Caution:
                        <code>
                            .env
                        </code>
                        contains very sensitive info such as Application wallet secret key, PLEASE DO NOT COMMIT
                        <code>
                            .env
                        </code>
                        FILE
                    </p>
                </blockquote>
                <h2>
                    LICENSE
                </h2>
                <p>
                    Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
                </p>
                <pre class="language-nolang"><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre>
                <p>
                    Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            arcblock
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/blockchain">
                                blockchain
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            elixir
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            forge-framework
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/node-js">
                                node.js
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/mave99a/blockcontract" rel="nofollow" target="_blank" title="https://github.com/mave99a/blockcontract">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
