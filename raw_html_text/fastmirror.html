<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    Remote Desktop solutions are terrible.
                </p>
                <p>
                    The old champions like VNC don't scale at all with higher bandwidths and the others are mostly proprietary paid services.
                </p>
                <p>
                    In recent years we've seen the explosion of video streaming as an entertainment medium - both through playing (NVIDIA's GameStream, Steam In-Home Streaming, OnLive...) and watching (Twitch, YouTube)
                </p>
                <p>
                    Our project approaches the first kind, and implements remote desktop without needing specific brand hardware or proprietary software.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    FastMirror is a screen streaming software. It wraps around the complicated fuss of low latency, high bandwidth streaming using experimental, poorly tested ffmpeg tricks.
                </p>
                <p>
                    It needs to get a PC's screen, encode it into a video, push it through the network, and play it.
                </p>
                <p>
                    All within &lt;100ms, or it will be unusable, while still being orders of magnitude faster than the alternatives.
                </p>
                <h2>
                    How we built it
                </h2>
                <p>
                    The sever (PC that sends the video stream) relays the screen to a modified nginx with RTMP support running on localhost. Clients connect to the RTMP stream and display it with MPlayer.
                </p>
                <p>
                    Keyboard and mouse handling is done via python and xdotool. A preliminary unified approach to these two parts of the program should be present.
                </p>
                <p>
                    With proper recent hardware able to encode webm and a cable connection the system is able to push lossless display feeds with sub 0.5s latency through Ethernet.
                </p>
                <p>
                    On constrained WiFi or 10 year old CPUs, it's able to stream the computer's display with reasonable quality, which is more than we ever imagined possible.
                </p>
                <h2>
                    Challenges we ran into
                </h2>
                <p>
                    Streaming low latency video in 2016 through the web is sadly impossible.
                </p>
                <p>
                    The challenges were many and apparently unsolvable according to the status quo.
                </p>
                <p>
                    But we tried anyway.
                </p>
                <p>
                    Our first goal was to minimize encoding delay. The video taken from the screen had to be compressed, and that takes time. ffmpeg is probably the most undocumented piece of black magic ever known to mankind, and getting through it used up our mind the entire 2 days of the hack.
                </p>
                <p>
                    Gathering configuration options and endless trial and error succeeded into creating the perfect ffmpeg command to get a screen and push it. On Core2Duo systems usually incapable of encoding at more than 3 FPS.
                </p>
                <p>
                    We wanted to make the GUI for the app in Electron, however we found out the hard truth then. Using web technologies, the only way to stream is to use webm (vp8/vp9) or a pure RTMP stream in the old, dead flash player.
                </p>
                <p>
                    The first proved challenging considering our computers didn't have hardware encoders for webm (and nobody does, since those first started appearing last year!)  Direct PC to stream proved impossible, so a middleman had to happen.
                </p>
                <p>
                    Software encoding webm on a system that was already running under load was ridiculous. Even when unconstrained, it would add massive input lag.
                </p>
                <p>
                    The grasp of Adobe into streaming was so large streaming can't be conceived without them. RTMP was made to be a protocol used by them and Flash Player, but many open source implementations of it have started to appear. Browsers, however, don't support it. We tried many different implementations and approaches for an entire day, but in the end, without any other options, we moved onto a native display.
                </p>
                <p>
                    It'd be easy to think this would solve all of our problems, but truth is, they hadn't even started.
                </p>
                <p>
                    MPlayer is the only video player capable of streaming low latency video, period. No other player can, we are unsure why we as a species got to that point, but that's how things are. It also needs launch parameters that tell it to disable most of its functionality, and lose some quality. All in the name of low input lag.
                </p>
                <p>
                    Better, newer hardware would've made things easier for us, as our computers were simply not powerful enough to be considered worthy of streaming anything. But in the end, it worked.
                </p>
                <p>
                    Maybe a little too close to the end because we ran out of time!
                </p>
                <p>
                    The python communication of keystrokes is not completely finished, mainly because it's our third one (the first one ran on nodejs for electron, then we had another one in regular js!) thanks to the constant scrapping of platforms. Thanks to streaming not being in HTML5, or anywhere in the web.
                </p>
                <p>
                    But how do Twitch and YouTube do it?
                </p>
                <p>
                    They have massive encoding lag. Twitch moved recently from pure RTMP to mp4 streams and the suffer now from almost minute long delays. YouTube is lower, but it has massive server farms powering it hundreds of times more powerful than regular laptops.
                </p>
                <p>
                    The other similar services for screen streaming locally have similar tricks in the ffmpeg bag, adding custom silicon for decoding/encoding to further minimize lag.
                </p>
                <h2>
                    Accomplishments that we are proud of
                </h2>
                <p>
                    We got within an inch of them in two days, which is awesome!
                </p>
                <p>
                    Seeing how we got stream delay from 20 seconds to .2 was amazing, and so was watching my laptop's screen on my friend's computer.
                </p>
                <p>
                    We actually got to learn lots of useful languages, and techniques. Some of them were a bit niche, but actually quite useful.
                </p>
                <h2>
                    What We learned
                </h2>
                <p>
                    We learned the intricacies of ffmpeg, video streaming, python, pygtk, javascript, some more nodejs for server usage, keyboard and mouse capture... we scripted them with xdotool, even programmed a bit of Junction Plays Pokemon to be demoed if the time came. We had a lot of fun doing all of this.
                </p>
                <p>
                    For some reason Ruben's laptop kept nuking the HDD's MBR and it required GRUB to be reinstalled every boot. We tried not to reboot it.
                </p>
                <h2>
                    What's next for FastMirror
                </h2>
                <p>
                    Finish the mouse handling! It needs to be able to actually play FPS games, not just RPGs. It will also get proper per-platform hardware encoding and decoding once we get back to our main rigs.
                </p>
                <p>
                    (Let's not talk about 6AM ssh'ing into your home 2000km away trying to get vdpau parameters)
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            arch-linux
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/bash">
                                bash
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/ffmpeg">
                                ffmpeg
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            mplayer
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            netcat
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            rtmp
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            sockets
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </body>
</html>
