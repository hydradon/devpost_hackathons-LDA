<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li class="text-center">
                        <a data-lightbox="339460" data-title="Battery operated WIFI particle Sensor" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/460/datas/original.JPG">
                            <img alt="Air Quality Monitor &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/460/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Battery operated WIFI particle Sensor
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="342136" data-title="Contest Story Board" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/342/136/datas/original.JPG">
                            <img alt="Air Quality Monitor &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/342/136/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Contest Story Board
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="342137" data-title="Sparkfun Photon Red Board" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/342/137/datas/original.jpg">
                            <img alt="Air Quality Monitor &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/342/137/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Sparkfun Photon Red Board
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339340" data-title="Shinyei Model PPD42NS Dust Sensor" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/340/datas/original.jpg">
                            <img alt="Air Quality Monitor &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/340/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Shinyei Model PPD42NS Dust Sensor
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339341" data-title="Pulse Width Example" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/341/datas/original.png">
                            <img alt="Air Quality Monitor &ndash; screenshot 5" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/341/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Pulse Width Example
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="340712" data-title="Conversion to parts" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/340/712/datas/original.png">
                            <img alt="Air Quality Monitor &ndash; screenshot 6" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/340/712/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Conversion to parts
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339360" data-title="Analog.io graph of data." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/360/datas/original.png">
                            <img alt="Air Quality Monitor &ndash; screenshot 7" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/360/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Analog.io graph of data.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339392" data-title="OnShape Box Design" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/392/datas/original.png">
                            <img alt="Air Quality Monitor &ndash; screenshot 8" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/392/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                OnShape Box Design
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339393" data-title="OnShape Cover Design" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/393/datas/original.png">
                            <img alt="Air Quality Monitor &ndash; screenshot 9" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/393/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                OnShape Cover Design
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339394" data-title="MakerFront i3 Pro 3D Printer" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/394/datas/original.JPG">
                            <img alt="Air Quality Monitor &ndash; screenshot 10" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/394/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                MakerFront i3 Pro 3D Printer
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339395" data-title="MakerFront i3 Pro 3D Printer" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/395/datas/original.JPG">
                            <img alt="Air Quality Monitor &ndash; screenshot 11" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/395/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                MakerFront i3 Pro 3D Printer
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="339472" data-title="Sample SMS Air Quality Alerts" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/472/datas/original.PNG">
                            <img alt="Air Quality Monitor &ndash; screenshot 12" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/339/472/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Sample SMS Air Quality Alerts
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    Concept
                </h1>
                <p>
                    The idea of this project is to make an inexpensive WIFI enabled air particle sensor that can log it's historical data on the web for others to use. The data can also be used to send SMS alerts to your cell phone to let you know when the air quality is poor.
                </p>
                <h1>
                    Background
                </h1>
                <p>
                    With allergies and asthma I'm interested in both the indoor and outdoor air quality. I heat with a Quadrafire woodstove. It is suppose to be a clean stove. I was interested in the impact on both my inside air (ie. ash/dust) and outside air (smoke). New York State monitors the air quality at several locations around the State. Certified Allergy &amp; Asthma Consultants in Albany NY published daily pollen counts.
                </p>
                <h1>
                    What I learned today
                </h1>
                <p>
                    Technology is changing very quickly in the IoT environment. I learned a ton of new things.
The mentors are the Tech Valley Center Of Gravity Makerspace were wonderful!
Thanks to Jeff Brunson from Sparkfun, Scot Straight from Makerfront, and Tom Tongue from COG.
                </p>
                <ul>
                    <li>
                        <a href="http://www.sparkfun.com/products/13320" rel="nofollow">
                            Sparkfun Particle Photon
                        </a>
                        and the
                        <a href="http://learn.sparkfun.com/tutorials/photon-redboard-hookup-guide" rel="nofollow">
                            Development
                        </a>
                        Environment
                    </li>
                    <li>
                        <a href="http://ifttt.com/" rel="nofollow">
                            IFTTT IF This Than That
                        </a>
                        alert generation
                    </li>
                    <li>
                        <a href="http://www.onshape.com/" rel="nofollow">
                            OnShape Solid Modeling
                        </a>
                    </li>
                    <li>
                        <a href="https://data.sparkfun.com/streams/MG4b4XnlZ9cLxrXMD75m" rel="nofollow">
                            data.sparkfun.com
                        </a>
                        datalogging
                    </li>
                    <li>
                        <a href="http://analog.io/" rel="nofollow">
                            Analog.io
                        </a>
                        Data Graphing
                    </li>
                </ul>
                <h1>
                    How it Works
                </h1>
                <ul>
                    <li>
                        The PPD42NS sensor outputs a signal on Pin 6. You measure how long the digital signal on pin is low during the 30 second sample time. This ratio is used in a transfer function to calculate the particles per 0.01 cubic feet.
                    </li>
                    <li>
                        The air particle concentration is pushed to the Internet in two different ways. The first is thru a
spark.variable which is a global variable on the cloud. It can be seen by applications like IFTTT.
The second location is data.sparkfun.com. The Phant library is used to post the data. The data
can be retrieved in several formats: JSON, CSV, MySQL, PostgreSQL, Atom.
                    </li>
                    <li>
                        The analog.io site reads the data.sparkfun.com site and creates rolling graphs.
                    </li>
                    <li>
                        The text message alerts are generated using IFTTT. There are connection objects for the particle and SMS.
                    </li>
                </ul>
                <h1>
                    Hardware
                </h1>
                <ul>
                    <li>
                        <a href="http://www.sparkfun.com/products/13321" rel="nofollow">
                            Sparkfun Photon Red Board
                        </a>
                    </li>
                    <li>
                        <a href="http://www.seeedstudio.com/depot/Grove-Dust-Sensor-p-1050.html" rel="nofollow">
                            SeeedStudio Dust Sensor
                        </a>
                    </li>
                    <li>
                        <a href="https://www.makerfront.com/shop/3d-printers/i3pro/" rel="nofollow">
                            Makerfront i3 Pro
                        </a>
                        3D Printer
                    </li>
                </ul>
                <h1>
                    Software
                </h1>
                <pre>/*
    Interface to Shinyei Model PPD42NS Particle Sensor
 Program by Christopher Nafis 
 Written January 2016
 
 http://www.seeedstudio.com/depot/grove-dust-sensor-p-1050.html
 
 JST Pin 1 (Black Wire)  =&gt; Photon GND
 JST Pin 3 (Red wire)    =&gt; Photon 5VDC
 JST Pin 4 (Yellow wire) =&gt; Photon Digital Pin 6
 */
#include "math.h"
#include "SparkFunPhant/SparkFunPhant.h"

int pin = 6;
unsigned long duration;
unsigned long starttime;
unsigned long sampletime_ms = 30000;
unsigned long lowpulseoccupancy = 0;
float ratio = 0;
double concentration = 0;

const char server[] = "data.sparkfun.com"; // Phant destination server
const char publicKey[] = "your public key"; // Phant public key
const char privateKey[] = "your private key"; // Phant private key
Phant phant(server, publicKey, privateKey); // Create a Phant object

const int POST_RATE = 30000; // Time between posts, in ms.
unsigned long lastPost = 0; // global variable to keep track of last post time

void setup() {
Serial.begin(9600);
pinMode(pin,INPUT);
Spark.variable("partcons", &amp;concentration, DOUBLE);
starttime = millis();
}

void loop() {
duration = pulseIn(pin, LOW);
lowpulseoccupancy = lowpulseoccupancy+duration;

if ((millis()-starttime) &gt; sampletime_ms)
{
ratio = lowpulseoccupancy/(sampletime_ms*10.0);  // Integer percentage 0=&gt;100
concentration = 1.1*pow(ratio,3)-3.8*pow(ratio,2)+520*ratio+0.62; // using spec sheet curve
Serial.print(lowpulseoccupancy);
Serial.print(", ");
Serial.print(ratio);
Serial.print(", ");
Serial.println(concentration);
lowpulseoccupancy = 0;
    
// If it's been POST_RATE ms (default 30 seconds), try to post again.
if (lastPost + POST_RATE &lt; millis())
{
// If the post succeeds, update lastPost so we don't post for
// another 30 seconds.
if (postToPhant() &gt; 0)
{
lastPost = millis();
}
// If the post fails, delay 1s and try again.
}
    
starttime = millis();
}
}

int postToPhant()
{
// Use phant.add(, ) to add data to each field.
// Phant requires you to update each and every field before posting,
// make sure all fields defined in the stream are added here.

phant.add("air", concentration);
    
TCPClient client;
char response[512];
int i = 0;
int retVal = 0;
    
if (client.connect(server, 80)) // Connect to the server
{
// Post message to indicate connect success
Serial.println("Posting!"); 
        
// phant.post() will return a string formatted as an HTTP POST.
// It'll include all of the field/data values we added before.
// Use client.print() to send that string to the server.
client.print(phant.post());
delay(1000);
// Now we'll do some simple checking to see what (if any) response
// the server gives us.
while (client.available())
{
char c = client.read();
Serial.print(c);    // Print the response for debugging help.
if (i &lt; 512)
response[i++] = c; // Add character to response string
}
// Search the response string for "200 OK", if that's found the post
// succeeded.
if (strstr(response, "200 OK"))
{
Serial.println("Post success!");
retVal = 1;
}
else if (strstr(response, "400 Bad Request"))
{   // "400 Bad Request" means the Phant POST was formatted incorrectly.
// This most commonly ocurrs because a field is either missing,
// duplicated, or misspelled.
Serial.println("Bad request");
retVal = -1;
}
else
{
// Otherwise we got a response we weren't looking for.
retVal = -2;
}
}
else
{   // If the connection failed, print a message:
Serial.println("connection failed");
retVal = -3;
}
client.stop();  // Close the connection to server.
return retVal;  // Return error (or success) code.
}
</pre>
                <h1>
                    Some of my other Projects
                </h1>
                <ul>
                    <li>
                        <a href="http://www.lightningnetwork.org/rabbitweather2/" rel="nofollow">
                            Rabbit Powered 1-Wire Weather Station Controller
                        </a>
                    </li>
                    <li>
                        <a href="http://www.howmuchsnow.com/snow/" rel="nofollow">
                            1-Wire Snowfall /Snow Depth Sensor (Automated Snowboard)
                        </a>
                    </li>
                    <li>
                        <a href="http://www.howmuchsnow.com/ping/" rel="nofollow">
                            Networked Ultrasonic Snow fall / Snow Depth / Water Height Sensor
                        </a>
                    </li>
                    <li>
                        <a rel="nofollow">
                            Monitoring Electricity Usage
                        </a>
                    </li>
                    <li>
                        <a href="http://www.howmuchsnow.com/arduino/radon/" rel="nofollow">
                            Monitoring Radon Gas Levels
                        </a>
                    </li>
                    <li>
                        <a href="http://www.howmuchsnow.com/arduino/dylos/" rel="nofollow">
                            Air Quality Monitoring with Dylos DC1100 Paricle Monitor
                        </a>
                    </li>
                </ul>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            makerfront-ie-pro-3d-printer
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            photon
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            shinyei-model-ppd42ns-dust-sensor
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://data.sparkfun.com/streams/MG4b4XnlZ9cLxrXMD75m" rel="nofollow" target="_blank" title="https://data.sparkfun.com/streams/MG4b4XnlZ9cLxrXMD75m">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                data.sparkfun.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://analog.io/s4OP" rel="nofollow" target="_blank" title="https://analog.io/s4OP">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                analog.io
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
