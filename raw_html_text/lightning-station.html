<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/sI-vs-2yrCQ?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="814604" data-title="The hardware and software on display." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/814/604/datas/original.png">
                            <img alt="Lightning Network Hardware Jukebox &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/814/604/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                The hardware and software on display.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="815301" data-title="Screen display panel with system, bitcoind and c-lightning stats" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/815/301/datas/original.png">
                            <img alt="Lightning Network Hardware Jukebox &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/815/301/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Screen display panel with system, bitcoind and c-lightning stats
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    We wanted to find a solution to help overcome the frustration of trying to explain exactly what Bitcoin is to a wide range of people. The ideas behind Bitcoin are abstract, there's a lot to explain, and little can be left out when trying to arrive at an accurate picture of the technology.
                </p>
                <p>
                    After spending years working at this through many conversations and presentations as stewards of our local
                    <a href="https://www.meetup.com/yegbitcoin/" rel="nofollow">
                        Bitcoin Meetup group in Edmonton, AB, Canada
                    </a>
                    , we decided to try out a more tangible approach by creating a full working example of what Bitcoin and the Lightning Network is and does.
                </p>
                <p>
                    The result was the bright orange, stat-displaying, song-playing, block-announcing piece of hardware pictured above and
                    <a href="https://github.com/jarret/lightning-station" rel="nofollow">
                        our repository of MIT-licensed source code
                    </a>
                    free for all to look at and use.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    The Jukebox does a number of things, most obviously it plays music, but critically it's built to show the entire process of a payment system built on Bitcoin and complete the loop of demonstrating how a user can pay for the service of this device playing a song.
The main features are:
                </p>
                <ul>
                    <li>
                        Visual display of mounted hardware components
                    </li>
                    <li>
                        Full running Bitcoin Node (
                        <code>
                            bitcoind
                        </code>
                        )
                    </li>
                    <li>
                        Lightning Network Node (
                        <code>
                            c-lightning
                        </code>
                        )
                    </li>
                    <li>
                        Real-time system and node stats display
                    </li>
                    <li>
                        Audio announcement of new block discovery
                    </li>
                    <li>
                        Jukebox with payment function via e-Ink QR Code (LN bolt11 Invoice)
                    </li>
                </ul>
                <p>
                    At the heart of it is a Raspberry Pi 3. For peripherals, it has a hard drive, an LCD screen and speakers as well as an e-ink display and push buttons for jukebox payment and controls.
                </p>
                <p>
                    The Raspberry Pi runs our custom software which interfaces with
                    <code>
                        bitcoind
                    </code>
                    ,
                    <code>
                        c-lightning
                    </code>
                    and the peripherals. It collects system stats from the underlying OS as well as the nodes.
                </p>
                <p>
                    The LCD screen displays real-time stats in organized, colorful
                    <code>
                        ncurses
                    </code>
                    output (via the
                    <code>
                        urwid
                    </code>
                    framework). It listens for new block arrivals, which it announces via the speakers, charming all in the vicinity with its robotic voice (provided by
                    <code>
                        espeak
                    </code>
                    ).
                </p>
                <p>
                    The jukebox application is built by interfacing with
                    <code>
                        c-lightning
                    </code>
                    via the
                    <code>
                        pylightning
                    </code>
                    Python package. Users can press the button interface to cycle through the song selection, which displays an invoice QR code on the e-ink screen. Paying the invoice triggers the selected song to be played (or adds it to the song queue if a song is already playing). The satoshis which are transferred to (and now owned by!) the Raspberry Pi are added to the stats output on the LCD screen.
                </p>
                <h2>
                    How we built it
                </h2>
                <hr>
                <p>
                    The goal was to physically present in as much detail as possible the full workings of the project. This meant exposing all the components in an easy-to-follow layout such that an observer can trace the wire connections from one part to the next.
                </p>
                <p>
                    The hardware is mounted on a large aluminum cookie tray that has been spray-painted orange, highlighted by a Bitcoin symbol and name sticker (a bumper sticker to compensate for underdeveloped painting skills).
                </p>
                <p>
                    The software is written in Python 3 utilizing the Twisted framework for the event loop and managing the many queries and peripheral interactions. Much of it is done in parallel and expressed as thread worker functions. The screen output is written to be lightweight and not require the system resources of running a full GUI environment on the Pi's operating system, which is why we chose the
                    <code>
                        urwid
                    </code>
                    framework.
                </p>
                <p>
                    The jukebox functionality interfaces with
                    <code>
                        pylightning
                    </code>
                    and obtains invoices via
                    <code>
                        c-lightning
                    </code>
                    , detect when they have been paid, manage the song queue and launch a thread of the music player application.
                </p>
                <p>
                    The GPIO interfacing for the buttons and the e-ink display also required some custom software. In particular, the code had to be written to render a QR code to this specific model of the display via it's UART interface. No existing open source code that did what we needed was available.
                </p>
                <h2>
                    Challenges we ran into
                </h2>
                <p>
                    Being primarily software developers, starting off with a pile of small, loose hardware was a humbling experience. Parts being slow to arrive and assembling stuff in a nice manner consumed a lot of time. Using a solder iron was also something we had to learn on the fly.
                </p>
                <p>
                    The QR code rendering on the e-ink was harder than anticipated and became it's own open-source sub-project we packaged up separately in
                    <a href="https://github.com/jarret/raspi-uart-waveshare" rel="nofollow">
                        another repository
                    </a>
                    for people to utilize for similar projects in the future.
                </p>
                <p>
                    Making a nice-looking stat output on the console terminal was also harder to build than imagined. The specifics of
                    <code>
                        urwid
                    </code>
                    and the underlying
                    <code>
                        ncurses
                    </code>
                    as well as the variety of terminal console quirks relating to colors, fonts, compatibility, fallbacks etc. had a learning curve to get around.
                </p>
                <p>
                    The application pattern of querying the
                    <code>
                        c-lightning
                    </code>
                    daemon for sets and subsets of
                    <code>
                        paid
                    </code>
                    ,
                    <code>
                        unpaid
                    </code>
                    , or
                    <code>
                        expired
                    </code>
                    LN invoices, comparing that to the application state and reacting accordingly was also a challenge to express in code for the first time, however this exercise has already been useful in informing other application development efforts.
                </p>
                <h2>
                    Accomplishments that we're proud of
                </h2>
                <ul>
                    <li>
                        Building a
                        <strong>
                            self-contained
                        </strong>
                        unit that is
                        <strong>
                            the full security model of Bitcoin
                        </strong>
                        , that
                        <strong>
                            operates at scale
                        </strong>
                        on
                        <strong>
                            low-cost hardware
                        </strong>
                        . Also, being an economic node, it demonstrates the possibilities for standalone vending-machine-like devices that can be built with this technology.
                    </li>
                    <li>
                        Motivating several people to install Lightning Network wallets on their phone and started a small Lightning Network economy among our local meetup group.
                    </li>
                    <li>
                        Being able to demo this unit to over a 100 people in a face-to-face context. Showing people how the Lightning Network operates for the first time is a great experience.
                    </li>
                </ul>
                <h2>
                    What we learned
                </h2>
                <p>
                    *A lot about the API/RPC calls of both networks' daemons. Also, managing the channel state of the Lightning Network and working past some initial misconceptions.
                </p>
                <ul>
                    <li>
                        Twisted is a powerful framework for this type of application development. Writing code in this mindset has prepared us for other applications of this type.
                    </li>
                    <li>
                        Through working with QR codes, we came to appreciate the new user interface possibilities of such codes and the bolt11 invoice requests.
                    </li>
                </ul>
                <h2>
                    What's next for our Lightning Network Hardware Jukebox
                </h2>
                <ul>
                    <li>
                        This project needs some bugfixes and some better configuration of the underlying system to make it easy to start up upon system boot.
                    </li>
                    <li>
                        A requested feature is to make the console output with the node stats more portable onto other hardware, such that wall-hanging all-in-one x86 computers could have the same cool screen output when running nodes.
                    </li>
                    <li>
                        We would also like to configure the networking to only connect to the Bitcoin and Lightning P2P network via Tor and also add Tor network information to the screen output.
                    </li>
                    <li>
                        We desire some more advanced block mempool stats are desired to better highlight the fee pressure and transaction optimization being seen.
                    </li>
                </ul>
                <h2>
                    License
                </h2>
                <p>
                    The description of this project is made available to the public under the
                    <a href="https://creativecommons.org/licenses/by-nd/4.0/" rel="nofollow">
                        Creative Commons Attribution-NoDerivatives 4.0 International (CC BY-ND 4.0)
                    </a>
                </p>
                <p>
                    The source code is MIT-licensed as described in the repository.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            python-c-lightning-urwid-twisted
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/raspberry-pi">
                                raspberry-pi
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/jarret/lightning-station" rel="nofollow" target="_blank" title="https://github.com/jarret/lightning-station">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
