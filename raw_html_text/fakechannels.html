<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li class="text-center">
                        <a data-lightbox="889741" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/889/741/datas/original.png">
                            <img alt="shadows plugin &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/889/741/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    My inspiration was the realization that Lightning nodes can do whatever they want with HTLCs they accept from others. The onion they receive contains the next channel which they should forward that payment to, but they don't
                    <em>
                        have
                    </em>
                    to forward that if they don't want. In fact, it doesn't even have to be a real channel. That channel id could be used to encode a different kind of information.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    This is a c-lightning plugin that generates invoices from its own node with route hints to private channels. It includes these route hints in the invoices it generates, but these private channels and corresponding private nodes don't actually exist.
                </p>
                <p>
                    Then it uses the
                    <a href="https://lightning.readthedocs.io/PLUGINS.html#htlc-accepted" rel="nofollow">
                        <code>
                            htlc_accepted
                        </code>
                    </a>
                    hook to read the information about the next route. If it's one of the "shadow" channels it knows how to build the preimage necessary to resolve that HTLC from the channel id itself, keeping the money and resolving the payment for the sender.
                </p>
                <p>
                    The good thing is that is hides the node id of the receiver -- not completely, as it must appear in the route hints, but at least it's not obvious that it is the final node, instead the final node appears to be some random private node no one will ever know if exists or not.
                </p>
                <h2>
                    How I built it
                </h2>
                <p>
                    I've used
                    <a href="https://github.com/fiatjaf/lightningd-gjson-rpc" rel="nofollow">
                        https://github.com/fiatjaf/lightningd-gjson-rpc
                    </a>
                    , the c-lightning plugin docs, the
                    <a href="https://godoc.org/github.com/lightningnetwork/lnd/zpay32" rel="nofollow">
                        https://godoc.org/github.com/lightningnetwork/lnd/zpay32
                    </a>
                    library and a bunch of guessing and luck.
                </p>
                <h2>
                    Challenges I ran into
                </h2>
                <p>
                    Got some pending unresolved payments while writing it and was afraid my channels would all get closed (becase I was doing all on mainnet) but then everything turned out to be ok.
                </p>
                <h2>
                    What's next for shadows plugin
                </h2>
                <p>
                    This is the biggest part. I plan to integrate this plugin with some modifications into
                    <a href="https://t.me/lntxbot" rel="nofollow">
                        https://t.me/lntxbot
                    </a>
                    so each bot user can have its own (fake) node id when generating invoices and hide the fact that they're using a custodial wallet.
                </p>
                <p>
                    The next step would be plug a custodial accounts database admin to it and turn it into an
                    <a href="https://lndhub.io/about" rel="nofollow">
                        lndhub
                    </a>
                    plugin so people could just throw a binary in their c-lightning nodes and instantly begin powering BlueWallets of their friends and families, and all them would appear to the external world as if they were using their own private nodes and not a custodial server.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            c-lightning
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/golang">
                                golang
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/shadows" rel="nofollow" target="_blank" title="https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/shadows">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
