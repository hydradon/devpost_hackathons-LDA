<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/rSE5Cq0NCC4?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="839724" data-title="Grid gateway diagram" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/724/datas/original.png">
                            <img alt="Private Machine Learning as a Service using PySyft &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/724/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Grid gateway diagram
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="839725" data-title="Grid network diagram" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/725/datas/original.png">
                            <img alt="Private Machine Learning as a Service using PySyft &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/725/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Grid network diagram
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="839728" data-title="Logo" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/728/datas/original.png">
                            <img alt="Private Machine Learning as a Service using PySyft &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/728/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Logo
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="839806" data-title="Notebook example of the grid network running" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/806/datas/original.png">
                            <img alt="Private Machine Learning as a Service using PySyft &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/839/806/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Notebook example of the grid network running
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="844129" data-title="Grid node web page visualization. After starting a grid node users can see general information about it through a web page." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/129/datas/original.png">
                            <img alt="Private Machine Learning as a Service using PySyft &ndash; screenshot 5" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/129/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Grid node web page visualization. After starting a grid node users can see general information about it through a web page.
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    Private Machine Learning as a Service using PySyft
                </h1>
                <h2>
                    Introduction
                </h2>
                <h3>
                    Context
                </h3>
                <p>
                    Data is the driver behind Machine Learning. Researchers and organizations collect massive amounts of data to train their machine learning models. They can then offer the use of such models as a service to outside actors who might not be able to create these models themselves but who still would like to use these models to make predictions on their own data.
                </p>
                <p>
                    For Machine Learning as a Service (MLaaS) to be widely adopted, trust mechanisms are needed. Model owners should be able to deploy its model with the guarantee that it can't be copied or stolen, and control how it is used by external users. While external users might have data that is considered too sensitive to be sent directly to the cloud, so encryption must be available to perform computation securely without compromising the data or the model.
                </p>
                <p>
                    We built a platform on top of PyTorch to perform secure and remote evaluation of sensitive data on real world neural network models.
                </p>
                <h3>
                    Presentation
                </h3>
                <p>
                    We present here Machine Learning as a Service (MLaaS) and Encrypted MLaaS applications that combine PySyft and Grid.
                </p>
                <p>
                    PySyft is a library that allows us to handle remote tensors, remote models and remote operations on these objects. It also makes possible to encrypt tensors in a way that still allows computation to be run on them, using a technique called Secure Multi-Party Computation (SMPC) which encrypts a variable by splitting it into multiple shares that operate as a private key (Check the references for more details). These building blocks are tightly connected to the native PyTorch concepts, and objects like a simple
                    <code>
                        x = torch.tensor([1, 2])
                    </code>
                    can be sent to a remote worker
                    <code>
                        bob
                    </code>
                    just by calling
                    <code>
                        x.send(bob)
                    </code>
                    , or even encrypted by calling
                    <code>
                        x.share(...)
                    </code>
                    ("share" refers to
                    <em>
                        secret sharing
                    </em>
                    in SMPC).
                </p>
                <p>
                    Grid is a collaborative platform for privacy-preserving machine learning. It provides the notion of remote workers, by allowing any python instance to connect to a distributed network, upload data tensors, send commands, download models, and more. It can be seen as an extension of PySyft to provide a collaborative network platform for data owners and data scientists who can collectively train and share AI models.
                </p>
                <p>
                    These two tools combined allow users to manage computation across non-trusting workers all across the world.
                </p>
                <p>
                    We extended PySyft and Grid in order to add support MLaaS and Encrypted MLaaS. We summarize our contributions by focusing on three different demos:
                </p>
                <ul>
                    <li>
                        Public Serving: a platform to download models and run them locally on private data, illustrated by serving a public GPT-2 model.
                    </li>
                    <li>
                        Private Serving: a platform to query sensitive models, which allow benefiting from models inference power while protecting IP and mitigating risks of misuse. We'll serve the GPT-2 model to run predictions on uploaded data, and we validate this input data according to a certain policy.
                    </li>
                    <li>
                        Encrypted Serving: A platform to use simultaneously sensitive models on private data. Users encrypt their data using
                        <em>
                            secret sharing
                        </em>
                        and download a model whose weights parameters are also
                        <em>
                            secret shared
                        </em>
                        . They can then evaluate the model over the data without disclosing any sensitive information. We show how to do this on a skin cancer prediction task.
                    </li>
                </ul>
                <h3>
                    Our Vision
                </h3>
                <p>
                    Remote and encrypted computing techniques have made significant breakthroughs in the last years, and the theory behind these concepts is now quite well established. However, it is still incredibly hard for organizations or researchers to use them in AI projects and to benefit from the privacy and scalability guarantees they provide.
                </p>
                <p>
                    We believe that anyone should be able to implement privacy-preserving tools with very little effort. We have created a platform on top of PySyft to manage deployment, encryption, and access to models at scale.
                </p>
                <p>
                    The applications and demos developed for this hackathon were built on the last few weeks by a small group of people, but this was only possible because of the combined efforts from a very active community:
                    <a href="https://www.openmined.org/" rel="nofollow">
                        OpenMined
                    </a>
                    . OpenMined released several open-source libraries and we feature here Grid and PySyft, which we believe are the first open-source Federated Learning framework for building secure and scalable models.
                </p>
                <h2>
                    How does it work?
                </h2>
                <h3>
                    Architecture
                </h3>
                <p>
                    We rely mainly on three concepts: a Worker, a Grid Network and a Grid Gateway.
                </p>
                <p>
                    <strong>
                        Worker
                    </strong>
                </p>
                <p>
                    A Grid Worker is a type of PySyft worker that is capable of performing remote communication via a Rest API (Flask) or via WebSockets. Workers are composed of two parts: an app and a client.
                </p>
                <ul>
                    <li>
                        <p>
                            The app
                        </p>
                        <p>
                            The app is a Flask app that represents a regular server that the client communicates with. We extend this server with the ability to store models and tensors on a PostgreSQL database. The app also presents a webpage where users can check general information about the worker at a glance. Users can: check the status of the worker (online or not), detailed information regarding the models hosted at the node and more.
                        </p>
                    </li>
                </ul>
                <p>
                    <img alt="" data-canonical-url="https://gist.githubusercontent.com/mari-linhares/1258a0a36b3afd7ba096e827fb391776/raw/c7888e8ec97e5a5cf86f9524cc2730950db5c4d0/grid_webpage.png" src="https://res.cloudinary.com/devpost/image/fetch/s--J9AidmUl--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://gist.githubusercontent.com/mari-linhares/1258a0a36b3afd7ba096e827fb391776/raw/c7888e8ec97e5a5cf86f9524cc2730950db5c4d0/grid_webpage.png">
                </p>
                <ul>
                    <li>
                        <p>
                            The client
                        </p>
                        <p>
                            A client is a wrapper object that implements communication with the app. A user can talk to the client and seamlessly execute Pytorch and Pysyft operations via WebSocket or Rest API requests.
                        </p>
                    </li>
                </ul>
                <pre class="language-python"><code>import grid as gr
import torch as th
import syft as sy

hook = sy.TorchHook(th)

worker = gr.WebsocketGridClient(hook, id="bob", addr="https://opengrid.herokuapp.com/")
# Connect to the worker
worker.connect()

# Send a tensor to the worker
th.tensor([1, 2, 3]).send(worker)
</code></pre>
                <p>
                    <strong>
                        Grid Network
                    </strong>
                </p>
                <p>
                    The Grid Network corresponds for a cluster of workers that are all connected to each other.
                </p>
                <p>
                    <img data-canonical-url="https://github.com/OpenMined/rfcs/blob/master/20190821-grid-platform/DHT-grid.png?raw=true" src="https://res.cloudinary.com/devpost/image/fetch/s--4e_fy96l--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/OpenMined/rfcs/blob/master/20190821-grid-platform/DHT-grid.png%3Fraw%3Dtrue">
                </p>
                <p>
                    With this fully distributed and decentralized architecure we can provide fault tolerance in a very transparent way using the Grid Gateway.
                </p>
                <p>
                    <strong>
                        Grid Gateway
                    </strong>
                </p>
                <p>
                    This network can be seen by a user as a single interface: the Grid Gateway. The Gateway works as a special DNS component, it will route nodes by queries instead of domain names.
                </p>
                <p>
                    It is important to emphasize: the Grid Gateway will not be able to perform any computation process on the nodes. It can not concentrate or centralize any data or model. It works as a bridge between a user that is outside of the grid network to get data/models that live inside the network.
                </p>
                <p>
                    <img data-canonical-url="https://github.com/OpenMined/rfcs/blob/master/20190821-grid-platform/partially_grid.png?raw=true" src="https://res.cloudinary.com/devpost/image/fetch/s--ndjb0pbd--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/OpenMined/rfcs/blob/master/20190821-grid-platform/partially_grid.png%3Fraw%3Dtrue">
                </p>
                <p>
                    Here's an example of how the interactions with the gateway look like:
                </p>
                <pre class="language-python"><code>import grid as gr
import torch as th
import syft as sy

hook = sy.TorchHook(th)


# The Gateway acts as a representation of the entire network
gateway = gr.GridNetwork("https://opengrid.herokuapp.com/")

model = th.nn.Linear(1, 1)
traced_model = th.jit.trace(model, th.tensor([1.]))

# We can serve a model on the gateway and it will actually choose 
# a worker (or multiple workers, here is where the fault tolerance happens)
# and serve the model there
gateway.serve_model(traced_model, "skin-cancer-grid-model", allow_remote_inference=True, allow_download=False) 

# We can then run inference directly from the gateway!! No need to talk to any worker on the network
# or even to know that they exist!!!
gateway.run_remote_inference(model_id="skin-cancer-grid-model", dataset=data)
</code></pre>
                <h3>
                    Model Sharing
                </h3>
                <p>
                    In order to send a worker over the wire, it needs to be serializable. We support two ways of implementing models serialization:
                </p>
                <ol>
                    <li>
                        Using Jit modules. We can turn a regular torch model into a jit module. Jit modules use Torchscript.
                    </li>
                </ol>
                <blockquote>
                    <p>
                        Torchsript creates serializable and optimizable models from PyTorch code. Any code written in TorchScript can be saved from a Python process and loaded in a process where there is no Python dependency. This facility will allow us to send this model to remote workers. - jit documentation
                    </p>
                </blockquote>
                <ol>
                    <li>
                        Using PySyft Plans. A Plan is intended to store a sequence of Pytorch and PySyft operations, just like a function, but it allows to send this sequence of operations to remote workers and to keep a reference to it. Check the references for more details on Plans.
                    </li>
                </ol>
                <h3>
                    Encryption
                </h3>
                <p>
                    In order to support hosting and querying encrypted models, we rely on PySyft's implementation of SMPC and Plans.
                </p>
                <h2>
                    Challenges
                </h2>
                <h3>
                    Extending PySyft plans to be able to call fetch on remote workers
                </h3>
                <p>
                    We had to extend PySyft Plans abstraction in order to support copying models over the wire and also copying encrypted models over the wire. This demanded a lot of hard work on understanding and extending this part of PySyft's codebase to allow such operations.
                </p>
                <p>
                    Part of this work can be seen on this PR:
                    <a href="https://github.com/OpenMined/PySyft/pull/2590" rel="nofollow">
                        https://github.com/OpenMined/PySyft/pull/2590
                    </a>
                </p>
                <h3>
                    Database support
                </h3>
                <p>
                    We added database support for the Grid apps, this required a broader understanding of PySyft's serialization module.
                </p>
                <h3>
                    Support for sending large models over the wire
                </h3>
                <p>
                    In order to host and query the GPT-2 model. We had to add support for sending and receiving streams of data over the wire which to the best of my knowledge has never been done before by the team members.
                </p>
                <h2>
                    What we learned
                </h2>
                <p>
                    The team working experience during the hackathon was very valuable: we had to organize and divide tasks between teammates, communicate clearly and set up goals and deadlines which certainly made some us better at managing people and resources.
                </p>
                <p>
                    We certainly learned a lot about how Pytorch (especially the Jit modules) and PySyft work so we could extend then correctly.
                </p>
                <p>
                    We had to implement unit tests that involved running multiple threads, remote execution and data being shared constantly and some times asynchronously. This required revisiting fundamental distributed computing concepts in practice.
                </p>
                <p>
                    We also had to think a lot about the user interface and how to make it friendly but yeat generalizable and flexible enough so that people can build their own ideas on top of our solution.
                </p>
                <h2>
                    Future Work
                </h2>
                <p>
                    We still have many things left out to do, but here are our most important challenges.
                </p>
                <p>
                    First, we want to add to the Grid library the ability to serve encrypted or non-encrypted models at its full potential. A clear next step is to add authentication to Grid. This is already in progress (
                    <a href="https://github.com/OpenMined/Grid/pull/295" rel="nofollow">
                        https://github.com/OpenMined/Grid/pull/295
                    </a>
                    ).
                </p>
                <p>
                    Second, we also want to support Federated Learning and Encrypted Federated Learning on it. There has been a huge speed-up on development recently as it was waiting for PySyft to be mature enough to rely on it.
                </p>
                <p>
                    Last, we want to extend the scope of Grid by adding support running it on other devices, like web browsers or Android mobiles.
                </p>
                <h2>
                    References
                </h2>
                <ul>
                    <li>
                        <a href="https://github.com/OpenMined/PySyft/blob/dev/examples/tutorials/Part%2009%20-%20Intro%20to%20Encrypted%20Programs.ipynb" rel="nofollow">
                            SMPC Tutorial from PySyft
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/OpenMined/PySyft/blob/dev/examples/tutorials/Part%2008%20-%20Introduction%20to%20Plans.ipynb" rel="nofollow">
                            PySyft tutorial for Plans
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/OpenMined/PySyft" rel="nofollow">
                            PySyft
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/OpenMined/Grid" rel="nofollow">
                            Grid
                        </a>
                    </li>
                    <li>
                        <a href="https://pytorch.org/docs/stable/jit.html" rel="nofollow">
                            Jit documentation
                        </a>
                    </li>
                </ul>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/flask">
                                flask
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/heroku">
                                heroku
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/postgresql">
                                postgresql
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            pysyft
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/pytorch">
                                pytorch
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            pytorch-transformers
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/sqlalchemy">
                                sqlalchemy
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            torchscript
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            torchvision
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            vue.js
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/websockets">
                                websockets
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/OpenMined/Grid/tree/dev/examples/Serving%20and%20Querying%20models%20on%20Grid" rel="nofollow" target="_blank" title="https://github.com/OpenMined/Grid/tree/dev/examples/Serving%20and%20Querying%20models%20on%20Grid">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
