<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/QTKmSnKSZAM?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402892" data-title="Home screen" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/892/datas/original.png">
                            <img alt="Locate My Restaurant &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/892/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Home screen
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402890" data-title="Select the cuisine you wish to open" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/890/datas/original.png">
                            <img alt="Locate My Restaurant &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/890/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Select the cuisine you wish to open
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402889" data-title="Cuisines average rating per state" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/889/datas/original.png">
                            <img alt="Locate My Restaurant &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/889/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Cuisines average rating per state
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402888" data-title="Cuisines average rating with demographic divide per state" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/888/datas/original.png">
                            <img alt="Locate My Restaurant &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/888/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Cuisines average rating with demographic divide per state
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402891" data-title="Cuisines average rating with demographic divide for all states" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/891/datas/original.png">
                            <img alt="Locate My Restaurant &ndash; screenshot 5" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/891/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Cuisines average rating with demographic divide for all states
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    Find Location for your next Restaurant
                </h1>
                <p>
                    You can use this app to figure out which location may be the best to open a certain type of cuisine in the United States.
                </p>
                <h2>
                    Getting Started
                </h2>
                <ul>
                    <li>
                        First screen asks you to select the type of cuisine you would want to start.
                    </li>
                    <li>
                        Based on the cuisine type selection, Geographic Map for U.S. shows up.
                    </li>
                    <li>
                        The Map shows different states color coded from lighter to darker where ligher color stands for less average star rating.
                    </li>
                    <li>
                        The average star rating per state per cuisine type is obtained by analyzing Yelp data available.
                    </li>
                    <li>
                        You can click on any color coded U.S. State to see how the demographics might have played any role in obtaining certain rating. This is shown using the Sankey diagram outlining the relationship.
                    </li>
                    <li>
                        The demographic data has been obtained using Spark script accessing
                        <strong>
                            U.S Census API.
                        </strong>
                    </li>
                </ul>
                <h2>
                    Data Analysis
                </h2>
                <ul>
                    <li>
                        All the data analysis has been done using
                        <b>
                            Scala on Apache Spark running on Windows desktop
                        </b>
                        .
                    </li>
                    <li>
                        Yelp business dataset in JSON format includes a key named "categories" which lists comma separated categories for a particular business.
                        <pre><code>
val businesses = sqlContext.read.json("C:/amit/yelp/data/yelp_academic_dataset_business.json")
</code></pre>
                    </li>
                    <li>
                        There are
                        <em>
                            <strong>
                                ~77K
                            </strong>
                        </em>
                        businesses in the dataset.
                    </li>
                    <li>
                        Exploding the dataset using "categories" element yields
                        <em>
                            <strong>
                                ~230K
                            </strong>
                        </em>
                        records.
                        <pre><code>
val busWithCategory = businesses.select("business_id","categories","city","state","latitude","longitude","stars").
explode("categories", "category") {
categories: WrappedArray[String] =&gt; categories.mkString(",").split(",") }
</code></pre>
                    </li>
                    <li>
                        Sample types of cuisines chose for the app are determined based on the number of businesses listed against those. This too is figured out using a Scala script ran on Spark.
                        <pre><code>
busWithCategory.select("business_id","category").groupBy("category").count().orderBy(desc("count")).show()
</code></pre>
                    </li>
                    <li>
                        <b>
                            Top category is "Restaurant" which is not a type of cuisine, however still selected solely based on the number of ratings we can work with for this demonstration.
                        </b>
                    </li>
                    <li>
                        The number of ratings for business selected are as below
                        <pre><code>
----------------------
Category    |  Count 
----------------------
Restaurants |  25071
Fast Food   |  2851
Chinese     |  1629
----------------------
</code></pre>
                    </li>
                    <li>
                        For these cuisines, find out the average star rating obtained for them per state. These are then stored into state-cuisinetype-avg-rating.json for later use.
                        <pre><code>
val restaurants = busWithCategory.filter(upper($"category").equalTo("Restaurants".toUpperCase())).drop("categories")
val restaurantsAvgStarsPerState = restaurants.groupBy($"state").avg("stars").select($"state",round($"avg(stars)",2).alias("avg_star"))
val fastfoodRests = busWithCategory.filter(upper($"category").equalTo("fast food".toUpperCase()))
val fastfoodRestAvgStarsPerState = fastfoodRests.groupBy($"state").avg("stars").select($"state",round($"avg(stars)",2).alias("avg_star"))
val chineseRests = busWithCategory.filter(upper($"category").equalTo("chinese".toUpperCase())).drop("categories")
val chineseRestsAvgStarsPerState = chineseRests.groupBy($"state").avg("stars").select($"state",round($"avg(stars)",2).alias("avg_star"))
</code></pre>
                    </li>
                    <li>
                        Fetching Census Data as a Spark RDD
                    </li>
                    <li>
                        US 2010 Census data is used to add the Demographic dimension to the data analysis.
                    </li>
                    <li>
                        I have created a JSON file that contained mappings between US States and their FIPS codes. The census data needs to be retrieved using the IDs assigned to each state.
                    </li>
                    <li>
                        <p>
                            Below is the Scala script ran on Spark to get the Population data for U.S. 2010 Census.
                        </p>
                        <pre><code>
val cityStateCensusCode = sqlContext.read.json("C:/amit/yelp/data/yelp-city-state.json")
// Grab the demographics for the data retrieved above.
val stateCensusCode = cityStateCensusCode.select("state","code","census_code").distinct()
stateCensusCode.map(row =&gt; {println row})

val censusdata = stateCensusCode.map(row =&gt; {
val stateCode = row(2)
val url = "http://api.census.gov/data/2010/sf1?key=48f46a5c4b5cea8481b12d8f0dc9e2fe416d3d50&amp;get=P0010001,P0080003,P0080004,P0080006,NAME&amp;for=state:" + stateCode;
val demographicsForState = scala.io.Source.fromURL(url).mkString;      
</code></pre>
                    </li>
                    <li>
                        <p>
                            This data then is processed to generate State-wise Census JSON.
                        </p>
                        <pre><code>
val censusvalues = demographicsForState.split("],")(1).stripPrefix("\n[").stripSuffix("]]").split(",") 
val jsonout = ("{\"totalpop\":").concat(censusvalues(0)).concat(",\"totalwhites\":").concat(censusvalues(1)).      concat(",\"totalblack\":").concat(censusvalues(2)).concat(",\"totalasian\":").concat(censusvalues(3)).concat(",\"state\":")
.concat(censusvalues(4)).concat(",\"state_code\":").concat(censusvalues(5)).
concat(",\"percentasian\":").concat(censusvalues(3)*100/censusvalues(0)).
concat(",\"percentblack\":").concat(censusvalues(2)*100/censusvalues(0)).
concat(",\"percentwhite\":").concat(censusvalues(1)*100/censusvalues(0)).
concat("}")
// return the json constructed
jsonout
})
censusdata.coalesce(1).saveAsTextFile("C:/amit/yelp/data/city-state-census")
</code></pre>
                    </li>
                    <li>
                        <p>
                            Census and Yelp data are then joined for each state to plot the Sankey diagram which shows the demographic distribution and type of cuisine preferred in that area.
                        </p>
                        <pre><code>
        val stateCensusData = sqlContext.read.json("C:/amit/yelp/data/state-census-data.json")

  val requiredCensusData = stateCensusData.select("state","percentasian","percentblack","percentwhite")
  val censusWithCuisine = requiredCensusData.join(cuisinetypeAvgRatingPerstate,"state").orderBy("state")
  val censusWithCuisineSankeyData = censusWithCuisine.select("state","percentasian","percentblack","percentwhite","avg_rating","cuisine_type").map( row =&gt; {
  val cuisineType = JSONArray(List(row.getString(4),row.getString(5),row.getString(0)))
  val asian = JSONArray(List(row.getString(0),"percentasian",row.getString(1)))
  val black = JSONArray(List(row.getString(0),"percentblack",row.getString(2)))
  val white = JSONArray(List(row.getString(0),"percentwhite",row.getString(3)))

  val sankeydata = JSONArray(List(cuisineType,asian,black,white))
  val jsonobj = JSONObject(Map(row.getString(0)-&gt;sankeydata))
  jsonobj
  })
  censusWithCuisineSankeyData.coalesce(1).saveAsTextFile("C:/amit/yelp/data/percentperstate")
</code></pre>
                    </li>
                    <li>
                        <p>
                            Sankey Diagram then uses this JSON dataset.
                        </p>
                    </li>
                </ul>
                <h2>
                    Constraints
                </h2>
                <ul>
                    <li>
                        Yelp dataset does not include the statistics for all the states.
                    </li>
                    <li>
                        You can only choose from three cuisines at the moment and those are selected based on the number of reviews available for them in Yelp Dataset.
                        <br>
                    </li>
                </ul>
                <h2>
                    Challenges
                </h2>
                <ul>
                    <li>
                        Installing Apache Spark on windows
                    </li>
                    <li>
                        Figuring out the way to retrieve US Census Data
                    </li>
                    <li>
                        Learning Scala
                    </li>
                </ul>
                <h2>
                    Next Steps
                </h2>
                <ul>
                    <li>
                        Try to blend more Census data points to help determine the location
                    </li>
                    <li>
                        Extend the application to perform analysis at City level instead of State level
                    </li>
                    <li>
                        Implement Similarity Algorithm to figure out best possible location for certain type of restaurant. This would use the available data vector and find similar data vectors based on User Input.
                    </li>
                    <li>
                        Figure out where Restaurant Inspection data can be obtained and integrated with the application.
                    </li>
                    <li>
                        Move the JSON output collected to NoSQL DB instead of JS files embedded in the application.
                    </li>
                </ul>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            apache-spark
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/bootstrap">
                                bootstrap
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            geo-chart
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/google-chart">
                                google-chart
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/html5">
                                html5
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/javascript">
                                javascript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/jquery">
                                jquery
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/json">
                                json
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/particle">
                                particle
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            sankey
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/scala">
                                scala
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/us-census-bureau">
                                us-census-bureau
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/yelp">
                                yelp
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://amitlondhe.github.io/spark-app/" rel="nofollow" target="_blank" title="https://amitlondhe.github.io/spark-app/">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                amitlondhe.github.io
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
