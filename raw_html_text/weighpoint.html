<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li class="text-center">
                        <a data-lightbox="808636" data-title="Ball search neighborhoods are implemented using tf.RaggedTensors" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/636/datas/original.png">
                            <img alt="WeighPoint: Weighted Point Cloud Convolutions in Tensorflow &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/636/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Ball search neighborhoods are implemented using tf.RaggedTensors
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="808635" data-title="Weighted averages with continuous weighting function makes operations continuous in space" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/635/datas/original.png">
                            <img alt="WeighPoint: Weighted Point Cloud Convolutions in Tensorflow &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/635/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Weighted averages with continuous weighting function makes operations continuous in space
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="808236" data-title="Unlike image CNNs, WeighPoint convolutions can learn an optimal receptive field based on a constant computational budget." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/236/datas/original.png">
                            <img alt="WeighPoint: Weighted Point Cloud Convolutions in Tensorflow &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/236/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Unlike image CNNs, WeighPoint convolutions can learn an optimal receptive field based on a constant computational budget.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="808634" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/634/datas/original.png">
                            <img alt="WeighPoint: Weighted Point Cloud Convolutions in Tensorflow &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/634/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="808638" data-title="Presentation slides available at https://drive.google.com/open?id=1zR1GR2ZBhmv3ITlLMnGwCeXcVkI_WrZii1Mg3hwq3Ho" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/638/datas/original.png">
                            <img alt="WeighPoint: Weighted Point Cloud Convolutions in Tensorflow &ndash; screenshot 5" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/808/638/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Presentation slides available at https://drive.google.com/open?id=1zR1GR2ZBhmv3ITlLMnGwCeXcVkI_WrZii1Mg3hwq3Ho
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    Point cloud convolutions in deep learning have seen a lot of interest lately (
                    <a href="https://github.com/charlesq34/pointnet2" rel="nofollow">
                        pointnet++
                    </a>
                    ,
                    <a href="https://github.com/cylance/GeneralizedConvolutionalNeuralNets" rel="nofollow">
                        generalized convolutions
                    </a>
                    ,
                    <a href="https://github.com/DylanWusee/pointconv" rel="nofollow">
                        PointConv
                    </a>
                    ,
                    <a href="https://github.com/cgtuebingen/Flex-Convolution" rel="nofollow">
                        FlexConv
                    </a>
                    ,
                    <a href="https://arxiv.org/abs/1803.11527" rel="nofollow">
                        SpiderCNN
                    </a>
                    ). These approaches involve grouping points according to local proximity using data structures like a KDTree. While results on classification and segmentation tasks are promising, most publicly available implementations suffer from a number of factors including:
                </p>
                <ol>
                    <li>
                        <code>
                            k
                        </code>
                        -nearest-neighbors search to ensure a fixed number of neighbors, rather than a fixed neighborhood radius;
                    </li>
                    <li>
                        discontinuity in space:
                        <code>
                            k
                        </code>
                        -nearest neighbors is discontinous as the
                        <code>
                            k
                        </code>
                        th and
                        <code>
                            k+1
                        </code>
                        th neighbors switch order; and
                    </li>
                    <li>
                        custom kernel dependency which requires additional setup and maintenance.
                    </li>
                </ol>
                <h2>
                    What it does
                </h2>
                <p>
                    WeighPoint addresses each of these issues.
                </p>
                <ul>
                    <li>
                        Our base convolution takes a "ragged first" approach, taking advantage of tensorflow's new
                        <a href="https://www.tensorflow.org/versions/r2.0/api_docs/python/tf/RaggedTensor" rel="nofollow">
                            RaggedTensor
                        </a>
                        class to support ball searches of specified radius, rather than a fixed number of neighbors.
                    </li>
                    <li>
                        Continuouity is addressed by replacing summation with a weighted average, where the weighting function continuously decreases to zero at the ball-search radius
                    </li>
                    <li>
                        The
                        <code>
                            tf.data.Dataset
                        </code>
                        pipeline is used extensively to ensure neighborhood searches are conducted via
                        <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.cKDTree.html" rel="nofollow">
                            scipy's KDTree
                        </a>
                        implementation on CPUs during preprocessing.
                    </li>
                </ul>
                <p>
                    The resulting architecture requires no custom kernels to be built. Basic models can be trained in a number of hours (2-8) on a single desktop GPU (timings based on GTX-1070/ GTX-1080-TI).
                </p>
                <h2>
                    How I built it
                </h2>
                <p>
                    While this project was developed using 1.12/1.13, it was always intended to be easily ported to 2.0. As such, the
                    <code>
                        tf.keras
                    </code>
                    framework was used throughout. It also makes extensive use of the
                    <code>
                        tf.data.Dataset
                    </code>
                    API and is configurable via
                    <a href="https://github.com/google/gin-config" rel="nofollow">
                        gin-config
                    </a>
                    .
                </p>
                <h2>
                    Challenges I ran into
                </h2>
                <ul>
                    <li>
                        I found the requirement in 1.x for keras lambda layers to wrap basic operations to be quite infuriating - especially when combined with
                        <code>
                            tf.RaggedTensor
                        </code>
                        s, as they cannot be the input or output of lambda layers. I am pleasantly surprised this requirement is dropped in 2.0 (though the code still has them to support earlier versions).
                    </li>
                    <li>
                        <code>
                            tf.RaggedTensor
                        </code>
                        s, while amazing, were a bit rough around the edges at the start of the project.
                        <a href="https://github.com/tensorflow/tensorflow/issues/27497" rel="nofollow">
                            Subtle bugs
                        </a>
                        , unimplemented gradients and unpredictable memory usage during gradient computation - while completely understandable as with any new release - led to several re-writes of the core convolution implementation.
                    </li>
                    <li>
                        Each convolution in a WeighPoint CNN has it's own neighborhood that must be calculated. These calculations can be done during preprocessing, but this is
                        <em>
                            per-layer
                        </em>
                        preprocessing, and thus network dependent. Writing preprocessing and learning networks separately and coordinating them proved unviable for all but the most basic proof-of-concept.
                    </li>
                    <li>
                        As far as I am aware, there is no simple way to batch ragged tensors together using the
                        <code>
                            tf.data.Dataset
                        </code>
                        API.
                        <code>
                            padded_batch
                        </code>
                        gives you the tools, but early experiments showed naively padding them stripping based on
                        <code>
                            tf.RaggedTensor.from_tensor
                        </code>
                        throttled performance unacceptably.
                    </li>
                    <li>
                        Making the one project compatible with 1.x and 2.0 is difficult. The idea that keras code will work in either 1.x or 2.0 - while a nice idea - simply isn't the case for non-trivial projects. For example, trainable models generated raise errors on serialization in 2.0 but not 1.13. It's also not clear
                        <a href="https://stackoverflow.com/questions/55860100/tf-data-dataset-map-with-variable-dependencies" rel="nofollow">
                            how to replicate reinitializable iterator behaviour in 2.0
                        </a>
                        without resorting to
                        <code>
                            tf.compat
                        </code>
                        .
                    </li>
                </ul>
                <h2>
                    Accomplishments that I'm proud of
                </h2>
                <p>
                    I'm most proud of the way in which network-dependent preprocessing is implemented. While it isn't super easy to debug and precludes the use of eager mode during network construction, it allows all network code - per-layer per-example preprocessing and batched learned components - to be written in one place without sacrificing any control, and while also automating the ragged batching process.
                </p>
                <p>
                    A side effect of the ragged first implementation is the output is differentiable not only with respect to point positions, but also the neighborhood radius itself. This means - unlike image convolutions - the receptive field of each layer itself can be learned.
                </p>
                <h2>
                    What I learned
                </h2>
                <p>
                    <code>
                        keras
                    </code>
                    in 2.0 is looking very promising. Coming from estimators I was disappointed by the lack of comparable out-of-the-box features in keras in 1.13 (e.g. tensorboard logging of custom metrics is, in my opinion, highly unintuitive and unlike all other tensorboard logging, and restarting training from a previous checkpoint is distinctly non-trivial), but I'm optimistic looking forward.
                </p>
                <h2>
                    What's next for WeighPoint
                </h2>
                <p>
                    Classification with basic models are close - but still worse - than state-of-the-art (87-89% vs SOTA 92%). There is a vast amount of configurations possible however, and a I am hopeful a non-exhaustive architecture search will yield better results.
                </p>
                <p>
                    A segmentation dataset and model has also been written, though a known bug that needs to be resolved before results beyond random guessing can be expected. Point cloud generation/reconstruction from images should also be possible with the operations.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            tensorflow
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            tensorflow-2
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/jackd/weighpoint" rel="nofollow" target="_blank" title="https://github.com/jackd/weighpoint">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://drive.google.com/open?id=1VxAnRMcPhovMwqpY1Z9iYsOS8pjvdLFw" rel="nofollow" target="_blank" title="https://drive.google.com/open?id=1VxAnRMcPhovMwqpY1Z9iYsOS8pjvdLFw">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                drive.google.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://drive.google.com/open?id=1zR1GR2ZBhmv3ITlLMnGwCeXcVkI_WrZii1Mg3hwq3Ho" rel="nofollow" target="_blank" title="https://drive.google.com/open?id=1zR1GR2ZBhmv3ITlLMnGwCeXcVkI_WrZii1Mg3hwq3Ho">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                drive.google.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
