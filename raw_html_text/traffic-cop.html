<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/DIZB0Zh89RM?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691542" data-title="Web Interface demo" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/542/datas/original.png">
                            <img alt="Traffic Cop &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/542/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Web Interface demo
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691543" data-title="Proof of Concept circuit" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/543/datas/original.jpg">
                            <img alt="Traffic Cop &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/543/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Proof of Concept circuit
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691544" data-title="AWS Architecture" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/544/datas/original.png">
                            <img alt="Traffic Cop &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/544/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                AWS Architecture
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    Traffic Cop
                </h1>
                <p>
                    <a href="http://traffic-cop.s3-website-us-east-1.amazonaws.com/" rel="nofollow">
                        http://traffic-cop.s3-website-us-east-1.amazonaws.com/
                    </a>
                </p>
                <p>
                    WiFi Beacon &amp; Client sniffing pipeline for analysing the movements of Human Traffickers.
                </p>
                <p>
                    <img alt="img/web-demo.png" data-canonical-url="https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/web-demo.png" src="https://res.cloudinary.com/devpost/image/fetch/s--TtdB3PLz--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/web-demo.png">
                </p>
                <h2>
                    Authors
                </h2>
                <ul>
                    <li>
                        Nathan Glover
                        <a href="https://twitter.com/nathangloverAUS" rel="nofollow">
                            @nathangloverAUS (Twitter)
                        </a>
                        ,
                        <a href="https://github.com/t04glovern" rel="nofollow">
                            @t04glovern (Github)
                        </a>
                    </li>
                    <li>
                        Stephen Mott
                        <a href="https://github.com/SrzStephen" rel="nofollow">
                            @SrzStephen (Github)
                        </a>
                    </li>
                </ul>
                <h2>
                    Proof of Concept
                </h2>
                <p>
                    <img alt="img/poc-circuit.jpg" data-canonical-url="https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/poc-circuit.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--wRLjuTEs--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/poc-circuit.jpg">
                </p>
                <h2>
                    Circuit Diagram
                </h2>
                <p>
                    <img alt="circuit/circuit-diagram_bb.jpg" data-canonical-url="https://raw.githubusercontent.com/t04glovern/traffic-cop/master/circuit/circuit-diagram_bb.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--dTodNm8e--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://raw.githubusercontent.com/t04glovern/traffic-cop/master/circuit/circuit-diagram_bb.jpg">
                </p>
                <h3>
                    BOM
                </h3>
                <ul>
                    <li>
                        <a href="https://www.amazon.com/NodeMCU-ESP8266-Microcontroller-Arduino-Makerdo/dp/B07BGCF3NY" rel="nofollow">
                            2x NodeMCU 1.0 (ESP 12 E Module)
                        </a>
                    </li>
                    <li>
                        <a href="https://core-electronics.com.au/u-blox-neo-6m-gps-module.html" rel="nofollow">
                            1x U-blox NEO-6M GPS Module
                        </a>
                    </li>
                    <li>
                        1x ~2k&Omega;+ Resistor
                    </li>
                    <li>
                        5x M2M Jumper Wires
                    </li>
                </ul>
                <h2>
                    Architecture
                </h2>
                <p>
                    <img alt="img/aws-architecture.png" data-canonical-url="https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/aws-architecture.png" src="https://res.cloudinary.com/devpost/image/fetch/s--FS-ntBFd--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/aws-architecture.png">
                </p>
                <h2>
                    Deploying CF
                </h2>
                <h3>
                    IoT Vending Machine
                </h3>
                <p>
                    Deploys a IoT Vending machine instances that can be used to generate certificates for new devices
                </p>
                <pre class="language-bash"><code>aws cloudformation create-stack --stack-name "TrafficCop-IoT-Vending-Machine" \
--template-body file://aws/Iot-Certificate-Vending-Machine.json \
--parameters file://aws/Iot-Certificate-Vending-Machine-Params.json \
--capabilities CAPABILITY_IAM
</code></pre>
                <h4>
                    Create Device
                </h4>
                <p>
                    Check the outputs from your cloudformation stack and retrieve the
                    <em>
                        RequestUrlExample
                    </em>
                    , It'll look like the following:
                </p>
                <pre class="language-bash"><code>https://&lt;api-gateway-id&gt;.execute-api.us-east-1.amazonaws.com/LATEST/getcert?serialNumber=value1&amp;deviceToken=value2
</code></pre>
                <p>
                    Create a new item in the DynamoDB instance that was created by the previous CloudFormation script (the DB is called deviceInfo)
                </p>
                <p>
                    <img alt="img/dynamodb-deviceInfo.png" data-canonical-url="https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/dynamodb-deviceInfo.png" src="https://res.cloudinary.com/devpost/image/fetch/s--ZPFxq9tk--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://raw.githubusercontent.com/t04glovern/traffic-cop/master/img/dynamodb-deviceInfo.png">
                </p>
                <ul>
                    <li>
                        <strong>
                            serialNumber
                        </strong>
                        : This should be something unique and will be the identifier for the IoT device you are onboarding (
                        <em>
                            e.g. gps-glover-01
                        </em>
                        )
                    </li>
                    <li>
                        <strong>
                            deviceToken
                        </strong>
                        : This should be a private hash/secret that you will use to generate certificates for your new device securely (
                        <em>
                            e.g. 572589798725
                        </em>
                        )
                    </li>
                </ul>
                <p>
                    Substitute these two into your API Gateway query
                </p>
                <pre class="language-bash"><code>https://&lt;api-gateway-id&gt;.execute-api.us-east-1.amazonaws.com/LATEST/getcert?serialNumber=gps-glover-01&amp;deviceToken=572589798725
</code></pre>
                <p>
                    You'll be returned a json response:
                </p>
                <pre class="language-json"><code>{
                "certificateArn": "arn:aws:iot:us-east-1:&lt;account-id&gt;:cert/009ff6ee0.........",
    "certificateId": "009ff6ee092e......",
    "certificatePem": "-----BEGIN CERTIFICATE-----\nMIIDWTCCAkGgAwIBAgIUZiIgLi......-----END CERTIFICATE-----\n",
    "keyPair": {
    "PublicKey": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAO.......-----END PUBLIC KEY-----\n",
    "PrivateKey": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQ........-----END RSA PRIVATE KEY-----\n"
    },
    "RootCA": "-----BEGIN CERTIFICATE-----\r\nMIIE0zCCA7ugAwIBAgIQGNrRniZ96Lt........-----END CERTIFICATE-----"
}
</code></pre>
                <p>
                    Place the outputs for each of the three fields below into new files in
                    <a href="esp8266-gps/certs" rel="nofollow">
                        esp8266-gps/certs
                    </a>
                </p>
                <ul>
                    <li>
                        <strong>
                            esp8266-gps/certs/certificate.pem.crt
                        </strong>
                        : certificatePem
                    </li>
                    <li>
                        <strong>
                            esp8266-gps/certs/private.pem.key
                        </strong>
                        : keyPair.PrivateKey
                    </li>
                    <li>
                        <strong>
                            esp8266-gps/certs/root-CA.pem
                        </strong>
                        : RootCA
                    </li>
                </ul>
                <p>
                    Follow the instructions in
                    <a href="esp8266-gps/README.md" rel="nofollow">
                        esp8266-gps/README.md
                    </a>
                    on how to convert and upload these certificates to the ESP8266
                </p>
                <h3>
                    DynamoDB Instance
                </h3>
                <p>
                    Deploys the DynamoDB table + an action rule to push data from a topic into said Dynamo instance
                </p>
                <pre class="language-bash"><code>aws cloudformation create-stack --stack-name "TrafficCop-IoT-TopicRule" \
--template-body file://aws/IoT-TopicRule.json \
--parameters file://aws/IoT-TopicRule-Params.json \
--capabilities CAPABILITY_IAM
</code></pre>
                <h3>
                    DynamoDB API
                </h3>
                <p>
                    Build the API zip
                </p>
                <pre class="language-bash"><code>cd api
./package-lambda.sh
</code></pre>
                <p>
                    Upload the API to S3 bucket (this same S3 bucket should be used in the Parameters of the
                    <code>
                        aws/DynamoDB-Frontend-Params.json
                    </code>
                    file)
                </p>
                <pre class="language-bash"><code>cd api
aws s3 cp dynamodb-api.zip s3://waanimals-deployment-scripts/traffic-cop/dynamodb-api.zip
</code></pre>
                <p>
                    Deploy the API to CloudFormation
                </p>
                <pre class="language-bash"><code>aws cloudformation deploy --template-file aws/DynamoDB-Frontend.json \
--stack-name "TrafficCop-DynamoDB-API" \
--capabilities CAPABILITY_IAM
</code></pre>
                <p>
                    Retrieve the stacks API endpoint
                </p>
                <pre class="language-bash"><code>aws cloudformation describe-stacks --stack-name "TrafficCop-DynamoDB-API"  --query Stacks[].Outputs[].OutputValue[] --output text
</code></pre>
                <p>
                    Place the output from this command into the
                    <code>
                        frontend/index.html
                    </code>
                    file under replacing the
                    <code>
                        api_gateway_url
                    </code>
                    variable.
                </p>
                <pre class="language-markup"><code>var api_gateway_url = 'https://&lt;api_gateway_id&gt;.execute-api.us-east-1.amazonaws.com/prod';
</code></pre>
                <h3>
                    Frontend
                </h3>
                <p>
                    Deploy the frontend HTML to an S3 bucket with site capability
                </p>
                <p>
                    The bucket policy should be the following for public access
                </p>
                <pre class="language-json"><code>{
                "Version": "2012-10-17",
    "Statement": [
    {
    "Sid": "PublicReadGetObject",
    "Effect": "Allow",
    "Principal": "*",
    "Action": [
    "s3:GetObject"
    ],
    "Resource": [
    "arn:aws:s3:::traffic-cop/*"
    ]
    }
    ]
}
</code></pre>
                <p>
                    Push the frontend to the bucket.
                </p>
                <pre class="language-bash"><code>aws s3 sync frontend/ s3://traffic-cop/
</code></pre>
                <h3>
                    Extras
                </h3>
                <p>
                    The
                    <code>
                        db_tools
                    </code>
                    can be used in order to add new entries to the DynamoDB instance manually while testing. To use it simply run
                    <code>
                        npm install
                    </code>
                    then
                    <code>
                        npm run test
                    </code>
                    . You will need to also change the DynamoDB instance name in
                    <code>
                        db_tools/test.js
                    </code>
                    first.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            amazon-cloudformation
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/amazon-dynamodb">
                                amazon-dynamodb
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            amazon-serverless
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/amazon-web-services">
                                amazon-web-services
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            aws-iot
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            serverless
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/t04glovern/traffic-cop" rel="nofollow" target="_blank" title="https://github.com/t04glovern/traffic-cop">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="http://traffic-cop.s3-website-us-east-1.amazonaws.com" rel="nofollow" target="_blank" title="http://traffic-cop.s3-website-us-east-1.amazonaws.com">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                traffic-cop.s3-website-us-east-1.amazonaws.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
