<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li class="text-center">
                        <a data-lightbox="761926" data-title="Our current, living test specimen" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/926/datas/original.jpg">
                            <img alt="DoomFurb &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/926/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Our current, living test specimen
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="761920" data-title="How you feel at the start of a hackathon" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/920/datas/original.jpg">
                            <img alt="DoomFurb &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/920/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                How you feel at the start of a hackathon
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="761917" data-title="SPI Data Line. (Blue is SCK, Yellow is Slave In, and Purple is Slave Out. " href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/917/datas/original.jpg">
                            <img alt="DoomFurb &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/917/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                SPI Data Line. (Blue is SCK, Yellow is Slave In, and Purple is Slave Out.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="761933" data-title="The 12 MHz clock line of the SPI bus during the initial load. To prevent aliasing, we used the maximum speed we had, 24MHz to read." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/933/datas/original.jpg">
                            <img alt="DoomFurb &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/933/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                The 12 MHz clock line of the SPI bus during the initial load. To prevent aliasing, we used the maximum speed we had, 24MHz to read.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="761929" data-title="SPI bus bootup script" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/929/datas/original.jpg">
                            <img alt="DoomFurb &ndash; screenshot 5" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/929/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                SPI bus bootup script
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="761930" data-title="Initial SPI Flash decoder response (Note that the chip is wrong. We're not sure if we're wrong or it is, but something is wrong!)" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/930/datas/original.jpg">
                            <img alt="DoomFurb &ndash; screenshot 6" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/930/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Initial SPI Flash decoder response (Note that the chip is wrong. We're not sure if we're wrong or it is, but something is wrong!)
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="761945" data-title="A single 256 bit page read" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/945/datas/original.PNG">
                            <img alt="DoomFurb &ndash; screenshot 7" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/761/945/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                A single 256 bit page read
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    If you've seen
                    <a href="https://www.reddit.com/r/itrunsdoom/" rel="nofollow">
                        Doom 1993 running on various platforms it was never intended to run on
                    </a>
                    , you'd know that the game can run with some very low system requirements, and most modern embedded hardware is more than sufficient.
                </p>
                <p>
                    On the flip side, modern toys are getting smarter. Hasbro's Furby Connect, released in 2016, has a decent processor, enough space, and two 128x128 LCD screens. More importantly,
                    <a href="https://github.com/Jeija/bluefluff" rel="nofollow">
                        some guy
                    </a>
                    discovered that the Bluetooth is completely unprotected. The plan is simple: compile Doom for the processor, upload to the Bluetooth as a firmware update, and play.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    Unfortunately, it's not quite that easy in practice. As of now, the Furby just laughs and farts.
                </p>
                <p>
                    The processor is 16 bits, and the NAND Flash is large enough to theoretically be able to store Doom, but we're still in the process of interfacing with the CPU. The processor itself is the GeneralPlus GPL162004A, which has it's own proprietary, wholly undocumented instruction set, u'nSP, which makes working with it a massive challenge.
                </p>
                <p>
                    The end goal is to have Doom displayed on the two 128x128 LCD eyes, and be controlled by the joystick antenna, but the first hurdle is finding a location and method to insert and run any form of executable code.
                </p>
                <h2>
                    How we built it
                </h2>
                <p>
                    We started by pulling down
                    <a href="https://github.com/swarley7/furbhax" rel="nofollow">
                        Furbhax
                    </a>
                    's initial work on reverse engineering the Furby's NAND Flash and SPI Flash chips. They had recovered a hex dump of the chips in a prior hackathon but did not have the time to reverse engineer beyond that. Using this as a starting point, we identified the memory mapping of the SoC and generated a control flow graph using a disassembler and static analysis.
                </p>
                <p>
                    Using a metastable rig and a logic anaylizer, we recorded the initial call to the SPI Flash during bootup. We hypothesized that since NAND Flash can only be read in pages, the Furby had to load some smaller segments of code or variables from the SPI Flash into RAM before it could be used. Since that data had to pass through the SPI bus, theoretically, if the executable code was loaded from SPI Flash, we would be able to see it.
                </p>
                <p>
                    After recovering the beginning of the code and several write packets, we compared the 256 bit writes segments to the SPI Flash data, and found the sum of the segments matched.
                </p>
                <p>
                    Somewhere in the process of having their central nervous systems removed, our beloved Ah-Tah and Tah-Lo passed away. No victory without sacrifice.
                </p>
                <h2>
                    Challenges we ran into
                </h2>
                <p>
                    Almost all hardware we were working with required either proprietary programmers we didn't have (like the processor) or an undocumented component (Like the LCDs AND the processor). The processor uses a proprietary and undocumented instruction set that we will have to write a disassembler for (who uses 16 bit chars anyway?).
                </p>
                <p>
                    Due to the fact that Furbies are consumer products that were never intented to be maintained in any way, there was a severe but understandable lack of exposed test points, which narrowed our reverse engineering attack vectors.
                </p>
                <h2>
                    Accomplishments that we're proud of
                </h2>
                <p>
                    Identifying how the firmware is mapped to memory to gain a starting point on reverse engineering the software.
                </p>
                <p>
                    In addition, we used a logic analyser to pull addresses from the Furby bootup script and relate it to the decompiled hex dump of the SPI Flash.
                </p>
                <p>
                    Its nothing tangible, but its an accomplishment and gets us closer to understanding furbish biomechanics.
                </p>
                <h2>
                    What we learned
                </h2>
                <ul>
                    <li>
                        <p>
                            Significant problems faced when interfacing with hardware buses, including signal aliasing giving improper values from the SPI line.
                        </p>
                    </li>
                    <li>
                        <p>
                            Without an interface to the processor, reprogramming is difficult, if not impossible.
                        </p>
                    </li>
                    <li>
                        <p>
                            Furbies are super annoying. Remove their speakers before beginning work.
                        </p>
                    </li>
                    <li>
                        <p>
                            Furbies turn off after 1 min of inactivity, but using solder to short the switch on the tail will cause them to fart indefinitely, keeping them on.
                        </p>
                    </li>
                </ul>
                <h2>
                    Quotes
                </h2>
                <ul>
                    <li>
                        "If you stare at hex for long enough, the answer will reveal itself. You just might not understand the answer." ~Scott
                    </li>
                    <li>
                        "I still don't think we know for absolutely sure what processor this actually is."  ~Sam, 1:00am Sunday
                    </li>
                    <li>
                        "Show me the Carmax!" - Both
                    </li>
                    <li>
                        "I think I highhandedly effected the market for second-hand furbies" - Scott, after spending $250 on 8 furbies
                    </li>
                    <li>
                        "Do you think we can get 60 fps on a Furby if we put a 1080ti in it?"
                    </li>
                </ul>
                <h2>
                    What's next for DoomFurb
                </h2>
                <p>
                    Buying a GeneralPlus Programmer to upload firmware and interface with the CPU.
                </p>
                <p>
                    Put more effort into reverse engineering the app that serves firmware updates, as well as the internals of those "furbware updates" themselves using a wireshark and some sort of proxy.
                </p>
                <p>
                    If, by chance, Furbies can be programmed through their unsecured bluetooth chips, that opens the possibility for furbies to reprogram each other. It might be possible, sometime in the future, to model pathogen spread by create a furby "virus" that infects one furby, and then that furby will reprogram and infect other furbies nearby.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            electrical-engineering
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            furby-connect
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            memes
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            reverse-engineering
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            selfloathing
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            staring-at-hex
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </body>
</html>
