<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/_8foFgXX45M?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="801262" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/801/262/datas/original.png">
                            <img alt="mongodb.codes &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/801/262/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    Full text search (FTS) in MongoDB is good enough until you have to search in collection that is big.
                </p>
                <p>
                    I learned it hard way, when my client product started to experience bad performance on database with ~1m records.
Instead of moving to other products like elastic or sphinxsearch -  I decided to give a look to FTS codebase.
                </p>
                <p>
                    Lucky me, mongodb hackathon started about the same time when I was looking to the code, so I decided to join it and spread a words about my project.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    My code changes focused on performance optimization for FTS queries. It is still experimental and it is not perfect. 
There is still many tasks to do. 
You can check the
                    <a href="https://github.com/mongodbcodes/mongo/wiki/Roadmap-for-FST" rel="nofollow">
                        roadmap
                    </a>
                    At the same time, current version already shows significant performance boost and decreased memory footprint.
                </p>
                <h2>
                    How I built it
                </h2>
                <p>
                    I started with code review to understand how it works at first place.
When I get confident with the code source and how it works, I started to change a code. 
At first I changed TEXT_OR stage. 
Then I added TEXT_AND, TEXT_NIN stages to perform operations on index even before data get into TEXT_MATCH
                </p>
                <h2>
                    Challenges I ran into
                </h2>
                <p>
                    The biggest challenge that I faced was an algorithm to advance (pass to up stage) a document record that has guarantee top score.
                </p>
                <p>
                    This is very important to speedup a limit based queries. 
We don't need to scan all indexes and docs to get only 10 or 1000 top records sorted by score.
                </p>
                <h2>
                    Accomplishments that I'm proud of
                </h2>
                <p>
                    I would prefer word "joy". I felt very happy when my codechanges finally started to show performance differences and perform without side effects.
Another happy moment happens, when I deployed new version to client server and we saw changes to performance right away.
                    <br>
                    Memory usage dropped at least 30% and queries time reduced from 14s to less than a second.
It was true moment of happiness.
                </p>
                <h2>
                    What I learned
                </h2>
                <p>
                    I become familiar with boost::multi_index and how I can use it to perform very fast ordering in memory to achieve high efficient  sorting, find and update.
                </p>
                <h2>
                    What's next for mongodb.codes
                </h2>
                <p>
                    As i said, I started to make the
                    <a href="https://github.com/mongodbcodes/mongo/wiki/Roadmap-for-FST" rel="nofollow">
                        roadmap
                    </a>
                    Mongodb 3.6 is getting old and porting code forward to 4.x is important.
Another interesting part is having multiple text indexes per collection.
Also using score sorted index for fast "not score based" requests is inefficient. 
I want to have index that have document id sort mode. 
It will help to boost FTS queries where phrases and limit used together.
                </p>
                <p>
                    My final goal is performance that can be competitive with elastic search.
Let's see if I get enough support to get there!
                </p>
                <h2>
                    About testing
                </h2>
                <p>
                    You can download latest release from
                    <a href="https://mongodb.codes" rel="nofollow">
                        mongodb.codes
                    </a>
                    and test it on your own database. Due to index compatibility, only mongod binary replacement is enough to test on your collection. As long as you run 3.6.11 version.
                </p>
                <p>
                    I am still working on updates, so there is will be more releases before deadline and after.
                </p>
                <p>
                    I setup custom server to make it easy to test a difference in performance. 
Also I created a repo with test code that connect to this server and run queries. 
You can find code
                    <a href="https://github.com/mongodbcodes/hackathon" rel="nofollow">
                        here
                    </a>
                    You will find all instructions in readme file of this repo.
                </p>
                <p>
                    Thank you for your attention.
Best Regards,
Gor Martsen
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/c--3">
                                c++
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://mongodb.codes" rel="nofollow" target="_blank" title="https://mongodb.codes">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                mongodb.codes
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/mongodbcodes/hackathon" rel="nofollow" target="_blank" title="https://github.com/mongodbcodes/hackathon">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
