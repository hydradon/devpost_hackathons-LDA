<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div>
                <h1>
                    How to Rails
                </h1>
                <h3>
                    Create the app
                </h3>
                <pre class="language-bash"><code>$ rails new imageshare
$ cd imageshare
</code></pre>
                <h3>
                    Adding gems
                </h3>
                <p>
                    Add the following to your Gemfile
                </p>
                <pre class="language-ruby"><code>gem 'bootstrap-sass'
gem 'bcrypt', '~&gt; 3.1.7'
gem 'devise'
gem 'paperclip'
gem 'pg'
</code></pre>
                <h3>
                    Creating databases
                </h3>
                <p>
                    Edit your config/database.yml file to look like the following
                </p>
                <pre class="language-ruby"><code># SQLite version 3.x
#   gem install sqlite3
#
#   Ensure the SQLite 3 gem is defined in your Gemfile
#   gem 'sqlite3'
#
default: &amp;default
adapter: postgresql
pool: 5
timeout: 5000

development:
&lt;&lt;: *default
database: imageshare_dev

# Warning: The database defined as "test" will be erased and
# re-generated from your development database when you run "rake".
# Do not set this db to the same as development or production.
test:
&lt;&lt;: *default
database: imageshare_test

production:
&lt;&lt;: *default
database: imageshare_prod
</code></pre>
                <p>
                    Then run the following commands
                </p>
                <pre class="language-bash"><code>$ bundle install
$ rake db:create
</code></pre>
                <h3>
                    Creating the User model
                </h3>
                <p>
                    We're not gonna bother with Devise for this, since it's too restrictive for our purposes
                </p>
                <pre class="language-bash"><code>$ rails g model User first_name:string last_name:string email:string username:string password_digest:string dob:date
$ rake db:migrate
</code></pre>
                <h3>
                    Creating sessions
                </h3>
                <p>
                    Navigate to /app/controllers/application_controller.rb and edit it to look like the following
                </p>
                <pre class="language-ruby"><code>class ApplicationController &lt; ActionController::Base
                protect_from_forgery with: :exception

    helper_method :current_user

    def current_user
    @current_user ||= User.find(session[:user_id]) if session[:user_id]
    end

    def authorize
    redirect_to login_path unless current_user
    end
end
</code></pre>
                <p>
                    Then create a sessions controller
                </p>
                <pre class="language-bash"><code>$ rails g controller sessions new create destroy
</code></pre>
                <p>
                    In your new sessions controller (located at /app/controllers/sessions_controller.rb), edit it to look like the following
                </p>
                <pre class="language-ruby"><code>class SessionsController &lt; ApplicationController
        def new
  end

  def create
  user = User.find_by_username(params[:username])
  if user &amp;&amp; user.authenticate(params[:password])
  session[:user_id] = user.id
  redirect_to root_path
  else
  redirect_to login_path
  end
  end

  def destroy
  session[:user_id] = nil
  redirect_to login_path
  end
end
</code></pre>
                <p>
                    To log in a user, you have to create a user session. What the code for the create method does is find a user with the username, uses a helper method built into the User model through bcrypt's has_secure_password (which we'll get to later), then if the user exists and is successfully authenticated, the user will have a session, and the app will redirect to its root path, which we'll also get to later.
                </p>
                <p>
                    After that, create a users controller.
                </p>
                <pre class="language-bash"><code>$ rails g controller users new create destroy
</code></pre>
                <p>
                    In your new users controller (located at /app/controllers/users_controller.rb), edit it to look like the following.
                </p>
                <pre class="language-ruby"><code>class UsersController &lt; ApplicationController
                def index
                @users = User.all
    end

    def new
    end

    def create
    user = User.new(user_params)
    if user.save
    session[:user_id] = user.id
    redirect_to root_path
    else
    redirect_to signup_path
    end
    end

    private
    def user_params
    params.require(:user).permit(
    :username,
    :first_name,
    :last_name,
    :email,
    :dob,
    :password,
    :password_confirmation
    )
    end
end
</code></pre>
                <p>
                    The index method indicates necessary code for when the /app/views/users/index.html.erb page is shown.  After that page is implemented, when the user navigates to localhost:3000/users, the user will be able to see a list of users, because they have access to a variable that displays all users.  For the new method, that essentially just takes from create for the purpose of this controller.  For the create method, a new user is created from the given permitted parameters in the user_params method.  If the user is saved, the user will automatically be logged in and redirected to the root path.  Otherwise they'll just be redirected to signup.  Finally, the user_params method is just a method that allows for only certain fields to be passed in through a form so hackers don't try to inject SQL or something.
                </p>
                <p>
                    Next, navigate to /app/models/user.rb and add the following line inside the User class
                </p>
                <pre class="language-ruby"><code>has_secure_password
</code></pre>
                <p>
                    This comes from the bcrypt gem we added to our gemfile. This stores a password digest, an encrypted version of the password, in the database, so even if a hacker gets access to your database, they'd still have to decrypt the passwords to make any sense of it. This also adds the authenticate helper method to verify a user with a password.
                </p>
                <p>
                    Now we want to make a view such that users can actually sign up for this app.
Navigate to /app/views/users/new.html.erb and edit it to look like the following
                </p>
                <pre class="language-ruby"><code>&lt;%= form_for :user, url: '/users' do |f| %&gt;
                First Name: &lt;%= f.text_field :first_name %&gt;&lt;br /&gt;
    Last Name: &lt;%= f.text_field :last_name %&gt;&lt;br /&gt;
    Username &lt;%= f.text_field :username %&gt;&lt;br /&gt;
    Email: &lt;%= f.text_field :email %&gt;&lt;br /&gt;
    Date of Birth: &lt;%= f.date_select :dob, :start_year =&gt; Date.today.year - 100, :end_year =&gt; Date.today.year %&gt;&lt;br /&gt;
    Password: &lt;%= f.password_field :password %&gt;&lt;br /&gt;
    Password Confirmation: &lt;%= f.password_field :password_confirmation %&gt;&lt;br /&gt;
    &lt;%= f.submit "Sign Up" %&gt;
&lt;% end %&gt;
</code></pre>
                <p>
                    This creates a form, allows for users to add in each of the required fields to create a user, and submits it.  Upon submission, it will call the create method from the users controller and go through that code to create the user.
                </p>
                <p>
                    Now that a user can sign up, we want a way for them to log in as well.  So we're gonna navigate to /app/views/sessions/new.html.erb and create a login view.
                </p>
                <pre class="language-ruby"><code>&lt;h1&gt;Login&lt;/h1&gt;

&lt;%= form_tag '/login' do %&gt;

Email: &lt;%= text_field_tag :email %&gt;
Password: &lt;%= password_field_tag :password %&gt;
&lt;%= submit_tag "Submit" %&gt;

&lt;% end %&gt;
</code></pre>
                <p>
                    This routes the submission to the login path, which will be defined in config/routes.rb as sessions#create, which will call the create method in the sessions controller and create a user session.
                </p>
                <p>
                    Now, just so that users have somewhere to navigate to and so that we have an adequate root page, 
Finally, you need to add your new routes such that everything will point to the right thing.  Navigate to /config/routes.rb and edit it to look like the following.
                </p>
                <pre class="language-ruby"><code>Rails.application.routes.draw do
                get '/dashboard' =&gt; 'pages#dashboard'
    get '/tutorial' =&gt; 'pages#tutorial'

    root 'pages#dashboard'

    get '/login' =&gt; 'sessions#new'
    post '/login' =&gt; 'sessions#create'
    get '/logout' =&gt; 'sessions#destroy'

    get '/signup' =&gt; 'users#new'
    post '/users' =&gt; 'users#create'
end
</code></pre>
                <p>
                    This essentially says "when the user navigates to /dashboard, it will link to the Rails route described by the command 'rake routes' as 'pages#dashboard'.  It essentially renames the routes to those pages to something more user-friendly." Speaking of user-friendly, open up /app/views/layouts/application.html.erb and add the following in the  tags.
                </p>
                <pre class="language-ruby"><code>&lt;% if current_user %&gt;
                Signed in as &lt;%= current_user.username %&gt; | &lt;%= link_to "Logout", logout_path %&gt;
&lt;% else %&gt;
&lt;%= link_to 'Login', login_path %&gt; | &lt;%= link_to 'Signup', signup_path %&gt;
&lt;% end %&gt;
</code></pre>
                <p>
                    Therefore, on every page, you will be able to login and logout. Stuff in application.html.erb will be visible and accessible everywhere in the web app. Now we need to one last thing. Go back to your terminal and type the following.
                </p>
                <pre class="language-bash"><code>$ rails g controller pages dashboard tutorial
</code></pre>
                <p>
                    And now you have all the pages you need!  Just run 'rails s' and you'll have your user model and authentication working!
                </p>
                <h3>
                    Adding a user avatar
                </h3>
                <p>
                    This is an image sharing website, right? Wouldn't it only be right for a user to have a profile picture?  Let's make that now.
                </p>
                <pre class="language-bash"><code>$ rails g migration AddAvatarToUsers
</code></pre>
                <p>
                    For this one, we're gonna manually write the migration for this. Navigate to /db/migrate/_add_avatar_to_users.rb, and then edit it to look like the following.
                </p>
                <pre class="language-ruby"><code>class AddAvatarToUsers &lt; ActiveRecord::Migration[5.0]
        def self.up
        change_table :users do |t|
        t.attachment :avatar
        end
  end

  def self.down
  drop_attached_file :users, :avatar
  end
end
</code></pre>
                <p>
                    Self.up tells Rails what to do when the attachment is created.  It adds a field of type attachment called avatar to the users table.  Conversly, self.down tells Rails what to do when the attachment is destroyed, it just drops the field from the table.  Now that you've changed the database schema, you need to migrate your database.
                </p>
                <pre class="language-bash"><code>$ rake db:migrate
</code></pre>
                <p>
                    Next, we need to update the model to accept and validate an attachment, as the Paperclip gem requires.  Navigate back to /app/models/user.rb, and beneath 'has_secure_password', add the following lines.
                </p>
                <pre class="language-ruby"><code>has_attached_file :avatar, :styles =&gt; { :medium =&gt; "300x300&gt;", :thumb =&gt; "100x100#" }, :default_url =&gt; "/images/404.jpg"
validates_attachment_content_type :avatar, :content_type =&gt; ["image/jpg", "image/jpeg", "image/png", "image/gif"]
</code></pre>
                <p>
                    Now that the model has been updated, we need to update the controller and the view to allow for a user to upload an avatar.  So remember the users_controller.rb file we edited earlier?  We need to add another field to the user_params method.
                </p>
                <p>
                    Navigate to /app/controllers/users_controller.rb and edit the user_params method such that it looks like this.
                </p>
                <pre class="language-ruby"><code>def user_params
                params.require(:user).permit(
                :username,
                :first_name,
                :last_name,
                :email,
                :dob,
                :password,
                :password_confirmation,
                :avatar
                )
end
</code></pre>
                <p>
                    The avatar field needs to be allowed by the users controller within the permitted parameters. Finally, you need to add an avatar field to the view so a user can actually interact with that field. We're gonna go back into /app/views/users/new.html and plop in a file field.
                </p>
                <pre class="language-ruby"><code>&lt;%= form_for :user, url: '/users' do |f| %&gt;
                First Name: &lt;%= f.text_field :first_name %&gt;&lt;br /&gt;
    Last Name: &lt;%= f.text_field :last_name %&gt;&lt;br /&gt;
    Username &lt;%= f.text_field :username %&gt;&lt;br /&gt;
    Avatar: &lt;%= f.file_field :avatar, :accept =&gt; 'image/png,image/gif,image/jpeg'  %&gt;&lt;br /&gt;
    Email: &lt;%= f.text_field :email %&gt;&lt;br /&gt;
    Date of Birth: &lt;%= f.date_select :dob, :start_year =&gt; Date.today.year - 100, :end_year =&gt; Date.today.year %&gt;&lt;br /&gt;
    Password: &lt;%= f.password_field :password %&gt;&lt;br /&gt;
    Password Confirmation: &lt;%= f.password_field :password_confirmation %&gt;&lt;br /&gt;
    &lt;%= f.submit "Sign Up" %&gt;
&lt;% end %&gt;
</code></pre>
                <p>
                    Now your user signup and authentication should be ready to go!
                </p>
                <h3>
                    Set up image uploads
                </h3>
                <p>
                    It's back to the console to generate the model.
                </p>
                <pre class="language-bash"><code>$ rails g model Image img:attachment title:string caption:string user_id:integer
$ rake db:migrate
</code></pre>
                <p>
                    Now that you have an Image table in the database, you can fix up the models such that you can access an image's user through image.user and a user's images through user.images!
Navigate to /app/models/user.rb and append the following line within the User class.
                </p>
                <pre class="language-ruby"><code>has_many :images
</code></pre>
                <p>
                    Next, navigate to /app/models/image.rb and add the following lines within the Image class
                </p>
                <pre class="language-ruby"><code>belongs_to :user
has_attached_file :img, :styles =&gt; { :medium =&gt; "300x300&gt;", :thumb =&gt; "100x100#" }, :default_url =&gt; "/images/404.jpg"
validates_attachment_content_type :img, :content_type =&gt; ["image/jpg", "image/jpeg", "image/png", "image/gif"]
</code></pre>
                <p>
                    This creates the relationship between Image and User, and validates the image, as is necessary with the Paperclip gem.
After that, create a new file as /app/controllers/images_controller.rb and edit it to look like the following.
                </p>
                <pre class="language-ruby"><code>class ImagesController &lt; ApplicationController
                before_action :authorize

    def new
    @image = Image.new
    end

    def show
    @image = Image.find(params[:id])
    end

    def create
    @image = Image.new image_params
    @image.user_id = current_user.id
    if @image.save
    redirect_to root_path
    else
    redirect_to new_image_path
    end
    end

    def destroy
    @image = Image.find(params[:id])
    if image.destroy
    redirect_to root_path
    else
    redirect_to image_path(image.id)
    end
    end

    protected
    def image_params
    params.require(:image).permit(
    :title,
    :img,
    :caption,
    :user_id
    )
    end
end
</code></pre>
                <p>
                    Next, add the following line to /config/routes.rb.
                </p>
                <pre class="language-ruby"><code>resources :images
</code></pre>
                <p>
                    What this does is generate the necessary routes you specified in the controller once you run the
                    <code>
                        rake routes
                    </code>
                    command.
                </p>
                <p>
                    To make use of this model and controller, we need views to create the items. Create a new file as /app/views/images/new.html.erb and edit the form to look like so.
                </p>
                <pre class="language-ruby"><code>&lt;h1&gt;Upload an image&lt;/h1&gt;

&lt;%= form_for :image, url: "/images" do |f| %&gt;
Title &lt;%= f.text_field :title %&gt;&lt;br /&gt;
Image: &lt;%= f.file_field :img, :accept =&gt; 'image/png,image/gif,image/jpeg'  %&gt;&lt;br /&gt;
Caption: &lt;%= f.text_field :caption %&gt;&lt;br /&gt;
&lt;%= f.submit "Upload" %&gt;
&lt;% end %&gt;
</code></pre>
                <p>
                    In the convention of
                    <code>
                        resources :images
                    </code>
                    , the "/images" URL is routed to posting a new image and run the create method from the images controller. Next, we wanna be able to show some information about an image when we link to it. Create a new file /app/views/images/show.html.erb.
                </p>
                <pre class="language-ruby"><code>&lt;h1&gt;&lt;%= @image.title %&gt;&lt;/h1&gt;
&lt;p&gt;Uploaded by: &lt;%= link_to @image.user.username, users_path(@image.user) %&gt;&lt;/p&gt;
&lt;p&gt;&lt;%= image_tag(@image.img) %&gt;
&lt;p&gt;&lt;%= @image.caption %&gt;&lt;/p&gt;
</code></pre>
                <p>
                    This will pull in the @image instance variable we created in the show method in the images controller and gather its information to display.
                </p>
                <p>
                    Finally, we want to fix the dashboard so that it will show a user's images and display a button that will allow you to navigate to the image upload page.
Add the following lines to /app/views/pages/dashboard.html.erb
                </p>
                <pre class="language-ruby"><code>&lt;h2&gt;&lt;%= current_user.first_name %&gt;'s images&lt;/h2&gt;
&lt;%= button_to "Upload an image", new_image_path, method: :get %&gt;
&lt;% current_user.images.each do |image| %&gt;
&lt;p&gt;&lt;%= link_to image_tag(image.img.url(:thumb)), image_path(image) %&gt;&lt;/p&gt;
&lt;% end %&gt;
</code></pre>
                <p>
                    And there you have it, you have a working image upload functionality!
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/coffeescript">
                                coffeescript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/css">
                                css
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/html">
                                html
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/javascript">
                                javascript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/ruby">
                                ruby
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/MarwanNakhaleh/imageshare" rel="nofollow" target="_blank" title="https://github.com/MarwanNakhaleh/imageshare">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
