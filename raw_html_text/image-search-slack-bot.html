<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/uadod2VqLNM?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    AWS_Lambda_ChatBot
                </h1>
                <h2>
                    Description
                </h2>
                <p>
                    This code is the Image search bot for slack.
Image is support to understand the unknown contents.
                </p>
                <p>
                    This code made for the below contest.
                </p>
                <p>
                    <a href="https://awschatbot.devpost.com/" rel="nofollow">
                        https://awschatbot.devpost.com/
                    </a>
                </p>
                <h3>
                    Install
                </h3>
                <h4>
                    Enviroments Setting
                </h4>
                <p>
                    If you easy to create the instance , you install the terraform
                </p>
                <pre class="language-nolang"><code>https://www.terraform.io/intro/getting-started/install.html
</code></pre>
                <p>
                    If you easy to set up the enviroments, you install the ansible
                </p>
                <pre class="language-nolang"><code>http://docs.ansible.com/ansible/intro_installation.html
</code></pre>
                <p>
                    You install the MySQL
                </p>
                <p>
                    <a href="https://www.tutorialspoint.com/mysql/mysql-installation.htm" rel="nofollow">
                        https://www.tutorialspoint.com/mysql/mysql-installation.htm
                    </a>
                </p>
                <p>
                    You install the Vagrant
                </p>
                <p>
                    <a href="https://www.vagrantup.com/docs/installation/" rel="nofollow">
                        https://www.vagrantup.com/docs/installation/
                    </a>
                </p>
                <p>
                    If you make the data set fastest, you install the parallel
                </p>
                <p>
                    <a href="https://www.gnu.org/software/parallel/" rel="nofollow">
                        https://www.gnu.org/software/parallel/
                    </a>
                </p>
                <h4>
                    Python Enviroments Setting
                </h4>
                <p>
                    Python Versions below
                </p>
                <pre class="language-nolang"><code>Python 3.5.0
</code></pre>
                <p>
                    Python Library install
                </p>
                <pre class="language-nolang"><code>pip install requirements.txt
</code></pre>
                <p>
                    MySQL python wrapper install
                </p>
                <p>
                    GEt the source code latest versions
                    <a href="http://dev.mysql.com/downloads/connector/python/" rel="nofollow">
                        http://dev.mysql.com/downloads/connector/python/
                    </a>
                </p>
                <p>
                    Install the mysql for python
                </p>
                <pre class="language-nolang"><code>    cd {your} download directory
                tar xzf mysql-connector-python-VER.tar.gz
    cd mysql-connector-python-VER
    sudo python setup.py install
</code></pre>
                <h4>
                    Prepare the Data
                </h4>
                <p>
                    Prepare the Wikipedia data.
                </p>
                <p>
                    It is possible to get the abstract data and image data below site.
                </p>
                <p>
                    <a href="https://archive.org/download/enwiki-20080312" rel="nofollow">
                        WikiPedia
                    </a>
                    <br>
                </p>
                <p>
                    Abstract Data is below
                </p>
                <pre class="language-nolang"><code>enwiki-20080312-abstract.xml
</code></pre>
                <p>
                    Image data is below
                </p>
                <pre class="language-nolang"><code>enwiki-20080312-imagelinks.sql
</code></pre>
                <p>
                    You use the above the sql for make the wikipedia image database.
But the above the sql doesn't work for syntax error.
You have to remove the "TYPE=InnoDB;"
                </p>
                <pre class="language-nolang"><code>1: create database enwiki
2: use enwiki
2: source enwiki-20080312-imagelinks.sql
</code></pre>
                <p>
                    Create folder for the data
                </p>
                <pre class="language-nolang"><code>mkdir -p {your git clone folder}/Data/wiki_image/
</code></pre>
                <p>
                    You set the abstract data above folder
                </p>
                <pre class="language-nolang"><code>mv enwiki-20080312-abstract.xml {your git clone folder}/Data/wiki_image/
</code></pre>
                <p>
                    You exetuce the below command
It take a long time.
                </p>
                <pre class="language-nolang"><code>python execute_wiki_pedia_xml_to_json.py -xml enwiki-20080312-abstract.xml -img True
</code></pre>
                <p>
                    If you already install the parallel command, you execute the below command.
Because the below code is faster than above.
It also take a long time.
                </p>
                <pre class="language-nolang"><code>parallel --linebuffer -j {40-100(you adjustment)} :::: jobs.txt
</code></pre>
                <p>
                    "jobs.txt" is the below
                </p>
                <pre class="language-nolang"><code>python execute_wiki_pedia_xml_to_json.py -xml enwiki-20080312-abstract.xml -img True
</code></pre>
                <h3>
                    Usage
                </h3>
                <h4>
                    Local Setting
                </h4>
                <p>
                    If you already prepare the json data set, you move the json data the below folder
                </p>
                <pre class="language-nolang"><code>mkdir -p {your git clone folder}/docker/data/wiki_image
mv {your git clone folder}/Data/wiki_image/*.json {your git clone folder}/docker/data/wiki_image
</code></pre>
                <p>
                    You conpress the data
                </p>
                <pre class="language-nolang"><code>gzip {your git clone folder}/docker/data/wiki_image/*.json
</code></pre>
                <p>
                    You have to set the ip address
                </p>
                <pre class="language-nolang"><code>  config.vm.network "private_network", ip: "192.168.33.xx"
</code></pre>
                <p>
                    You run the vagrant
                </p>
                <pre class="language-nolang"><code>vagrant up
</code></pre>
                <p>
                    Docker install process below
                </p>
                <p>
                    <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/" rel="nofollow">
                        https://docs.docker.com/engine/installation/linux/ubuntulinux/
                    </a>
                </p>
                <p>
                    If you use the setting the ansible you execute the below command
                </p>
                <pre class="language-nolang"><code>cd {your git clone folder}/ansible_setting
ansible-playbook -i vagrant_host vagrant_lambda_docker.yml
</code></pre>
                <p>
                    Build the docker image
                </p>
                <pre class="language-nolang"><code>cd /home/vagrant/AWS_Lambda_Chatbot/docker
make test-elasticsearch-english
</code></pre>
                <p>
                    Escape the docker container
                </p>
                <pre class="language-nolang"><code>exit
</code></pre>
                <p>
                    Tag the docker image
Because it is easy to understand the container mean
                </p>
                <pre class="language-nolang"><code>docker tag {docker elasticsearch image} elasticsearch_english
</code></pre>
                <p>
                    You start the elasticsearch container and regist data
                </p>
                <pre class="language-nolang"><code>cd {your git clone folder}/Question_Answer
sh elastic_start_english.sh [PIPE_NUMBER] [PARALLEL_NUMBER] [IMAGE_FLAG (True or False)] [ELS_IMAGE_NAME]
example)
sh elastic_start_english.sh 1 5 True elasticsearch_english
</code></pre>
                <p>
                    You have to push the container your docker hub
                </p>
                <pre class="language-nolang"><code>docker login
docker tag elasticsearch_english:latest {your docker repository name}:{tag name}
docker push {your docker repository name}:{tag name}
</code></pre>
                <h4>
                    Instance Setting
                </h4>
                <p>
                    You create the instance
Amazon Machine Image (AMI): Ubuntu
Choose an Instance Type:t2.micro
Security Groups:you have to open the 9200 port for the elasticsearch
                </p>
                <p>
                    <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html" rel="nofollow">
                        http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html
                    </a>
                </p>
                <p>
                    If you use the terraform, you execute the below command
                </p>
                <pre class="language-nolang"><code>cd {your git clone folder}/terraform
terraform plan
terraform apply
</code></pre>
                <p>
                    Docker enviroment setting
                </p>
                <p>
                    <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/" rel="nofollow">
                        https://docs.docker.com/engine/installation/linux/ubuntulinux/
                    </a>
                </p>
                <p>
                    If you use the setting the ansible you execute the below command
you edit the ip address your instance
                    <code>
                        aws_lambda_chatbot_host
                    </code>
                </p>
                <pre class="language-nolang"><code>cd {your git clone folder}/ansible_setting
ansible-playbook -i aws_lambda_chatbot_host aws_lambda_chatbot.yml
</code></pre>
                <p>
                    Access the instance
                </p>
                <pre class="language-nolang"><code>ssh -i {your key} ubuntu@{your ip address}
</code></pre>
                <p>
                    You get the docker image
                </p>
                <pre class="language-nolang"><code>docker login
docker pull {your docker repository name}:{tag name}
</code></pre>
                <p>
                    You get the elasticsearch start command
                </p>
                <pre class="language-nolang"><code>git clone https://github.com/SnowMasaya/AWS_Lambda_ChatBot.git
</code></pre>
                <p>
                    You execute the below command
It is confirm the elasticsearch container is runnning
                </p>
                <pre class="language-nolang"><code>cd {your git clone folder}/Question_Answer
sh elastic_start_english.sh [PIPE_NUMBER] [PARALLEL_NUMBER] [IMAGE_FLAG (True or False)] [ELS_IMAGE_NAME]
example)
sh elastic_start_english.sh 1 5 True elasticsearch_english
</code></pre>
                <h3>
                    Lambda Setting
                </h3>
                <p>
                    If you use the Lambda for slack bot, you read the below link.
I explain the how to use the lambda function for slack bot.
                </p>
                <p>
                    <a href="http://qiita.com/GushiSnow/private/0f69cab874aa8ea4a859" rel="nofollow">
                        http://qiita.com/GushiSnow/private/0f69cab874aa8ea4a859
                    </a>
                </p>
                <h3>
                    Code Directory Structure
                </h3>
                <pre class="language-nolang"><code>AWS Lambda Chat Bot Hackthon
        - Question_Answer/　　　　... Question and Answer code
  - slack/　　　　　        ... Lambda function code for slack bot
  - docker/　　　　         ... Setting the container
  - ansible_setting/　　　　... Setting the environment code
  - terraform/　　　　      ... Create the instance
</code></pre>
                <h3>
                    Licence
                </h3>
                <pre class="language-nolang"><code>The MIT License (MIT)

Copyright (c) 2016 Yumi Hamazono

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
</code></pre>
                <h3>
                    Author
                </h3>
                <p>
                    <a href="https://github.com/SnowMasaya" rel="nofollow">
                        SnowMasaya
                    </a>
                </p>
                <h3>
                    References
                </h3>
                <blockquote>
                    <p>
                        <a href="https://awschatbot.devpost.com/" rel="nofollow">
                            AWS_Lambda_ChatBot
                        </a>
                        <br>
                        <a href="https://archive.org/download/enwiki-20080312" rel="nofollow">
                            WikiPedia
                        </a>
                        <br>
                        <a href="https://www.terraform.io/intro/getting-started/install.html" rel="nofollow">
                            Install Terraform
                        </a>
                        <br>
                        <a href="http://docs.ansible.com/ansible/intro_installation.html" rel="nofollow">
                            Ansible Installation
                        </a>
                        <br>
                        <a href="https://www.tutorialspoint.com/mysql/mysql-installation.htm" rel="nofollow">
                            MySQL Installation
                        </a>
                        <br>
                        <a href="https://www.vagrantup.com/docs/installation/" rel="nofollow">
                            Installing Vagrant
                        </a>
                        <br>
                        <a href="http://dev.mysql.com/downloads/connector/python/" rel="nofollow">
                            Download Connector/Python
                        </a>
                        <br>
                        <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/" rel="nofollow">
                            Docker Ubuntu Install
                        </a>
                    </p>
                </blockquote>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/amazon-web-services">
                                amazon-web-services
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/elasticsearch">
                                elasticsearch
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            lambda
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/SnowMasaya/AWS_Lambda_ChatBot" rel="nofollow" target="_blank" title="https://github.com/SnowMasaya/AWS_Lambda_ChatBot">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
