<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/69FSXCnnmzE?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="399505" data-title="Back injuries can result from improper form such as rounding the back and not squatting low enough." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/399/505/datas/original.png">
                            <img alt="IoT Back Brace &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/399/505/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Back injuries can result from improper form such as rounding the back and not squatting low enough.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="400977" data-title="Device readings are sent to the cloud where they are categorized using a machine learning algorithm, and then finally surfaced in reporting." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/400/977/datas/original.png">
                            <img alt="IoT Back Brace &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/400/977/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Device readings are sent to the cloud where they are categorized using a machine learning algorithm, and then finally surfaced in reporting.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402009" data-title="The back brace device prototype!" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/009/datas/original.JPG">
                            <img alt="IoT Back Brace &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/009/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                The back brace device prototype!
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="402659" data-title="Readings from the Arduino are posted to a REST Web API via WiFi.  Spark Streaming then goes into action classifying the posture." href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/659/datas/original.PNG">
                            <img alt="IoT Back Brace &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/402/659/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Readings from the Arduino are posted to a REST Web API via WiFi.  Spark Streaming then goes into action classifying the posture.
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="403374" data-title="Check out the demo dashboard at http://sandbox.mycontraption.com/iotbb" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/403/374/datas/original.PNG">
                            <img alt="IoT Back Brace &ndash; screenshot 5" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/403/374/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Check out the demo dashboard at http://sandbox.mycontraption.com/iotbb
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    Every year back injuries cost American companies billions of dollars in worker's comp claims, lost productivity, and insurance premium increases.  According to the U.S. Bureau of Labor Statistics, back injuries are the number one cause of injuries incurred at work and impacts over 1 million workers every year.  Many of these injuries are caused by improper lifting techniques such as stooping or bending to pick up objects or repeating certain movements, especially those that involve twisting or rotating the spine while lifting.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    The IoT Back Brace is a device that helps identify - and report - activities that could potentially cause back injuries such as stooping, bending, and twisting.  This is accomplished by continually monitoring the posture of a person... with an embedded microcontroller, gyroscope, and accelerometer.  Although it is impossible to have perfect posture all of the time this device allows you to track the number of movements that are classified as potentially harmful.
The back brace has an embedded Microcontroller outfitted with an Accelerometer/Gyroscope  that continuously measures the posture of the person wearing it.  Any activities that cause stooping or bending results in a reading being sent to a web API that then logs the reading through some back-end processing using the Apache Spark ecosystem (Spark Streaming, Spark SQL, and Spark Machine Learning).
                </p>
                <h2>
                    How I built it
                </h2>
                <h3>
                    The Brace Device
                </h3>
                <p>
                    The device (currently in prototype) can be attached to any existing back brace/belt and is made with the following components:
                </p>
                <ul>
                    <li>
                        Arduino Nano Microcontroller
                    </li>
                    <li>
                        GY-521 Accelerometer/Gyroscope IMU
                    </li>
                    <li>
                        ESP8266 Serial WiFi Module
                    </li>
                </ul>
                <h3>
                    The Back-End
                </h3>
                <ul>
                    <li>
                        Web API:  Python Flask script
                    </li>
                    <li>
                        Message Handling:  Apache Kafka Message Broker
                    </li>
                    <li>
                        Processing, Classification, and Database actions:  Apache Spark
                    </li>
                    <li>
                        Database:  MySQL
                    </li>
                </ul>
                <h3>
                    Reporting Dasbhoard
                </h3>
                <ul>
                    <li>
                        PHP and MySQL are utilized for the data layer.
                    </li>
                    <li>
                        AngularJS and HighCharts are used for the single-page dashboard.
                    </li>
                </ul>
                <h2>
                    The Process
                </h2>
                <p>
                    The process of reporting these metrics combines a wide range of open source technologies from the small Arduino microcontroller to Big Data and Machine Learning engines like Apache Spark.
                </p>
                <p>
                    As the posture of the person wearing the brace changes, an event is triggered, and a message containing the device readings is sent to the cloud where it is logged and categorized using a machine learning algorithm, and then finally those measurements are aggregated and surfaced in reporting.
                </p>
                <h2>
                    The Process Amplified!
                </h2>
                <p>
                    Although this process seems very simple on the surface, in order for it to be successful on an enterprise scale there needs to be some key technologies at play.  Imagine a company with multiple locations - and dozens of braces - all reporting simultaneous events.  The back-end processing for this deployment would require low-latency response time as well as "near-real-time" reporting for management.  This back-end engine would also require easy scaling as they grow or expand the program.
                </p>
                <p>
                    So in order to ensure packets are not lost we have employed the use of a Kafka Messaging cluster.  Each message containing the reading values is sent to the Kafka cluster through a REST API.  This message is held in queue until the processing engine is ready to receive it.  The processing engine in this case is provided by Apache Spark Streaming.  With Spark Streaming, messages are opened and processed in a near continuous manner.  The great thing about Spark is the processing is distributed amongst multiple nodes so if more speed is required the environment can easily be scaled to fit the requirements.
                </p>
                <h2>
                    Classification on the Fly using Machine Learning
                </h2>
                <p>
                    Apache Spark also provides an excellent machine learning library.  In this case we are using a Random Forest classification model which is essentially an ensemble of decision trees that avoid over-fitting by averaging the results.  The model is trained by sending known postures and their corresponding device readings.  Through this training, thresholds are determined and a model is developed to translate posture measurements (which are numeric values to positions (such as &ldquo;Stooping&rdquo;, &ldquo;Bending&rdquo;, or &ldquo;Upright&rdquo;).
                </p>
                <h2>
                    Key Files in the Process (All can be found on GitHub)
                </h2>
                <table class="responsive">
                    <thead>
                        <tr>
                            <th>
                                Directory
                            </th>
                            <th>
                                File Name
                            </th>
                            <th>
                                Description
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                data_collection
                            </td>
                            <td>
                                <a href="https://github.com/kringen/IOT-Back-Brace/blob/master/data_collection/ProcessSensorReadings.py" rel="nofollow">
                                    ProcessSensorReadings.py
                                </a>
                            </td>
                            <td>
                                Creates a Spark Streaming job that reads messages from Kafka, then either treats as training data or actual data.  Then writes the data to MySQL database.
                            </td>
                        </tr>
                        <tr>
                            <td>
                                web_api
                            </td>
                            <td>
                                <a href="https://github.com/kringen/IOT-Back-Brace/blob/master/web_api/webServiceToKafka.py" rel="nofollow">
                                    WebServiceToKafka.py
                                </a>
                            </td>
                            <td>
                                REST service that listens for POST requests and creates a Kafka message.
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Testing
                            </td>
                            <td>
                                <a href="https://github.com/kringen/IOT-Back-Brace/blob/master/testing/kafkaProducerTest.py" rel="nofollow">
                                    KafkaProducerTest.py
                                </a>
                            </td>
                            <td>
                                Creates random readings and sends in JSON format to Kafka.  Use this to test the data collection process
                            </td>
                        </tr>
                    </tbody>
                </table>
                <blockquote>
                    <p>
                        Note:  Look for the corresponding Jupyter Notebooks for these files for better explanation and a walk-through of the logic employed in this project.
                    </p>
                </blockquote>
                <h2>
                    Challenges I ran into
                </h2>
                <p>
                    Since Spark is a distributed environment and operates on RDD's or distributed datasets, I often found myself trying to do tasks that would result in an error.  And the error messages were often very long and sometimes hard to interpret.  However, as I hacked away at the problem areas, I discovered that the root cause was usually my lack of understanding of what I was working with...  Was it an RDD, a Pipelined RDD, a DataFrame, or even a Row within the DataFrame?  Once I was able to work that out - And with the help of some good examples online - I was able to break through those sticking points.
                </p>
                <p>
                    Additionally, with the limited memory capacity of the Arduino, I had a very difficult time integrating the readings into String variables.  If the string exceeded a certain size threshold it would silently just not use it.  Since the http protocol is dependent upon specific strings, if any portion of the string got truncated the whole post would fail.  This was very hard to debug.
                </p>
                <h2>
                    What I learned
                </h2>
                <p>
                    This build was my first exposure to Apache Spark and Machine Learning for that matter.  I am absolutely excited by how many features that Spark has to offer.  I was floored by how easy it was to stream data, use SQL-like expressions, and create machine learning models and apply those models to real data - All on the fly!
                </p>
                <h2>
                    What's next for IOT Back Brace
                </h2>
                <p>
                    This project is still in its infancy and it is needing some good code review/suggestions for improvement.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            apache-spark
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/arduino">
                                arduino
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            kafka
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            mllib
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/mysql">
                                mysql
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/kringen/IOT-Back-Brace" rel="nofollow" target="_blank" title="https://github.com/kringen/IOT-Back-Brace">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="http://sandbox.mycontraption.com/iotbb" rel="nofollow" target="_blank" title="http://sandbox.mycontraption.com/iotbb">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                sandbox.mycontraption.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
