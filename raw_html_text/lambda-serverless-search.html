<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/oHJZ5JRfqEo?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691267" data-title="Architecture" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/267/datas/original.png">
                            <img alt="Serverless-Search &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/267/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Architecture
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691270" data-title="Graph on how long after upload it takes to see a document" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/270/datas/original.png">
                            <img alt="Serverless-Search &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/270/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Graph on how long after upload it takes to see a document
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691271" data-title="Querying Latency Metric" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/271/datas/original.png">
                            <img alt="Serverless-Search &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/271/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Querying Latency Metric
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    Lambda Serverless Search
                </h1>
                <p>
                    I love elasticsearch. I love serverless functions. But I love serverless functions more because they're cheaper to run. The purpose of this project is to allow the benefits of free text searching but work and scale at the most minimal cost.
                </p>
                <p>
                    The search algorithm powering the system is
                    <a href="http://lunrjs.com" rel="nofollow">
                        lunrjs
                    </a>
                    .
                </p>
                <h4>
                    Limitations
                </h4>
                <p>
                    Remember, this is a poorman's elastic search.
                </p>
                <ul>
                    <li>
                        Great for exposing search for sets of new data and existing data
                    </li>
                    <li>
                        You only get the index id, not the entire document
                    </li>
                    <li>
                        Use as a lite api before migrating to a full scale search solution
                    </li>
                    <li>
                        More documents can mean slower performance - how much? Below I've noted my
                        <a href="#performance" rel="nofollow">
                            performance
                        </a>
                        observations
                    </li>
                    <li>
                        AWS Lambda Memory requirements might need to be updated as per dataset
                    </li>
                    <li>
                        This is not a database, it is a search service. You will get results with the reference id only, not the entire document.
                    </li>
                </ul>
                <h3>
                    AWS Components
                </h3>
                <ul>
                    <li>
                        S3
                        <br>
                    </li>
                    <li>
                        Lambda (256mb)
                    </li>
                    <li>
                        API Gateway
                    </li>
                </ul>
                <h3>
                    Design
                </h3>
                <p>
                </p>
                <p>
                    <img alt="alt text" data-canonical-url="https://github.com/rlingineni/Lambda-Serverless-Search/blob/master/imgs/Architecture.png" src="https://res.cloudinary.com/devpost/image/fetch/s--Pb6QMM_q--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://github.com/rlingineni/Lambda-Serverless-Search/blob/master/imgs/Architecture.png">
                </p>
                <h2>
                    Getting Started
                </h2>
                <p>
                    You may head over to the
                    <a href="https://serverlessrepo.aws.amazon.com/#/applications/arn:aws:serverlessrepo:us-east-1:939884077921:applications%7Eserverless-search" rel="nofollow">
                        Serverless Application Repository
                    </a>
                    and deploy the service.
                </p>
                <p>
                    You will have to provide two parameters when you deploy:
                </p>
                <p>
                    <code>
                        TargetBucket
                    </code>
                    - The Name of S3 Bucket that should be created, this is where all the documents will sit
                </p>
                <blockquote>
                    <p>
                        Note: remember the S3 bucket naming conventions, only lowercase and alphanumberic
                    </p>
                </blockquote>
                <p>
                    <code>
                        InternalAPIKey
                    </code>
                    - This API Key is a secret string. Do not share this key with anyone, it will allow you to change your index configuration
                </p>
                <p>
                    You may test the API in postman. Be sure to update the BaseURL. Read below for route docs and design.
                </p>
                <p>
                    <a href="https://app.getpostman.com/run-collection/1e7621630073333b2697" rel="nofollow">
                        <img alt="Run in Postman" data-canonical-url="https://run.pstmn.io/button.svg" src="https://res.cloudinary.com/devpost/image/fetch/s--qdeIlEQq--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://run.pstmn.io/button.svg">
                    </a>
                </p>
                <h2>
                    API Routes
                </h2>
                <p>
                    You may view the routes and docs in the
                    <a href="https://github.com/rlingineni/Lambda-Serverless-Search" rel="nofollow">
                        Github Readme
                    </a>
                </p>
                <h2>
                    Challenges I Ran Into
                </h2>
                <ul>
                    <li>
                        Minimizing data loss was a priority. I didn't want to index every article again, but I also didn't want any articles to be lost. So this cost me in indexing speed. Perhaps a stream or queue would be better for next time.
                        <ul>
                            <li>
                                Indexing and building a large singular index was no good. I had to "shard" and build smaller indexes, that would allow me to retrieve an object from S3 much faster and query faster
                            </li>
                            <li>
                                Launching things in parallel consumed more memory, but at times, offered large performance gains that proved helpful
                            </li>
                        </ul>
                    </li>
                </ul>
                <h2>
                    Things I learned
                </h2>
                <ul>
                    <li>
                        Searches over 10 seconds are not acceptable
                    </li>
                    <li>
                        The Lunrjs data structure isn't necessarily designed for the server, so it needs work
                    </li>
                    <li>
                        AWS SAM CLI was very convenient to test locally and deploy
                    </li>
                    <li>
                        Milliseconds matter in search. Even a one-second optimization feels like light years faster. I had to really dig and find small places to make optimizations
                    </li>
                    <li>
                        AWS Serverless Repo is convenient when trying to share information
                    </li>
                    <li>
                        Network latency is non-negotiable. I read Algolia keeps their servers close to the data. Unfortunately, I didn't find a good way to speed this up
-Writing a scalability test and understanding how the service fared over time was helpful information to understand the scenarios and places to optimize
                    </li>
                </ul>
                <hr>
                <h2>
                    Performance
                </h2>
                <p>
                    Here are some graphs on performance that I have done. It's not going to win any races, or even come close to algolia or elasticsearch. The real killer is network latency which is a non-negotiable ~2s depending on the index size. There might be a better way to query it with Athena that might speed things along.
                </p>
                <p>
                </p>
                <h3>
                    DocumentSearchFunction:
                </h3>
                <ul>
                    <li>
                        All search indexes are loaded in parallel to improve concurrency
                    </li>
                    <li>
                        The higher the memory for a Lambda function, the more the compute power, hence faster index searching. (you can see up to
                        <strong>
                            75% increase
                        </strong>
                        in speed), just adjust the slider.
                    </li>
                </ul>
                <h3>
                    DocumentIndexingFunction:
                </h3>
                <ul>
                    <li>
                        The lower the number of
                        <em>
                            individual
                        </em>
                        articles, the faster the indexing time
                    </li>
                    <li>
                        You may see my
                        <code>
                            scale test
                        </code>
                        folder in the code above. It checks how long it takes to see a record appear in the results after it's uploaded. Latency of indexing operations degrades to about 30X over the course of 12K records.
                    </li>
                    <li>
                        Bulk uploads tend to decrease the amount of time
                    </li>
                    <li>
                        The higher the memory for a Lambda function, the more the compute power, hence faster index building
                    </li>
                </ul>
                <h2>
                    Next Steps, Optimizations and Future
                </h2>
                <ul>
                    <li>
                        Add pagination for large sets of results
                    </li>
                    <li>
                        Optimize lunrjs to allow for index merging and cross index searching
                    </li>
                    <li>
                        Upload Index directly to the Lambda Function (this would radically improve performance)
                    </li>
                    <li>
                        Update to get all S3 Articles and Content via AWS Athena
                    </li>
                    <li>
                        Utilize stream and SQS to perform indexing on only necessary documents
                    </li>
                    <li>
                        Use Cloudfront with S3 to cache the index document
                    </li>
                    <li>
                        Add Cache to keep track of most popular results in order to dynamically perform result boosts
                    </li>
                </ul>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/amazon-web-services">
                                amazon-web-services
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            aws-sam
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            cloudwatch
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/javascript">
                                javascript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            lambda
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            lunrjs
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/node-js">
                                node.js
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            s3
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            serverless
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            serverless-repo
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/rlingineni/Lambda-Serverless-Search" rel="nofollow" target="_blank" title="https://github.com/rlingineni/Lambda-Serverless-Search">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
