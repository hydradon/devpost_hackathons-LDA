<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://player.vimeo.com/video/269832028?byline=0&amp;portrait=0&amp;title=0#t=" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="647284" data-title="Step1: お菓子を選んでカメラボタンを押す" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/647/284/datas/original.png">
                            <img alt="Einstein Go - 自動決済型 置き菓子ストア &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/647/284/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Step1: お菓子を選んでカメラボタンを押す
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="647286" data-title="Step2: 社員とお菓子を自動で認識、[お買い上げ]ボタンを押すだけ！" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/647/286/datas/original.png">
                            <img alt="Einstein Go - 自動決済型 置き菓子ストア &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/647/286/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Step2: 社員とお菓子を自動で認識、[お買い上げ]ボタンを押すだけ！
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="647288" data-title="経理部が月1回レポートを確認して、給与引き落とし" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/647/288/datas/original.png">
                            <img alt="Einstein Go - 自動決済型 置き菓子ストア &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/647/288/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                経理部が月1回レポートを確認して、給与引き落とし
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    なぜこのアプリを作ったか
                </h2>
                <p>
                    ドリンクは自動販売機でSuicaで買えるのに、置き菓子は相変わらず小銭が必要だなんて...
                </p>
                <h2>
                    どんなアプリ？
                </h2>
                <p>
                    買いたいお菓子を手に持って、設置されているタブレットのカメラボタンを押すと、
                </p>
                <ol>
                    <li>
                        タブレットのカメラが手に持っているお菓子を認識します。
                    </li>
                    <li>
                        顔認識で買物客が社員の誰かを識別します。
                    </li>
                    <li>
                        画面に社員名とお菓子の明細を表示し、内容に間違いなければ 「お買い上げ」をタッチ。
これだけの操作で購入が完了します。
                    </li>
                </ol>
                <p>
                    また、カメラボタンを押すときに笑顔でいると、「スマイルポイント」がたまります。
「スマイルポイント」がたまると購入時に割引を受けることができるようになります。
                </p>
                <p>
                    購入した明細はSalesforce上に自動で記録されます。
経理部は月1回、レポートを確認し、それをもとに給与天引きすることが可能です。
                </p>
                <h2>
                    実現方法（アーキテクチャ）
                </h2>
                <ul>
                    <li>
                        アプリUIはLightningプラットフォームを利用して構築されています。具体的にはLightning Component、Visualforce、Apexを利用しています。
                    </li>
                    <li>
                        お菓子の認識は、Einstein Vision - Object Detectionを利用しています。
                    </li>
                    <li>
                        顔認識は、Amazon Rekognitionを利用しています。トレーニングデータはSalesforce内にある各ユーザーのプロフィール写真を利用しています。今回は300人弱の顔を学習させました。
                    </li>
                    <li>
                        笑顔でいるかどうかの判別は、Einstein Vision - Image Classificationを利用しています。
                    </li>
                </ul>
                <h2>
                    苦労したこと
                </h2>
                <h3>
                    (1) 手に持ったお菓子の認識
                </h3>
                <p>
                    手に持ったお菓子を正しく認識させるために、なるべく少ない撮影画像でトレーニングすることを最初に考えました。
実際にサービス化した際に、商品画像を何枚も撮影してもらうのは、現実的ではないと考えたからです。
                </p>
                <p>
                    そのために、Data Augumentation技術を使って画像を大量生成することを最初に試しました。回転させたり、RGB値をずらしたりして学習させましたが、うまくいきませんでした。
                </p>
                <p>
                    最終的にはEinsteinのお作法に沿って、背景やお菓子の持ち方を変えて数十枚の写真を用意し、モノクロ化とぼかし加工で画像枚数を4倍にし、それをトレーニングに使用しました。
                </p>
                <h3>
                    (2) 笑顔の検出
                </h3>
                <p>
                    笑顔とそうでない顔画像をそれぞれ600枚ずつ用意して学習させました。
最初は撮影した画像をそのままImage Classificationに投げても精度上がりませんでした。
そこで、Amazon Rekognitionが認識した顔のBounding Boxを返すことを利用し、顔部分を切り取ってからImage Classificationに投げると精度がでるようになりました。ただし、Apexで顔部分の切り抜きが難しく、JavaScriptで行うためには、顔認識時と笑顔検出時の2回サーバーとの通信が必要となり、応答速度がかなり遅くなってしまったので、今回のアプリのソースコードからは最終的に除外しました。
                </p>
                <h3>
                    (3) UIの実現
                </h3>
                <p>
                    iOSのネイティブアプリではなく、Lightning ComponentやVisualforceなどのHTML系テクノロジのみで、どこまで操作感の良いUIが実現できるかに挑戦しました。結果、カメラボタンと「お買い上げ」ボタンの2タッチのみでお会計を済ませることに成功しました。
また、カメラボタンがあることで、カメラと人物の距離感を一定にすることができ、認識精度の向上に寄与していると考えています。
                </p>
                <h2>
                    気に入っているところ！
                </h2>
                <p>
                    「スマイルポイント」に注目していただきたいと思っています。
人は笑うことでより健康でいられる、ということが統計的に実証されています。
購入時に毎回笑顔でいることで、社員の健康度を少しでも上げることに寄与できると思っています。
社員全員が笑顔でいられる会社はきっと良い会社ですよね！
                </p>
                <h2>
                    時間があればチャレンジしたかったこと
                </h2>
                <ul>
                    <li>
                        大量の背景画像をあらかじめ用意しておいて、お菓子画像を1枚撮影すると、背景画像と合成したトレーニング画像を大量に作成して精度が出るか試してみる。
                    </li>
                    <li>
                        笑顔のときに「笑顔がいいですね」「毎日笑顔でいいですね」などを合成音声にしゃべらせる。
                    </li>
                    <li>
                        顔認識をAmazon Rekognitionではなく、自前のモデルをHeroku上にデプロイして推論（Inference）させる。Siamese Neural Networks for One-shot Image Recognitionという論文をみて、Amazon Rekognitionと同じように1人あたり1枚だけの画像で顔認証をする方法を独自構築してみたかった。
                    </li>
                    <li>
                        iOSのネイティブアプリにした場合に、カメラボタンを押さずに、社員とお菓子を自動認識することができるか。
                    </li>
                </ul>
                <h2>
                    次のステップ
                </h2>
                <p>
                    このアプリケーションの将来の展開として次のようなものを考えています。
                </p>
                <ul>
                    <li>
                        顔認証部分を拡張して、タイムカードの打刻に利用する。出退勤管理のアプリと連動するのも良い。
                    </li>
                    <li>
                        お菓子以外に、社食で提供している皿モノを認識させる。社食の会計を自動化できるし、皿モノのカロリーや栄養成分を登録しておけば、「最近、脂質の取り過ぎです」とかの警告を送ることができ、より社員の健康に貢献できる。
                    </li>
                </ul>
                <h2>
                    アプリを試すには
                </h2>
                <h3>
                    コンテスト主催者の方
                </h3>
                <p>
                    アプリを実際にお試しいただくためのログインID/パスワードはメッセージ機能を使って別途お送りします。ただし、実際に試すには、顔画像の登録が必要ですので、お試しになりたい場合は、顔画像を提供いただければ登録いたします。（現在は顔画像の登録機能はアプリに実装できておりません。）
                </p>
                <h3>
                    それ以外の方
                </h3>
                <p>
                    6/8(金)に開催される最終選考会でデモを見てください！皆さんでお試しいただけなくて、ごめんなさい。
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            amazon-rekognition
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/apex">
                                apex
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            einstein.ai
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            lightning
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://login.salesforce.com/" rel="nofollow" target="_blank" title="https://login.salesforce.com/">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                login.salesforce.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
