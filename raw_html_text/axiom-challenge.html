<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div>
                <h1>
                    Readme
                </h1>
                <p>
                    Author: Lucas Dias Ferreira (
                    <a href="mailto:lucasdiasf@gmail.com" rel="nofollow">
                        lucasdiasf@gmail.com
                    </a>
                    )
                </p>
                <p>
                    Github:
                    <a href="https://github.com/lucasdf/axiom-challenge" rel="nofollow">
                        https://github.com/lucasdf/axiom-challenge
                    </a>
                </p>
                <p>
                    Live Endpoint:
                    <a href="http://52.21.74.249/api/" rel="nofollow">
                        http://52.21.74.249/api/
                    </a>
                </p>
                <p>
                    Live readme:
                    <a href="http://socrates.io/#MastermindLucasFerreira/read" rel="nofollow">
                        http://socrates.io/#MastermindLucasFerreira/read
                    </a>
                </p>
                <p>
                    API Documentation:
                    <a href="http://socrates.io/#MastermindLucasFerreiraAPI/read" rel="nofollow">
                        http://socrates.io/#MastermindLucasFerreiraAPI/read
                    </a>
                </p>
                <h2>
                    The Challenge
                </h2>
                <p>
                    I enjoyed this challenge because it was a simple problem yet it allowed me to go as far as I wanted. I decided to use it as an opportunity to learn NodeJS and Redis. I had used Node for a few simple things before and had never used Redis, so there is a lot of things that I learned while doing it. If I could go back I would definetely have spend more time designing the database and the APIs flow. I know that by deciding to use two technologies that I don't have much knowledge I lost a lot of time learning basic things like the Redis datatypes or how to setup routes with Express. I now feel like I have a more mature knowledge that will allow me learn both NodeJS and Redis better in the future.
                </p>
                <h2>
                    My Solution
                </h2>
                <p>
                    I am aware that there are a lot of things that could have been better at my solution. The APIs flow become a little complicated and hard to folow along. I should have modularized the code and spent more time designing the database to improve it. There is also some callback hell going on that makes the code hard to read, although I replaced some of the callbacks by using Async. Nonetheless all functionalities that I implemented are working and it is possible to:
                </p>
                <ul>
                    <li>
                        Register a new player.
                    </li>
                    <li>
                        Login and get an authentication key.
                    </li>
                    <li>
                        Create a multiplayer or singleplayer game.
                    </li>
                    <li>
                        Play it! ;)
                    </li>
                </ul>
                <p>
                    I tried my best to deal with most potential error situations like a player trying to make a guess when it is not his or her turn, trying to make a guess at a game when the player has not a part of it, trying to play by using an invalid authorization token, etc.
                </p>
                <p>
                    There is a more extensive list of technical problems that I have not solved below (The BPTTSHBI List). I think it is very important to be aware of my own design flaws or unhandled situations so I can solve it later.
                </p>
                <h2>
                    Testing
                </h2>
                <p>
                    In order to create, join or play a game it is necessary to register and then login. The login API return an Authorization token which needs to be used on all other requisition. This simulates an authorization token system, although I have opted to include the token in the body of the requisitions instead of using the Authorization header. It is possible to skip the registration part by using one of the default users (ElonM:falcon or AlanTuring:enigma).
                </p>
                <p>
                    Below are a couple of tests that can be made. The full syntax, expected returns and posible errors/validations are described on the API Documentation (
                    <a href="http://socrates.io/#MastermindLucasFerreiraAPI/read" rel="nofollow">
                        http://socrates.io/#MastermindLucasFerreiraAPI/read
                    </a>
                    ).
                </p>
                <h3>
                    Test 1: Registration
                </h3>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/signup" rel="nofollow">
                        http://52.21.74.249/api/signup
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "user": "PickUser",
    "password": "password"
}
</code></pre>
                <h3>
                    Test 2: Login
                </h3>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/login" rel="nofollow">
                        http://52.21.74.249/api/login
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "username": "ElonM",
    "password": "falcon"
}
</code></pre>
                <h3>
                    Test 3: Create singleplayer game
                </h3>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/game" rel="nofollow">
                        http://52.21.74.249/api/game
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "playerToken": "TokenReceivedAbove"
}
</code></pre>
                <h3>
                    Test 4: Make a guess
                </h3>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/game/%7BGameKeyReceivedAbove%7D/guess" rel="nofollow">
                        http://52.21.74.249/api/game/{GameKeyReceivedAbove}/guess
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "playerToken": "PlayerToken",
    "code": "PYOPRGBO"
}
</code></pre>
                <h3>
                    Test 5: See the code from a game.
                </h3>
                <p>
                    GET
                    <a href="http://52.21.74.249/api/game/%7BgameKey%7D" rel="nofollow">
                        http://52.21.74.249/api/game/{gameKey}
                    </a>
                </p>
                <h3>
                    Test 6: Creates a multiplayer game
                </h3>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/game" rel="nofollow">
                        http://52.21.74.249/api/game
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "playerToken": "TokenReceivedAbove",
    "gameType": "multi"
}
</code></pre>
                <h3>
                    Test 7: Join a game
                </h3>
                <h4>
                    Part One: Login with another player
                </h4>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/login" rel="nofollow">
                        http://52.21.74.249/api/login
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "username": "AlanTuring",
    "password": "enigma"
}
</code></pre>
                <h4>
                    Part Two: Join the game
                </h4>
                <p>
                    POST
                    <a href="http://52.21.74.249/api/game/%7BGameKey%7D%7D/join" rel="nofollow">
                        http://52.21.74.249/api/game/{GameKey}}/join
                    </a>
                </p>
                <pre class="language-nolang"><code>{
                "playerToken": "TokenReceivedAbove"
}
</code></pre>
                <h2>
                    Setup
                </h2>
                <p>
                    There is a live version of the API running at
                    <a href="http://52.21.74.249/api/" rel="nofollow">
                        http://52.21.74.249/api/
                    </a>
                    . I am using an Amazon EC2 instance with Redis running as a service and the npm package pm2 (
                    <a href="http://pm2.keymetrics.io/" rel="nofollow">
                        http://pm2.keymetrics.io/
                    </a>
                    ) to run and manage the application.
                </p>
                <p>
                    Instructions to install the application on Ubuntu.
                </p>
                <pre class="language-nolang"><code>- Install NodeJS (skip if it is already installed)
curl -sL https://deb.nodesource.com/setup | sudo bash -
sudo apt-get install nodejs

- Install Redis (skip if it is already installed)
sudo apt-get update
sudo apt-get install build-essential
sudo apt-get install tcl8.5
wget http://download.redis.io/releases/redis-stable.tar.gz
tar xzf redis-stable.tar.gz
cd redis-stable
make
sudo make install

- Run Redis
This instruction uses the install script in order to run it as a service. The code considers that Redis is runing at the default port (6379).
cd utils
sudo ./install_server.sh // Press enter for all options.

- Install Git (skip if it is already installed)
sudo apt-get install git

- Download the application
git clone https://github.com/lucasdf/axiom-challenge.git

- Install the application
npm install

- Run the application
sudo node app.js
</code></pre>
                <h2>
                    The BPTTSHBI List (Bugs, Problems and Thing That Should Have Been Improved)
                </h2>
                <ol>
                    <li>
                        <p>
                            Callback Hell. Before this challenge my knowledge of callback hell was limited, but now I know what it means. After implementing all the code using only callbacks I added a bit of Async library but it was not enough. I think that the real problem is the lack of modularization in my code, since each router is a single big function that performs all validations and database read/writes. Another thing that could have improved it is a better database design: this was my first time using Redis and I don't think I achieved a good design. I should also have abused more of the mult command to perform multiple commands with one database "travel".
                        </p>
                    </li>
                    <li>
                        <p>
                            Lack of error handling: all callback functions have an error and a result parameters. I am simply ignoring the error parameter which I know is a very bad thing. I believe I should have dealed with each error parameter in the callback and handle it apropriately.
                        </p>
                    </li>
                    <li>
                        <p>
                            Database connection: I am not using a retry system or handling connection problems properly.
                        </p>
                    </li>
                    <li>
                        <p>
                            Files organization: although I separated each base route (/api/game, /api/login, etc) into different files the game route become quite large, with about 600 lines which is too large for a game/problem like this one. It would have been good to separate each API resource (/api/game/join, /api/game/guess) into different files and improved the logic to make the code shorter and more readable.
                        </p>
                    </li>
                    <li>
                        <p>
                            I haven't configured the Redis, Node or even the server for a properly production setup. There is also no consideration about scaling, which could have been achieved by clustering the Redis into different instances and setting up a loadbalance serving requisitions to a random instance of a pool.
                        </p>
                    </li>
                    <li>
                        <p>
                            The gameplay differs from what was specified at the vanhack-engineering-2016.pdf document. The API doesn't wait for both guesses before send the answer and the final answer doesn't show both user's guessing history.
                        </p>
                    </li>
                </ol>
                <h2>
                    About Me
                </h2>
                <p>
                    I love to code and learn new things. I work at a brazilian startup where am part of a small team developing a mobile payment platform focused on low income people without access to the traditional banking system. I do a bit of everything but my main responsibilities are designing and implementing APIs through out Service Bus framework, SQL database design and some PHP programming.
                </p>
                <p>
                    You can contact me at
                    <a href="mailto:lucasdiasf@gmail.com" rel="nofollow">
                        lucasdiasf@gmail.com
                    </a>
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/javascript">
                                javascript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/node-js">
                                node.js
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/redis">
                                redis
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/lucasdf/axiom-challenge" rel="nofollow" target="_blank" title="https://github.com/lucasdf/axiom-challenge">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="http://52.21.74.249/api/" rel="nofollow" target="_blank" title="http://52.21.74.249/api/">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                52.21.74.249
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
