<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li class="text-center">
                        <a data-lightbox="864582" data-title="differential specification chart for the system (as in https://community.cadcad.org/t/differential-specification-syntax-key/31)" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/864/582/datas/original.jpg">
                            <img alt="Common - DEX with balancing feedback loop &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/864/582/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                differential specification chart for the system (as in https://community.cadcad.org/t/differential-specification-syntax-key/31)
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <p>
                    As this site does not support LATEX in markdown files, please find more extensive readme here:
                    <a href="https://github.com/AdamGagol/Common-Diffusion/blob/master/readme.ipynb" rel="nofollow">
                        https://github.com/AdamGagol/Common-Diffusion/blob/master/readme.ipynb
                    </a>
                    (yeah, I know that hosting markdown files as jupyter notebooks on github seems overly complex, but I'm a bit in a hurry here..)
                </p>
                <p>
                    The chart in higher (readable) quality:
                    <a href="https://drive.google.com/file/d/1klI577fwIl_JhyVvCueKFSyeJJpi-iKw/view" rel="nofollow">
                        https://drive.google.com/file/d/1klI577fwIl_JhyVvCueKFSyeJJpi-iKw/view
                    </a>
                </p>
                <h1>
                    Inspiration/Problem
                </h1>
                <p>
                    In the classical market maker models (such as a
                    <em>
                        constant product model
                    </em>
                    ,  as used in Uniswap), the
                    <em>
                        slippage
                    </em>
                    for the trade A-&gt;B is proportional to the amount of A and B assets that exchange has reserved for this trading pair. 
Unfortunately, current DEX designs are utilizing reserve assets in a suboptimal way:
                </p>
                <ul>
                    <li>
                        <a href="uniswap.io" rel="nofollow">
                            Uniswap
                        </a>
                        has ETH as a central token, so every trade between tokens A and B needs to be split into A-&gt;ETH and ETH-&gt;B trades, and naturally half of the whole reserve needs to be kept as ETH. Even worse, Uniswaps ETH reserve is fractioned into parts corresponding to each other traded token, so each trading pair can use only a small fraction of the total ETH reserve.
                    </li>
                    <li>
                        <a href="bancor.network" rel="nofollow">
                            Bancor
                        </a>
                        uses a concept of a
                        <em>
                            target reserve ratio
                        </em>
                        for each token, what provides incentive for
                        <em>
                            arbitrageurs
                        </em>
                        to keep each token reserves close to the target values. Unfortunatelly, it lacks a mechanism of balancing these ratios, so they need to be set up manually and do not necessarily correspond to the actual volume on each of the assets (what in turn causes suboptimal slippage for traders).
                    </li>
                    <li>
                        <a href="balancer.finance" rel="nofollow">
                            Balancer
                        </a>
                        , contrary to the name, also does not have a rebalancing mechanism. Instead, it nicely merges the Bancor idea of
                        <em>
                            target reserve ratios
                        </em>
                        for each token (which are called
                        <em>
                            weights
                        </em>
                        within the Balancer model) with a generalized
                        <em>
                            constant product model
                        </em>
                        of Uniswap. In the current version the
                        <em>
                            target reserve ratios/weights
                        </em>
                        are assumed to be constant.
                    </li>
                </ul>
                <h1>
                    What it does/Solution
                </h1>
                <p>
                    Common is a DEX model that automatically balances reserve ratios in order to minimize the average slippage over all trades. 
The balancing is based purely on incentive mechanisms, hence does not rely on external price or volume oracles.
The proposed balancing mechanism is independent from price equations, so it could be used with any market maker model.
In scope of this project, I'm using prices as in the generalized constant product model.
                </p>
                <h1>
                    How I built it
                </h1>
                <p>
                    The generalized constant product model is based on Balancer, and the balancing loop is my original idea.
The cadCAD model shows that such rebalancing loop indeed decreases the average time (run with wnd without the voting mechanism on the same random seed).
                </p>
                <h1>
                    Challenges I ran into
                </h1>
                <ol>
                    <li>
                        It occured to be quite hard to formalize a mechanism for listing new tokens within such a model
                    </li>
                    <li>
                        As pointed out by Billy Rennekamp, DEX based on such mechanism itself would be susceptible to putting unreasonably high fraction of its reserves in highly traded tokens with very unstable price (AKA
                        <em>
                            shitcoins
                        </em>
                        ), hence putting at risk market makers' capital. Due to this limitation, without further work the design should be rather used for a federated list of traded tokens. The issue can be partially alleviated by replacing logarithm in the price equations with a function with a horizontal asymptote (ex. $\frac{1}{1-f(x)}$ for any $f$ descending to $0$), so that even unbounded influx of a single type of token can't allow to buy the whole of the system reserves. Other proposed heuristics included shutting off the listed token after it reaches some 'danger threshold'.
                    </li>
                    <li>
                        Relation between balances $B_i$ and $B_j$ and the slippage on the $i,j$ trading pair is not trivial, and the concept of 'average slippage' is somewhat loosely defined (what is the average size of the trade? What is the distribution of the trade sizes?). It remains an open problem to me whether the equilibrium in which balances directly proportional to the traded volumes is the best possible in terms of slippage minimization.
                    </li>
                </ol>
                <h1>
                    Accomplishments that I'm proud of
                </h1>
                <ul>
                    <li>
                        cadCAD model started to actually work 40 minutes before the deadline,
                    </li>
                    <li>
                        the specification chart (AKA 'differential specification') is a piece of art,
                    </li>
                    <li>
                        I've proven a theorem on a hackathon!
                    </li>
                </ul>
                <h1>
                    What I learned
                </h1>
                <ul>
                    <li>
                        how to formalize incentive mechanisms with
                        <a href="https://community.cadcad.org/t/differential-specification-syntax-key/31" rel="nofollow">
                            differential specification
                        </a>
                        ,
                    </li>
                    <li>
                        what is cadCAD and how to use it,
                    </li>
                    <li>
                        that constant product model easily generalizes for multiple tokens with different weights, and that someone actually already did the hard part of performing all the price calculations (thanks Michael Zargham for showing me Balancer),
                    </li>
                    <li>
                        that
                        <a href="https://en.wikipedia.org/wiki/Volatility_risk" rel="nofollow">
                            volatility risk
                        </a>
                        should be taken into account when designing DEXes.
                    </li>
                </ul>
                <h1>
                    What's next for Common
                </h1>
                <ol>
                    <li>
                        <p>
                            To alleviate the problem in challenge nr 2., another mechanism should to be put in place, which would hold voters for a given token X accountable for its excessive drops in price.
                        </p>
                    </li>
                    <li>
                        <p>
                            The mechanism of listing new tokens should be formalized.
                            <strong>
                                Important note:
                            </strong>
                            without resolving issue 1., allowing for listing new tokens by users or market makers could lead to various exploits based on listing different shady assets (which are, for example, hacked in a way giving someone access to unlimited amounts of tokens).
                        </p>
                    </li>
                    <li>
                        <p>
                            Of course, it needs to be implemented, preferably using some interoperability stack to allow for decentralized trading of non-ERC-20 tokens (ex., Bitcoin...). Currently it seems that such interoperability is possible either via deploying DEX on Ethereum and trustless wrapping of non-ERC-20 tokens (see ex., Keep
                            <a href="http://docs.keep.network/tbtc/index.pdf" rel="nofollow">
                                tBTC concept
                            </a>
                            , the same would need to be done for every other problematic token...), or by deploying on a platform with built-in decentralized bridges (ex., Cosmos hubs and zones or Polkadot bridge chains).
                        </p>
                    </li>
                </ol>
                <h3>
                    Glossary of terms:
                </h3>
                <p>
                    <strong>
                        DEX
                    </strong>
                    - An exchange which operates in a decentralized way, i.e., without a central authority.
                </p>
                <p>
                    <strong>
                        slippage
                    </strong>
                    - refers to the difference between the expected price of a trade and the price at which the trade is executed. Slippage can occur at any time but is most prevalent during periods of higher volatility when market orders are used. It can also occur when a large order is executed but there isn't enough volume at the chosen price to maintain the current bid/ask spread. (
                    <a href="https://www.investopedia.com/terms/s/slippage.asp" rel="nofollow">
                        investopedia
                    </a>
                    ).
                    <em>
                        In the scope of this document, I'm referring particularly to the slippage occurring due to the large trades on pairs with insufficient liquidity
                    </em>
                </p>
                <p>
                    <strong>
                        arbitrageur
                    </strong>
                    - a type of investor who attempts to profit from market inefficiencies. An arbitrageur would, for example, seek out price discrepancies between stocks listed on more than one exchange by buying the undervalued shares on one exchange while short selling the same number of overvalued shares on another exchange, thus capturing risk-free profits as the prices on the two exchanges converge.
(
                    <a href="https://www.investopedia.com/terms/a/arbitrageur.asp" rel="nofollow">
                        investopedia
                    </a>
                    )
                </p>
                <p>
                    <strong>
                        market maker
                    </strong>
                    - a company or an individual that both sells to and also buys from its clients and is compensated by means of price differentials for the service of providing liquidity, reducing transaction costs and facilitating trade.
                </p>
                <p>
                    <strong>
                        constant product model
                    </strong>
                    - a model of automated market maker for a tradable pair of tokens in which system keeps the product $X\cdot Y$ constant, where $X$ and $Y$ are the amounts of the tokens in systems deposit/reserve. (
                    <a href="https://github.com/runtimeverification/verified-smart-contracts/blob/uniswap/uniswap/x-y-k.pdf" rel="nofollow">
                        basic model
                    </a>
                    ,
                    <a href="https://balancer.finance/whitepaper.html" rel="nofollow">
                        model generalized for many tokens with weights
                    </a>
                    )
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            cadcad
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/TokenEngineeringCommunity/Common-DEX" rel="nofollow" target="_blank" title="https://github.com/TokenEngineeringCommunity/Common-DEX">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
