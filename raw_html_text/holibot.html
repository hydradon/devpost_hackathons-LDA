<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/1MLb3k03Qo0?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                </ul>
            </div>
            <div>
                <p>
                    My submission for the Chatbot competition is a service which allows users of the popular annual leave booking system TimeTastic to interact with it's API using Slack.
                </p>
                <p>
                    The motivation for the project was that wherever I've worked, booking holidays has been a pain. I can never remember how many days I have left for the year and getting approvals can be annoying. Timetastic solves some of these problems with a great web site and mobile app but I wanted to enhance it further with a bot, which feels like a natural way of booking time off.
                </p>
                <p>
                    I had to choose between hosting this service myself or allowing users to deploy it to their own AWS account. I went for the latter, because accessing TimeTastic requires an API token and I didn't want to have to store these tokens in my own infrastructure. However, this makes deploying the bot much more complicated. I like a challenge though, and have found a way to deploy all the necessary objects to AWS from a Node.js script. Importantly, the deployment script can also re-deploy the bot if you make any changes to the source (e.g. adding a new intent) without needing to delete the Lex-related objects first.
                </p>
                <p>
                    Functionality
                </p>
                <p>
                    Holibot provides the following intents
                </p>
                <ul>
                    <li>
                        CheckAllowance
                        <em>
                            "How many days holiday do I have?"
                        </em>
                    </li>
                    <li>
                        CheckMyHolidays
                        <em>
                            "What holidays do I have booked?"
                        </em>
                    </li>
                    <li>
                        RequestTimeOff
                        <em>
                            "I need a holiday from Tuesday to 13th August"
                        </em>
                    </li>
                    <li>
                        CheckApprovals
                        <em>
                            "What approvals are outstanding?"
                        </em>
                    </li>
                    <li>
                        Approve
                        <em>
                            "Approve all [Alice's|Bob's|Colin's] holidays"
                        </em>
                    </li>
                    <li>
                        WhosOutInDepartment
                        <em>
                            "Who's out in sales today?"
                        </em>
                    </li>
                </ul>
                <p>
                    Architecture
                </p>
                <p>
                    This repo contains a setup script with accompanying files to create the following objects in AWS:
                </p>
                <ul>
                    <li>
                        6 Lex intents to cover the functionality above
                    </li>
                    <li>
                        A slot type for department names which is gathered from Timetastic upon deployment
                    </li>
                    <li>
                        A single Lambda function, which handles all of the intents
                    </li>
                    <li>
                        The Lex bot itself and an alias
                    </li>
                    <li>
                        Any necessary permissions on AWS
                    </li>
                </ul>
                <p>
                    The (Node.js) setup script uses the following technologies to deploy Holibot:
                </p>
                <ul>
                    <li>
                        <em>
                            async
                        </em>
                        to handle executing all the various asynchronous deployment steps synchronously in order
                    </li>
                    <li>
                        <em>
                            commander
                        </em>
                        and
                        <em>
                            promptly
                        </em>
                        to handle the command line options and validation
                    </li>
                    <li>
                        <em>
                            lodash
                        </em>
                        to perform various filtering and processing of collections
                    </li>
                    <li>
                        the
                        <em>
                            serverless
                        </em>
                        framework to package up and deploy all the javascript files which make up the AWS Lambda hander function.
                    </li>
                    <li>
                        the AWS Node.js SDK (of course)
                    </li>
                </ul>
                <h1>
                    Challenges encountered
                </h1>
                <p>
                    I was suprised to find that the actual construction of the bot model in Lex was relatively straightforward once I had
figured out the best ways to answer the various questions and interact accordingly with the Timetastic API.
The hardest challenges in this project came from writing a script to actually deploy the bot. I had chosen the Serverless framework for packaging my Lambda handler function, but unfortunately Serverless does not support deploying Lex related objects. Neither does CloudFormation, so I had to write my own calls using the AWS SDK for Node.js to create the intents, slot types, bot and alias and apply the necessary permissions, as well as taking care of removing previous intents, slot types, aliases and bots in case the user was re-deploying. This re-deployment system was the hardest piece of all because I had to deal with asynchronous calls to AWS and making sure my commands were issued correctly in response to the output of the previous call. I made heavy use of the library 'async' to achieve this.
                </p>
                <h1>
                    Testing instructions
                </h1>
                <ul>
                    <li>
                        <p>
                            I've invited
                            <a href="mailto:testing@devpost.com" rel="nofollow">
                                testing@devpost.com
                            </a>
                            to my slack channel where you should be able to direct message @Holibot to test the interactions below.
                        </p>
                    </li>
                    <li>
                        <p>
                            This user is also set up in a Timetastic account that will expire in 90 days.
                        </p>
                    </li>
                </ul>
                <p>
                    Below is the original readme from my repo showing a user how to use Holibot.
                </p>
                <p>
                    Background and development info can be see
                </p>
                <h1>
                    holibot
                </h1>
                <p>
                    A Slackbot for booking annual leave in TimeTastic implemented in AWS Lex and Lambda. This is not a hosted service - everything in this repo allows you to create your own private bot using your own AWS account.
                </p>
                <h2>
                    what do I need in order to use Holibot?
                </h2>
                <ul>
                    <li>
                        A Slack account
                    </li>
                    <li>
                        An AWS subscription
                    </li>
                    <li>
                        A TimeTastic account
                    </li>
                </ul>
                <h2>
                    what can holibot do?
                </h2>
                <ul>
                    <li>
                        request annual leave by chatting in Slack
                    </li>
                    <li>
                        show your planned holidays
                    </li>
                    <li>
                        approve holidays for others
                    </li>
                    <li>
                        show your outstanding holiday allowance
                    </li>
                    <li>
                        show who's off in various departments on a given day
                    </li>
                </ul>
                <h2>
                    how do I set it up?
                </h2>
                <p>
                    First install the AWS command line utility, and configure it with an appropriate security token that has the permissions:
                </p>
                <ul>
                    <li>
                        lex - full control
                    </li>
                    <li>
                        <p>
                            lambda - create / update functions
                        </p>
                    </li>
                    <li>
                        <p>
                            In Slack create an application according to instructions
                            <a href="http://docs.aws.amazon.com/lex/latest/dg/slack-bot-assoc-create-app.html" rel="nofollow">
                                here
                            </a>
                        </p>
                    </li>
                    <li>
                        <p>
                            Clone this repository and run the command
                        </p>
                    </li>
                </ul>
                <pre class="language-nolang"><code>npm install
node setup -t &lt;your TimeTastic API token&gt; 
</code></pre>
                <p>
                    You can get your Timetastic token here (having logged in already):
                    <a href="http://api.timetastic.com" rel="nofollow">
                        here
                    </a>
                    .
                </p>
                <p>
                    When the installation is complete you will have a bot configured for your TimeTastic account that you can proceed to add to Slack.
                </p>
                <ul>
                    <li>
                        <p>
                            In AWS, create a channel association for Slack to your newly created Holibot with the instructions
                            <a href="http://docs.aws.amazon.com/lex/latest/dg/slack-bot-assoc-create-assoc.html" rel="nofollow">
                                here
                            </a>
                            and
                            <a href="http://docs.aws.amazon.com/lex/latest/dg/slack-bot-back-in-slack-console.html" rel="nofollow">
                                here
                            </a>
                            .
                        </p>
                    </li>
                    <li>
                        <p>
                            In the Slack page for your bot app under
                            <em>
                                Features
                            </em>
                            &gt;
                            <em>
                                OAuth &amp; Permissions
                            </em>
                            you need to add the following permissions to allow Holibot to read the email addresses of your team: team:read, users:read, users:read.email
                        </p>
                    </li>
                    <li>
                        <p>
                            You also need to grab the 'OAuth Access Token' from the same page.
                        </p>
                    </li>
                    <li>
                        <p>
                            Add this token as an extra environment variable to the AWS Lambda function holibot-prod-handler called SlackToken.
                        </p>
                    </li>
                    <li>
                        <p>
                            Back in your Slack app page under
                            <em>
                                Settings
                            </em>
                            &gt;
                            <em>
                                Manage Distribution
                            </em>
                            click the 'Add to Slack' button.
                        </p>
                    </li>
                </ul>
                <blockquote>
                    <p>
                        Note: Users' email addresses must be the same in Slack as they are in Timetastic for Holibot to work.
                    </p>
                </blockquote>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/javascript">
                                javascript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/node-js">
                                node.js
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            serverless
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/benwhitman/holibot" rel="nofollow" target="_blank" title="https://github.com/benwhitman/holibot">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://bwhitman-devpost-2017.slack.com" rel="nofollow" target="_blank" title="https://bwhitman-devpost-2017.slack.com">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                bwhitman-devpost-2017.slack.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
