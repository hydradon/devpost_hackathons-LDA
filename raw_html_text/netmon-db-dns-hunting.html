<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/b0yTgAQWlyo?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                </ul>
            </div>
            <div>
                <h1>
                    Purpose
                </h1>
                <p>
                    In the last few years we have seen big data leaks from companies and
government along where personal information and intellectual property
has been exposed. There are a myriad of ways to extract data from
networks nowadays that is why the common trend in enterprise networks is to
block data transfer sites or applications like dropbox, drive, etc or protocols
such as ftp, sftp, etc, specially if the users of a specific network do
not need to transfer things. However, there is often some standard protocols
that are left wide open without any deep packet inspection such as DNS or ICMP
that are often leveraged by malicious actors that use them for different
purposes like C&amp;C or data exfiltration/infiltration.
                </p>
                <p>
                    As the name suggests we will use this dashboard to hunt for leads pointing
to a possibly DNS data exfiltration/infiltration, since you probably know
DNS is one of the noisiest protocols with a lot of packets specially in
end users networks, hence it is almost impossible to review DNS logs manually.
                </p>
                <p>
                    This dashboard will help us to establish a trend for a specific environment
and detect outliers that can possible identify DNS misuse like using the
protocol to exfiltrate data or to infiltrate binaries, scripts, etc, to our
internal networks in an attempt to evade other controls in place.
                </p>
                <h1>
                    Manifest
                </h1>
                <p>
                    These are all the files that are needed to be able to use this dashboard:
                </p>
                <ul>
                    <li>
                        Flow_DetectDNSLength.lua: this rule will help us to identify very large
host records with the exact same length, sadly at the moment NM does not
allow us to set the data type for the custom fields, this is why
we can not use this custom field (HostLength_NM) with the aggregation
functions in the visualizations since is stored as a string variable,
however it stillserves a purpose on the query table to show the length
of a specific DNS host record.
                    </li>
                    <li>
                        dashboards.json: this file contains the DNS Exfil/Infil hunting dashboard.
                    </li>
                    <li>
                        <p>
                            visualizations.json: there are different visualizations that help us to
identify a possible data exfiltration or infiltration:
                        </p>
                        <ul>
                            <li>
                                DNS trend: the trend histogram will help us to define a standard
behavior for a specific environment over time allowing us to identify
an abnormal behavior like high dns packet count on a very small amount of
time.
                                <img alt="DNS trend histogram" data-canonical-url="./imgs/dns-trend.png" src="https://res.cloudinary.com/devpost/image/fetch/s--OTNa26Cr--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/v1/./imgs/dns-trend.png">
                            </li>
                            <li>
                                DNS totalbytes by hostname: this graph show us the total amount of bytes
sent to a specific hostname, having a big spike on one foreign hostname
for a specific environment should raise suspitions and will need to be
investigated.
                                <img alt="DNS bytes by hostname" data-canonical-url="./imgs/tbytes-hostname.png" src="https://res.cloudinary.com/devpost/image/fetch/s--JB6QQeUm--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/v1/./imgs/tbytes-hostname.png">
                            </li>
                            <li>
                                Top DNS destinations: this graph presents the top ten destinations for
DNS traffic, this graph is useful once we start to drill down on a specific
time frame while researching a suspicious behaviour since it will show if
there are per example hosts speaking with unauthorized (by company rules)
DNS hosts.
                                <img alt="DNS top destinations" data-canonical-url="./imgs/top-destinations.png" src="https://res.cloudinary.com/devpost/image/fetch/s--il_6sMSl--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/v1/./imgs/top-destinations.png">
                            </li>
                            <li>
                                Top DNS sources: this top ten graph will have our internal hosts that generate
more DNS traffic, the participation of a specific host will be out of
proportion if DNS is used to exfiltrate or infiltrate any kind of file since
this require a lot of traffic to be generated due to the space constraints
and the need to encode the files.
                                <img alt="DNS top sources" data-canonical-url="./imgs/top-sources.png" src="https://res.cloudinary.com/devpost/image/fetch/s--njknDuto--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/v1/./imgs/top-sources.png">
                            </li>
                            <li>
                                DNS query table: this table contains the results for any traffic defined as DNS
this table has different fields that are relevant for the type of problem we are
trying to tackle.
                                <img alt="DNS query table" data-canonical-url="./imgs/query-table.png" src="https://res.cloudinary.com/devpost/image/fetch/s--h2VbqXEI--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/v1/./imgs/query-table.png">
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p>
                            searches.json: this is just a lucene query searching for any hits on DNS
application type, all our visualizations are built around this query.
                        </p>
                    </li>
                </ul>
                <p>
                    Also there are some pcap files to test the dashboard:
                </p>
                <ul>
                    <li>
                        evidence/dns-infil.pcap: this packet captures contains all the traffic generated
while we were infiltrating a custom PE32 executable via DNS queries.
                    </li>
                    <li>
                        evidence/dns-exfil.pcap: this is the traffic generated while we were exfiltrating
a small document in OpenDocument Text format (ODT) via DNS queries.
                    </li>
                </ul>
                <p>
                    All the files in the imgs folder are just illustrations for the different visualizations
in the dashboard:
                </p>
                <ul>
                    <li>
                        dns-trend.png
                    </li>
                    <li>
                        query-table.png
                    </li>
                    <li>
                        tbytes-hostname.png
                    </li>
                    <li>
                        top-destinations.png
                    </li>
                    <li>
                        top-sources.png
                    </li>
                </ul>
                <h1>
                    Dependencies
                </h1>
                <p>
                    There are no special requirements to setup this dashboard.
                </p>
                <h1>
                    Setup
                </h1>
                <p>
                    The following steps are required to import the dashboard and its components:
                </p>
                <ol>
                    <li>
                        First of all we will import a DPA rule to add the DNS host record response
this is the file
                        <em>
                            Flow_DetectDNSLength.lua
                        </em>
                        .
                    </li>
                    <li>
                        After having our DPA rule in place we will need to import our custom search,
you can do this by importing the
                        <em>
                            searches.json
                        </em>
                        file.
                    </li>
                    <li>
                        Import the visualizations file
                        <em>
                            visualizations.json
                        </em>
                        this file has the
definition for our different visualizations.
                    </li>
                    <li>
                        With all these components already working we can import the
                        <em>
                            dashboard.json
                        </em>
                        file, this will create our DNS Exfil/Infil dashboard.
                    </li>
                </ol>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/lua">
                                lua
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/jotamjr/netmon-db-dns-hunting" rel="nofollow" target="_blank" title="https://github.com/jotamjr/netmon-db-dns-hunting">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
