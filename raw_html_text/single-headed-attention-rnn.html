<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/teB2MB_L8U8?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="844765" data-title="The issues with the Transformer model" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/765/datas/original.jpg">
                            <img alt="Single Headed Attention RNN &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/765/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                The issues with the Transformer model
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="844767" data-title="Comparing Transformer with Single Headed Attention LSTM" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/767/datas/original.jpg">
                            <img alt="Single Headed Attention RNN &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/767/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Comparing Transformer with Single Headed Attention LSTM
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="844768" data-title="Advantages of the SHA-LSTM" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/768/datas/original.jpg">
                            <img alt="Single Headed Attention RNN &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/844/768/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Advantages of the SHA-LSTM
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    For this work I had two primary questions:
                </p>
                <ul>
                    <li>
                        "What aspects of the Transformer are likely adding the most benefit?"
                    </li>
                    <li>
                        "What are the simplest and fastest aspects of the Transformer architecture that could be grafted onto an LSTM to bring LSTM performance up to similar levels?"
                    </li>
                </ul>
                <p>
                    This was motivated first to better understand and analyze aspects of the Transformer architecture as well as to encourage exploration of a broader space of neural architectures.
                </p>
                <p>
                    The resulting model is also a likely better fit for production systems, many of which use model distillation to convert a Transformer model down to a traditional LSTM, and has unique benefits of both the LSTM and Transformer model without the overheads of both.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    In summary, "stop thinking with your (attention) head".
                </p>
                <ul>
                    <li>
                        Obtain strong results on a byte level language modeling dataset (enwik8) in under 24 hours on a single GPU (12GB Titan V)
                    </li>
                    <li>
                        Support long range dependencies (up to 5000 tokens) without increasing compute time or memory usage substantially by using a simpler attention mechanism
                    </li>
                    <li>
                        Avoid the fragile training process required by standard Transformer models such as a long warmup
                    </li>
                    <li>
                        Back off toward a standard LSTM allowing you to drop retained memory states (needed for a Transformer model) if memory becomes a major constraint
                    </li>
                    <li>
                        Provide a smaller model that features only standard components such as the LSTM, single headed attention, and feed-forward modules such that they can easily be productionized using existing optimized tools and exported to various formats (i.e. ONNX)
                    </li>
                </ul>
                <h2>
                    How I built it
                </h2>
                <p>
                    The process was relatively simple:
                </p>
                <ul>
                    <li>
                        Start with a strong but outdated LSTM baseline
                    </li>
                    <li>
                        Add in a single head of attention for each LSTM pass inspired more by computationally efficient approaches such as
                        <a href="https://arxiv.org/abs/1609.07843" rel="nofollow">
                            Merity et al's Pointer Sentinel Mixture Models
                        </a>
                        and
                        <a href="https://arxiv.org/abs/1612.04426" rel="nofollow">
                            Grave et al's Continuous Cache
                        </a>
                        (i.e. approaches that don't require matrix multiplications for each element in the history)
                    </li>
                    <li>
                        Continue fine tuning both the model and training process until it achieved strong
                    </li>
                </ul>
                <h2>
                    Challenges I ran into
                </h2>
                <ul>
                    <li>
                        Limited to a single GPU prevented traditional large scale hyperparameter search
                    </li>
                    <li>
                        The LSTM requires a fairly large hidden state to work well whilst Transformer models are able to have an incredibly large implicit hidden state through their multi-head attention mechanisms
                    </li>
                    <li>
                        Nvidia's
                        <a href="https://github.com/NVIDIA/apex" rel="nofollow">
                            Automatic Mixed Precision (AMP)
                        </a>
                        for PyTorch gives massive speed gains but can produce complex issues (such as having to rewrite weight dropout code to handle the wrapped weight handling that AMP provides RNNs)
                    </li>
                </ul>
                <h2>
                    Accomplishments that I'm proud of
                </h2>
                <table class="responsive">
                    <thead>
                        <tr>
                            <th>
                                Model
                            </th>
                            <th>
                                Test BPC
                            </th>
                            <th>
                                Params
                            </th>
                            <th>
                                LSTM Based
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                Krause mLSTM
                            </td>
                            <td>
                                1.24
                            </td>
                            <td>
                                46M
                            </td>
                            <td>
                                ✔
                            </td>
                        </tr>
                        <tr>
                            <td>
                                AWD-LSTM
                            </td>
                            <td>
                                1.23
                            </td>
                            <td>
                                44M
                            </td>
                            <td>
                                ✔
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong>
                                    SHA-LSTM
                                </strong>
                            </td>
                            <td>
                                1.07
                            </td>
                            <td>
                                63M
                            </td>
                            <td>
                                ✔
                            </td>
                        </tr>
                        <tr>
                            <td>
                                12L Transformer-XL
                            </td>
                            <td>
                                1.06
                            </td>
                            <td>
                                41M
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                18L Transformer-XL
                            </td>
                            <td>
                                1.03
                            </td>
                            <td>
                                88M
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Adaptive Span Transformer (Small)
                            </td>
                            <td>
                                1.02
                            </td>
                            <td>
                                38M
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <ul>
                    <li>
                        The previous best reported number for LSTM based architectures on enwik8 was
                        <a href="https://arxiv.org/pdf/1803.08240.pdf" rel="nofollow">
                            1.23
                        </a>
                        , whilst our best model reports 1.07, beating many Transformer based models in the past two years
                    </li>
                    <li>
                        The model was trained in only 24 hours on a single GPU with the Adaptive Span Transformer (small) being the only recent Transformer model to achieve the same type of training efficiency
                    </li>
                    <li>
                        Proof that even a single head of attention can provide competitive results when paired with a more powerful architecture, suggesting other approaches to neural architectures may exist that stray away from the standard multi-head attention seen in Transformers
                    </li>
                    <li>
                        All the results obtained, including all runs of the model, used a single GPU and no hyperparameter search or complex initialization schemes
                    </li>
                    <li>
                        A quite different architecture than the standard models being seen and used in language modeling
                    </li>
                </ul>
                <h2>
                    What I learned
                </h2>
                <ul>
                    <li>
                        Multi-head attention architectures such as the many Transformer variants are still strongest but there is an unexplored and potentially valuable research direction for many other neural architectures
                    </li>
                    <li>
                        The implicit hidden state size of Transformer models still handily beat out the LSTM's explicit hidden state, though even a single head of attention can rapidly equalize that difference
                    </li>
                    <li>
                        Custom CUDA is still more work than I had hoped for in recent versions and TorchScript provides strong building blocks but still has many edge cases
                    </li>
                </ul>
                <h2>
                    What's next for Single Headed Attention RNN
                </h2>
                <ul>
                    <li>
                        Continuing to improve the training process, efficiency, and accuracy - all of which were limited by my using a single GPU and &lt;24 hours for each run of this work
                    </li>
                    <li>
                        Add in multi-head attention to see whether the gains seen in Transformer models will be applicable and whether this can increase the implicit hidden state of the LSTM similar to how it does for Transformers
                    </li>
                    <li>
                        Improve the speed of the model through TorchScript and custom CUDA, neither of which are used currently
                    </li>
                </ul>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/pytorch">
                                pytorch
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/Smerity/sha-rnn" rel="nofollow" target="_blank" title="https://github.com/Smerity/sha-rnn">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
