<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/1zs-v6rvEco?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="838175" data-title="Water Level Anomaly Detector IoT Device" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/838/175/datas/original.JPG">
                            <img alt="Water Level Anomaly Detector &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/838/175/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Water Level Anomaly Detector IoT Device
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="837865" data-title="Setting up Soracom Beam to append Subscription Key as Header" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/837/865/datas/original.png">
                            <img alt="Water Level Anomaly Detector &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/837/865/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Setting up Soracom Beam to append Subscription Key as Header
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="837866" data-title="Setting up Endpoint URI in Soracom Beam" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/837/866/datas/original.png">
                            <img alt="Water Level Anomaly Detector &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/837/866/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Setting up Endpoint URI in Soracom Beam
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="837867" data-title="Grabbing Subscription Key and Endpoint URI from Azure Portal" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/837/867/datas/original.png">
                            <img alt="Water Level Anomaly Detector &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/837/867/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Grabbing Subscription Key and Endpoint URI from Azure Portal
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    For this Hackathon, I knew that I wanted to accomplish the following three goals.
                </p>
                <ol>
                    <li>
                        Gather data from our environment to make a positive ecological impact.
                    </li>
                    <li>
                        Leverage Azure Anomaly Detector API to identify outliers in the data.
                    </li>
                    <li>
                        Build an IoT device which uses an ultrasonic sensor to measure distance.
                    </li>
                </ol>
                <p>
                    Water level monitoring is a great fit for the Anomaly Detector API and ultrasonic sensor, as the sensor readings should be fairly consistent unless a serious event takes place. I began thinking about what would have the most beneficial environmental impact, and saw potential in monitoring remote lakes and rivers. This could be great for detecting flash floods or natural disasters. This system could also aggregate data daily, which would be beneficial for long-term analysis, such as measuring the effects of global warming.
                </p>
                <p>
                    Since this device will be deployed remotely, cellular connectivity is a must. Cellular dramatically expands the options of where this device can be used, as it will not require a WiFi or Ethernet connection.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    This project uses the Anomaly Detector API to identify drastic changes in water levels from an ultrasonic sensor which is plugged into a Raspberry Pi and communicating to the cloud over a cellular connection via Soracom.
                </p>
                <p>
                    Every minute, a timestamp and distance reading from the ultrasonic sensor is taken, and stored on the device. Once enough data points are stored (Anomaly Detector API currently has a minimum of 12) the data is sent to the Anomaly Detector API to analyze the latest value against the previous ones. When an uncommon event occurs, the Anomaly Detector API will return a message to the Pi letting it know that an anomaly has been detected. This message can then be used to trigger any type of action that you can think of. Currently, it will make the Pi illuminate a red LED.
                </p>
                <p>
                    For sending the sensor readings from the Raspberry Pi to the Azure Anomaly Detector API I used Soracom Beam. This service sits within the Soracom cellular network and allows you to send plain HTTP messages to it. Since cellular connectivity is encrypted at the SIM card level, we do not need to manage our API keys on the raspberry pi. From the Soracom User Console, I added my Azure Anomaly Detector API endpoint and API key to my Soracom Beam configuration. This allows Beam to take the plain HTTP message over cellular and then encrypt it into HTTPS and send over the public internet to Azure Anomaly Detector API.
                </p>
                <h2>
                    How I built it
                </h2>
                <h3>
                    Hardware
                </h3>
                <p>
                    I used a Raspberry Pi Zero, along with an ultrasonic sensor, LED, cellular modem usb dongle, and a Soracom SIM card for the hardware. All of these items are available in Soracom&rsquo;s IoT Starter Kit found here:
                    <a href="https://www.soracom.io/store/soracom-cellular-iot-starter-kit/" rel="nofollow">
                        https://www.soracom.io/store/soracom-cellular-iot-starter-kit/
                    </a>
                </p>
                <p>
                    I then used a Dremel, drill, soldering iron, and copious amounts of hot glue to incorporate all of this into a basic project box.
                </p>
                <h3>
                    Cloud
                </h3>
                <p>
                    <strong>
                        Azure
                    </strong>
                    Firstly, I headed over to Azure and set up the Anomaly Detector API. I followed along with the Rest API for Python
                    <a href="https://docs.microsoft.com/en-us/azure/cognitive-services/anomaly-detector/quickstarts/detect-data-anomalies-python" rel="nofollow">
                        Quickstart Guide
                    </a>
                    .
                </p>
                <p>
                    Please see my screenshot in the gallery for where to find your Subscription Key and Endpoint URI within the Quickstart tab under the Getting Started section.
                </p>
                <p>
                    <strong>
                        Soracom
                    </strong>
                    The next step was to go over to the Soracom User Console and configure Soracom Beam to convert the HTTP Posts from the Raspberry Pi into HTTPS Posts to my Anomaly Detector API endpoint.
                </p>
                <p>
                    Please check out the image gallery for what my configuration looked like when setting up an HTTPS endpoint, using the endpoint URI from my Quickstart settings from Azure.
                </p>
                <p>
                    I also have a screenshot showing how to configure Soracom Beam to append my Subscription Key as a header.
Software
                </p>
                <p>
                    Once that was complete, the last step was to set up the Python scripts that loop on the Pi every minute to collect the sensor data and then post via HTTP to beam.soracom.io. If an anomaly was detected, the script then turns on a red LED which I have plugged into GPIO port 18. The full code for this project can be found in this
                    <a href="https://github.com/RoyCodes/Water-Level-Detector" rel="nofollow">
                        GitHub Repository
                    </a>
                    .
                </p>
                <h2>
                    Challenges I ran into
                </h2>
                <p>
                    The hardest part of this project was deciding how best to store the readings from the ultrasonic sensor. I struggled with whether or not to use a small-footprint database, or keep recent readings in memory. I settled on writing the readings to a CSV file and then using Python&rsquo;s csv package&rsquo;s DictReader function to turn those readings into JSON so that it could be delivered.
                </p>
                <p>
                    Another challenge was coming up with an enclosure for the physical device. While it works perfectly on the breadboard, it is quite jiggly and the jumpers could easily fall out. However, I decided on keeping it like this due to time constraints and also because it&rsquo;s easier to explain since you can see every piece clearly.
Accomplishments that I'm proud of
                </p>
                <p>
                    This was my first time using Anomaly Detector API, and I was really impressed with how quickly I was able to create my own endpoint and start hacking. This allowed me to spend much more time on the creative side of the project rather than configuration.
                </p>
                <p>
                    Besides time saved on configuration, not having to worry about writing any custom logic to detect anomalies means that I can get familiar with this one API and then use it in any similar project without reinventing the wheel each time.
                </p>
                <p>
                    Also, getting the LED to blink for the first time after it detected a real anomaly (coffee levels running low in my coffee mug) was very rewarding. Note to self: maybe I should make a coffee level detector?
                </p>
                <h2>
                    What I learned
                </h2>
                <p>
                    The Azure Anomaly Detector API can be a great solution for IoT developer who offload complicated logic from their devices to the cloud. This API allows device manufacturers to limit the amount of heavy lifting that the device needs to do, which can increase battery life and decrease the overall cost of the unit. It also saves tons of time writing logic and algorithms to identify outliers in your sensor&rsquo;s data set. With the Anomaly Detector API, there is no need to reinvent the wheel and code your own solution.
                </p>
                <h2>
                    What's next for IoT Water Level Anomaly Detector
                </h2>
                <p>
                    The next feature that I&rsquo;d like to add to this project is some form of data visualization so that I can easily see at a glance what my device has been up to. One way to do this would be to use Soracom Harvest, which would allow me to view sensor data in various types of graphs directly from within my Soracom User Console.
                </p>
                <p>
                    Another next step is to do something more than just turning an LED red when an anomaly is detected. I&rsquo;d like to expand this out further and send an alert via text or email. Also was not joking about making a coffee level detector!
                </p>
                <p>
                    Finally, I&rsquo;d like to explore 3D printing and create a custom enclosure. One that supports different clips and attachments so that it can be deployed remotely without a technician having to make multiple trips back and forth from the site just to pick the best attachment.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            anomaly-detector-api
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/azure">
                                azure
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            cellular
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/raspberry-pi">
                                raspberry-pi
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            soracom
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/RoyCodes/Water-Level-Detector" rel="nofollow" target="_blank" title="https://github.com/RoyCodes/Water-Level-Detector">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
