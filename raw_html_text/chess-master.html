<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/h8hDfjef-ns?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="500796" data-title="High Level Architecture" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/500/796/datas/original.jpg">
                            <img alt="Chess Master &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/500/796/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                High Level Architecture
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="501221" data-title="Recommend a move" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/501/221/datas/original.PNG">
                            <img alt="Chess Master &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/501/221/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Recommend a move
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="501222" data-title="Screen shot of Alexa App" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/501/222/datas/original.PNG">
                            <img alt="Chess Master &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/501/222/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Screen shot of Alexa App
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    My wife and I purchased the Stratego board game for the kids last Christmas. After playing a few times, I noticed similarities to chess. Soon after, I started playing chess online. After a few weeks, I decided to look into Alexa-based chess games. I found a few, but felt like that they could be improved on, so I built my own.
                </p>
                <h2>
                    What it does
                </h2>
                <p>
                    Chess Master allows a user to play a game of chess in three modes:
                </p>
                <p>
                    <strong>
                        Mode 1: Play against the computer:
                    </strong>
                    <br>
                    In this mode, the user chooses to play against Alexa in easy, medium, or expert skill level. The user will indicate his preferred move, then Alexa will respond. Am image of the board will be sent to the Alexa App. If asked, Alexa will recommend plays and will undo a move.
                </p>
                <p>
                    <strong>
                        Mode 2: Play against someone in the house:
                    </strong>
                    <br>
                    This mode is meant for two players in the same location. This mode works best with a Fire TV (though this can be played with a Alexa device and tablet/phone combo as well). All functions (except undo) are available in this mode. The board "flips" from a black or white perspective based on who's turn it is.
                </p>
                <p>
                    <strong>
                        Mode 3: Play against a remote user:
                    </strong>
                    <br>
                    The remote option is for playing against someone in another location. Game play is similar to Mode 2, except that users require a mobile device for game play. This allows the user to be notified when his opponent plays.
                </p>
                <h2>
                    How I built it
                    <br>
                </h2>
                <p>
                    The chess master is built leveraging Amazon Web Services and a number of 3rd party APIs and programs. The following diagram highlights the high level architecture.
                </p>
                <p>
                    <img alt="alt text" data-canonical-url="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/500/796/datas/gallery.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--qRwbueWq--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/500/796/datas/gallery.jpg" title="High Level Architecture">
                </p>
                <p>
                    <strong>
                        Alexa Skill (AWS Lambda function written in nodeJS)
                    </strong>
                    <br>
                    Game play, move validation, etc is governed by
                    <a href="https://github.com/jhlywa/chess.js/blob/master/README.md" rel="nofollow">
                        Chess.js
                    </a>
                    . Alexa moves and best move recommendations come from
                    <a href="https://stockfishchess.org/" rel="nofollow">
                        Stockfish
                    </a>
                    . Session variables (including game status) saved in DynamoDB tables.
                </p>
                <p>
                    <strong>
                        Image Creation
                    </strong>
                    <br>
                    I have a small AWS LightSail webserver running to support image creation (in this case, the chess board). The image is created when the "Main" Lambda function calls the web server (via the AWS API Gateway). The image is retrieved, saved to AWS S3, and presented to the user in the Alexa app. The code based on the following
                    <a href="https://github.com/niklasf/web-boardimage" rel="nofollow">
                        WebImage project
                    </a>
                    .
                </p>
                <p>
                    <strong>
                        Communication to support remote user game play
                    </strong>
                    <br>
                    A second AWS Lambda function (exposed through Amazon API Gateway) is used to support received text messages (via
                    <a href="https://www.twilio.com/" rel="nofollow">
                        Twilio
                    </a>
                    ). Note - The main Alexa skill also sends messages via Twilio in order to notify an opponent that it is his turn to move.
                </p>
                <h2>
                    Challenges I ran into
                </h2>
                <p>
                    I've written a number of skills; this has been been, by far, the most complicated one I have built, for a number of reasons.
                </p>
                <p>
                    <strong>
                        Understanding a user's move - part 1
                    </strong>
                    <br>
                    Users make moves by saying "move piece to target location" (such as, move pawn to E4). Originally, I planned for the user to indicate the source and target moves (move from C1 to D2). The challenge was that Alexa interpreted "to" as 2... so the source coordinate became C "one two". I moved to the "piece and target coordinate" designation for moves; this required a more complex function to determine the move (the chess.JS library required moves to be indicated by source and target). I ultimately had to loop through the entire chessboard square by square to (a) see if the piece matches the requested move piece and (b) see if the move was a valid move. If a and b were, true, then the move was executed.
                </p>
                <p>
                    <strong>
                        Understanding a user's move - part 2
                    </strong>
                    <br>
                    The second problem with moves is that Alexa does not always hear letters correctly. B is sometimes "B", "Bee", "Bea", "Be". I did a lot of testing and wrote an array that translated the "heard" word to the correct user intention. To help, also recommend to users that they use the NATO phonetic alphabet (move pawn to
                    <em>
                        Echo
                    </em>
                    4).
                </p>
                <p>
                    <strong>
                        Running an executable in Lambda (Stockfish)
                    </strong>
                    <br>
                    I originally exposed the Stockfish recommendations as an API (on the same server that I use for Image creation), but I found that I would get timeouts based on the complexity of the move. Stockfish is also a CPU intense program and would impact the image creation functions. I decided to remove it from the image creation web server and run it as part of the main Lambda function.
                </p>
                <p>
                    Running an executable in Lambda isn't as straightforward as I thought it would be. Ultimately, I got it to work, but it took days instead of hours to get working.
                </p>
                <p>
                    <strong>
                        Special Moves
                    </strong>
                    <br>
                    There are 3 special moves that are supported during a game of chess. Two of these (en passant and castling) were straightforward to handle. Pawn promotion was more difficult, as I had to determine the location of a pawn to determine if it was eligible for promotion. During traditional game play, a user has the ability to promote a pawn to Queen, Knight, Rook, or Bishop. Based on my research, a pawn is promoted to Queen 99% of the time, so I decided to automatically promote eligible pawns to queen (versus prompting the user for a choice).
                </p>
                <h2>
                    Accomplishments that I'm proud of
                </h2>
                <p>
                    I'm happy that I could build a skill that supports game play between two users with two different Alexa profiles (with the help of Twilio). I'm also proud that I was able to use the skill with my family as part of our game night.
                </p>
                <h2>
                    What I learned
                </h2>
                <p>
                    So much. First off, I starting playing chess again. I learned how to better use the functions in the Alexa SDK. I also learned how to add executables to Lambda functions.
                </p>
                <h2>
                    What's next for Chess Master
                </h2>
                <p>
                    There are a few ideas that I'd like to incorporate in the next release:
1) I'd like to build a smart chessboard that can be used to enhance game play.
2) I'd like to give users the option to choose the pawn promotion.
3) I'd like to add a game play timer.
4) I'd like to give users the ability to play more than one game at a time.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            alexa-skills-kit
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/node-js">
                                node.js
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            stockfish
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/twilio">
                                twilio
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://www.amazon.com/Darian-Johnson-Chess-Master/dp/B06Y22NLXL/" rel="nofollow" target="_blank" title="https://www.amazon.com/Darian-Johnson-Chess-Master/dp/B06Y22NLXL/">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                www.amazon.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
