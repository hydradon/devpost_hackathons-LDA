<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li class="text-center">
                        <a data-lightbox="690918" data-title="Gas consumpion report on single function" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/690/918/datas/original.PNG">
                            <img alt="solidity-profiler &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/690/918/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Gas consumpion report on single function
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="690901" data-title="profiler report" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/690/901/datas/original.PNG">
                            <img alt="solidity-profiler &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/690/901/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                profiler report
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="691030" data-title="code coverage" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/030/datas/original.png">
                            <img alt="solidity-profiler &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/691/030/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                code coverage
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="690875" data-title="profiler console output" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/690/875/datas/original.PNG">
                            <img alt="solidity-profiler &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/690/875/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                profiler console output
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Solidity Profiler
                </h2>
                <p>
                    Sometimes it could be excruciating to find out most
                    <code>
                        hungry
                    </code>
                    lines of solidity code.
It could happen because of wrong loop condition or overflow, and unclear.
We've thought that Solidity profiler is missing part for the Ethereum development eco-system and decided to implement working prototype during hackathon using wide known tools.
                </p>
                <h2>
                    Implementation
                </h2>
                <p>
                    We've
                    <a href="https://github.com/k06a/solidity-profiler" rel="nofollow">
                        forked solidity coverage
                    </a>
                    . And after did following fixes:
                </p>
                <ul>
                    <li>
                        Bulk renaming to save compatibility with the original project.
                    </li>
                    <li>
                        Extend code coverage event with
                        <code>
                            gasleft()
                        </code>
                        value
                    </li>
                    <li>
                        Patch event procession and report generation step, to nicely render it with
                        <code>
                            Istanbul
                        </code>
                        code coverage utils that is a part of solidity coverage
                    </li>
                </ul>
                <h2>
                    Demo project
                </h2>
                <p>
                    To demonstrate how profiler works we take our fork of
                    <a href="https://github.com/1Address/ecsol/tree/feature/solidity-profiler" rel="nofollow">
                        ecsol
                    </a>
                    project.
On that fork we apply has gas optimization that was
                    <a href="https://ethresear.ch/t/you-can-kinda-abuse-ecrecover-to-do-ecmul-in-secp256k1-today/2384" rel="nofollow">
                        purposed by Vitalik
                    </a>
                    .
So, we were really curious to know the details of our gas optimization.
                </p>
                <p>
                    To get solidity profiler output on sample project do the following:
                </p>
                <p>
                    First, you need the following global dependencies installed:
                </p>
                <pre class="language-nolang"><code>npm install -g truffle
npm install -g ganache-cli
</code></pre>
                <p>
                    After clone repositories and perform
                    <code>
                        npm i
                    </code>
                    and
                    <code>
                        npm run profiler
                    </code>
                </p>
                <pre class="language-nolang"><code>mkdir solidity-profiler-demo
cd solidity-profiler-demo

git clone https://github.com/k06a/solidity-profiler
cd solidity-profiler
npm i
cd ../

git clone -b feature/solidity-profiler https://github.com/1Address/ecsol
cd ecsol
npm i

npm run profiler
</code></pre>
                <p>
                    Discover report file in
                    <code>
                        ecsol/coverage/index.html
                    </code>
                    directory
                </p>
                <h2>
                    Challenges we run into
                </h2>
                <p>
                    We've made a couple of mistakes in our implementation:
                </p>
                <ul>
                    <li>
                        We've calculated gas consumption by nested calls in the wrong way.
                    </li>
                    <li>
                        We don't calculate correctly gas consumption by event emission
                    </li>
                    <li>
                        We have a lot of things to improve in visualization in the report
                    </li>
                </ul>
                <p>
                    At first, we've decided to extend
                    <code>
                        Istanbul
                    </code>
                    output to add Gas consumption by a line near the line entrance amount.
                </p>
                <h2>
                    Further Plas
                </h2>
                <p>
                    Our hackathon solution is just a proof of concept and we think that can improve it in the following way:
                </p>
                <ul>
                    <li>
                        Display min/max/avg/median gas consumption for each line
                    </li>
                    <li>
                        Split complex lines to multiple lines with indentation
                    </li>
                    <li>
                        Make a lot of other improvements and fixes on a long way to the production use ;-)
                    </li>
                </ul>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/javascript">
                                javascript
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/npm">
                                npm
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/solidity">
                                solidity
                            </a>
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="https://github.com/k06a/solidity-profiler" rel="nofollow" target="_blank" title="https://github.com/k06a/solidity-profiler">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
