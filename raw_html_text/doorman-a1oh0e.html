<html>
    <head>
    </head>
    <body>
        <div class="large-9 columns" id="app-details-left">
            <div id="gallery">
                <ul>
                    <li>
                        <div class="flex-video">
                            <iframe allowfullscreen="allowfullscreen" allowscriptaccess="always" class="video-embed" frameborder="0" height="371" mode="transparent" src="https://www.youtube.com/embed/UXVD22jDbu8?enablejsapi=1&amp;hl=en_US&amp;rel=0&amp;start=&amp;version=3&amp;wmode=transparent" type="text/html" webkitallowfullscreen="true" width="660" wmode="transparent">
                            </iframe>
                        </div>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="602543" data-title="Doorman" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/543/datas/original.png">
                            <img alt="Doorman &ndash; screenshot 1" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/543/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Doorman
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="602534" data-title="Architecture" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/534/datas/original.png">
                            <img alt="Doorman &ndash; screenshot 2" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/534/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Architecture
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="602536" data-title="Detecting people and posting to slack" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/536/datas/original.png">
                            <img alt="Doorman &ndash; screenshot 3" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/536/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Detecting people and posting to slack
                            </i>
                        </p>
                    </li>
                    <li class="text-center">
                        <a data-lightbox="602539" data-title="Training faces through Slack" href="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/539/datas/original.png">
                            <img alt="Doorman &ndash; screenshot 4" class="software_photo_image image-replacement" onerror="this.onerror=null;this.src='https://devpost-challengepost.netdna-ssl.com/assets/defaults/thumbnail-placeholder-42bcab8d8178b413922ae2877d8b0868.gif';" src="//challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/539/datas/gallery.jpg">
                        </a>
                        <span class="expand-tag">
                            <i class="fas fa-expand">
                            </i>
                        </span>
                        <p>
                            <i>
                                Training faces through Slack
                            </i>
                        </p>
                    </li>
                </ul>
            </div>
            <div>
                <h2>
                    Inspiration
                </h2>
                <p>
                    Within our company we have a lot of people working remotely, and in the offices (multiple locations). Sometimes it's very hard to find out if someone is active / available or not, or where they are physically. Sometimes people forget to put their status to active as well. We also deal with multiple regions and timezones.
                </p>
                <p>
                    We also use the Slack personal status message to state where you are (working from home, in the office, and if so, which location).
                </p>
                <p>
                    In comes the Deeplens. Wouldn't it be awesome that whenever you come into the office, you get recognized and marked as 'active' in slack, and your status is set to whichever office you are in?
                </p>
                <h2>
                    What it does
                </h2>
                <ul>
                    <li>
                        It detects whenever a person comes into one of the offices
                    </li>
                    <li>
                        It tries to detect the person
                    </li>
                    <li>
                        If it identifies the person, it will say a welcome message on slack "Welcome @svdgraaf!"
                    </li>
                    <li>
                        If it doesn't identify the person, it will ask on slack "Who is this?" And you can select which user it is.
                    </li>
                    <li>
                        If you don't want this person to be recognized (eg: clients or non-slack users), you can select 'ignore', and it will remove the image from S3.
                    </li>
                    <li>
                        It then stores this information in the Rekognition api
                    </li>
                    <li>
                        Next time it identifies the person as such and notes it on the slack channel
                    </li>
                </ul>
                <h2>
                    What it doesn't do yet
                </h2>
                <ul>
                    <li>
                        Mark person as active on Slack
                    </li>
                    <li>
                        Set the person status on Slack
                    </li>
                    <li>
                        Speak out loud with Polly, haven't gotten it to work on the device yet
                    </li>
                </ul>
                <h2>
                    How I built it
                </h2>
                <ul>
                    <li>
                        I built this using the Serverless, which makes deploying the lambda functions really easy
                    </li>
                    <li>
                        I tried to build my own model, but failed (and I was concerned about costs for the training of the ec2 instances).. In the end, I used the 'deeplens-object-detection' model, no custom model, and check for 'person' objects.
                    </li>
                </ul>
                <h2>
                    How it works
                </h2>
                <p>
                    The deeplens detects objects coming by. If it detects a person, it takes a snapshot of that part, and uploads it to S3. This triggers a 'guess' function, which tries to detect the person. If it's a known perso, it calls the Slack api. If it's an unknown person, it also calls Slack. Within the channel, people can train the unknown person to a specific user, and it will call the Api Gateway to train the image.
                </p>
                <h2>
                    Architecture
                </h2>
                <p>
                    <img alt="Architecture" data-canonical-url="https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/534/datas/gallery.jpg" src="https://res.cloudinary.com/devpost/image/fetch/s--Ekj-vUDf--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://challengepost-s3-challengepost.netdna-ssl.com/photos/production/software_photos/000/602/534/datas/gallery.jpg">
                </p>
                <h2>
                    Challenges I ran into
                </h2>
                <ul>
                    <li>
                        <strong>
                            Greengrass
                        </strong>
                        A couple of times I had greengrass fail on me, so it was not deploying or running my lambda function
                    </li>
                    <li>
                        <strong>
                            Deeplens
                        </strong>
                        My deeplens was working at one point, and it didn't the next day. The ubuntu auto update feature is neat, until it breaks :) Also: it took me a while to figure out you can run multiple lambda functions at the same time on the Deeplens. Mind blown!
                    </li>
                    <li>
                        <strong>
                            Logging
                        </strong>
                        : It's really hard to debug your lambda functions on the device when they don't work. I ended up finding a way to push the logs into cloudwatch, which is neat, but it was not very well documented.
                    </li>
                    <li>
                        <strong>
                            Privacy issues
                        </strong>
                        (setup timing and control). A coworker asked if he/she could be excluded from the test. I understand the implications. Fortunately, this was just a POC and for fun, but it did spark a good conversation and discussion about Privacy concerns with these kinds of technologies. We ended up setting a timer so that the detection is only done between 08.00 and 10.00
                    </li>
                    <li>
                        <strong>
                            Slack API
                        </strong>
                        (timeout is very short). I learned the hard way that you have to reply in the Slack api within a couple milliseconds, or it does not work. I ended up calling another call asynchronously to get everything working correctly.
                    </li>
                    <li>
                        <strong>
                            Polly
                        </strong>
                        I have the generating of mp3's ready, I can play these locally just fine. I haven't figured out yet how to play these on the Deeplens itself.
                    </li>
                </ul>
                <h2>
                    Accomplishments that I'm proud of
                </h2>
                <p>
                    It works! It's really cool to see all the lambda functions trigger each other and do their thing, without running any servers. Really awesome stuff!
                </p>
                <h2>
                    What I learned
                </h2>
                <ul>
                    <li>
                        Greengrass
                    </li>
                    <li>
                        Slack API
                    </li>
                    <li>
                        OpenCV
                    </li>
                    <li>
                        Polly
                    </li>
                </ul>
                <h2>
                    What's next for Doorman
                </h2>
                <p>
                    <strong>
                        Make S3 upload async
                    </strong>
                    Currently the S3 upload is blocking, which on itself is fine, as it won't upload a gazillion images of the same person. But it does lock up the stream momentarily. I envision just writing the files to a local (tmp) folder somewhere, and have another lambda function upload those, or even better: detect faces on the device directly.
                </p>
                <p>
                    <strong>
                        Don't trigger multiple times
                    </strong>
                    Whenever a person walks by the camera slowly, or walks back within a minute, you'll get multiple postings to Slack. I want to add a feature where it's storing the last datetime a person was detected in Dynamo, and whenever we see that person again within X time, don't post to slack.
                </p>
                <p>
                    <strong>
                        Do face detection on device
                    </strong>
                    Would be really nice if I have the time to make this work directly on the device.
                </p>
                <p>
                    <strong>
                        Make Slack app public
                    </strong>
                    Currently you need to setup your own "dev" slack app to get the integration to work. It would be nice if I can publish my app, and I can just point to the right App.
                </p>
                <p>
                    <strong>
                        Add Amazon Polly
                    </strong>
                    I have been working on the Polly api, I have the generating of the mp3's working, but I currently haven't found a way to play the mp3 on the deeplens. I have some speakers available ;)
                </p>
                <p>
                    <strong>
                        Mark a person as 'active'
                    </strong>
                    Currently, it's not allowed to mark a person as active through the slack api without getting explicit permission from the user itself. Seeing as I didn't want to intrude my fellow co-workers, this hasn't been added yet.
                </p>
                <p>
                    <strong>
                        Mark a persons status
                    </strong>
                    Same as above, the endusers need to approve of this individually. It would be nice if we could mark the current office location in their status.
                </p>
            </div>
            <div class="" id="built-with">
                <h2>
                    Built With
                </h2>
                <ul class="no-bullet inline-list">
                    <li>
                        <span class="cp-tag">
                            deeplens
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            polly
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/python">
                                python
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag recognized-tag">
                            <a href="https://devpost.com/software/built-with/rekognition">
                                rekognition
                            </a>
                        </span>
                    </li>
                    <li>
                        <span class="cp-tag">
                            serverless
                        </span>
                    </li>
                </ul>
            </div>
            <nav class="app-links section">
                <h2>
                    Try it out
                </h2>
                <ul class="no-bullet" data-role="software-urls">
                    <li>
                        <a href="http://github.com/svdgraaf/doorman" rel="nofollow" target="_blank" title="http://github.com/svdgraaf/doorman">
                            <i class="ss-icon ss-link">
                            </i>
                            <span>
                                github.com
                            </span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </body>
</html>
