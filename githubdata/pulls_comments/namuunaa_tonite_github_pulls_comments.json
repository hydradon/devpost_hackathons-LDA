[
    {
        "url": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114435378",
        "pull_request_review_id": 35901686,
        "id": 114435378,
        "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDQzNTM3OA==",
        "diff_hunk": "@@ -31,16 +31,16 @@ def call(call_parameters={})\n     response[\"events\"][\"event\"]\n   end\n \n-  #limit the selection to events that have not yet started or are all-day events\n+  #limit the selection to events that have not yet started (OR all-day events if the current time is late in the day)\n   def select_not_started(call_list)\n-    call_list = call_list.select do |event|\n-      event[\"all_day\"] && event[\"start_time\"]\n-    end\n+    # call_list = call_list.select do |event|\n+    #   event[\"all_day\"] && event[\"start_time\"]\n+    # end\n     call_list = call_list.select do |event|\n       Time.zone = event['olson_path']\n-      event[\"all_day\"] != \"0\" || Time.zone.parse(event[\"start_time\"]).future?\n+      event[\"all_day\"] != \"0\" && Time.now.strftime('%R') >= \"18:00\" || Time.zone.parse(event[\"start_time\"]).future?",
        "path": "app/helpers/alexa_interface_helper.rb",
        "position": null,
        "original_position": 16,
        "commit_id": "1f2d41c7880921f742ce6f58aed3d949764b8bf2",
        "original_commit_id": "92f098249fc117dfc4373f0408ec16af634d7764",
        "user": {
            "login": "namuunaa",
            "id": 11289202,
            "node_id": "MDQ6VXNlcjExMjg5MjAy",
            "avatar_url": "https://avatars0.githubusercontent.com/u/11289202?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/namuunaa",
            "html_url": "https://github.com/namuunaa",
            "followers_url": "https://api.github.com/users/namuunaa/followers",
            "following_url": "https://api.github.com/users/namuunaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/namuunaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/namuunaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/namuunaa/subscriptions",
            "organizations_url": "https://api.github.com/users/namuunaa/orgs",
            "repos_url": "https://api.github.com/users/namuunaa/repos",
            "events_url": "https://api.github.com/users/namuunaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/namuunaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "body": "switch to <= 18:00",
        "created_at": "2017-05-02T21:57:41Z",
        "updated_at": "2017-05-02T22:44:13Z",
        "html_url": "https://github.com/namuunaa/tonite/pull/28#discussion_r114435378",
        "pull_request_url": "https://api.github.com/repos/namuunaa/tonite/pulls/28",
        "author_association": "OWNER",
        "_links": {
            "self": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114435378"
            },
            "html": {
                "href": "https://github.com/namuunaa/tonite/pull/28#discussion_r114435378"
            },
            "pull_request": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/28"
            }
        }
    },
    {
        "url": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114437114",
        "pull_request_review_id": 35903519,
        "id": 114437114,
        "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDQzNzExNA==",
        "diff_hunk": "@@ -21,19 +21,49 @@\n   end\n \n   describe '#select_not_started' do\n-    let(:response) do\n+    let(:api_response) do\n       select_not_started(helper.call)\n     end\n \n+    let(:all_day_test_response) do\n+      events = [{'title' => 'All Day 0 Event', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"1\"},\n+      {'title' => 'All Day 1 Event', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"0\"},\n+      {'title' => 'Hamilton', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"1\"},\n+      {'title' => 'All Day 2 Event', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"2\"}]\n+\n+      select_not_started(events)\n+    end\n+\n+\n     it 'only selects events whose start time is after the current time' do\n-      response.each do |event|\n+      api_response.each do |event|\n         event_start = Time.parse(event[\"start_time\"])\n-        event_not_started = (event_start > Time.now || event['all_day'] != 0 )\n+        event_not_started = (event_start > Time.now || event['all_day'] != \"0\" )\n         expect(event_not_started).to be true\n       end\n     end\n \n+    it 'selects all-day events if the current time is after 6 pm' do",
        "path": "spec/helpers/alexa_interface_helper_spec.rb",
        "position": null,
        "original_position": 29,
        "commit_id": "1f2d41c7880921f742ce6f58aed3d949764b8bf2",
        "original_commit_id": "92f098249fc117dfc4373f0408ec16af634d7764",
        "user": {
            "login": "namuunaa",
            "id": 11289202,
            "node_id": "MDQ6VXNlcjExMjg5MjAy",
            "avatar_url": "https://avatars0.githubusercontent.com/u/11289202?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/namuunaa",
            "html_url": "https://github.com/namuunaa",
            "followers_url": "https://api.github.com/users/namuunaa/followers",
            "following_url": "https://api.github.com/users/namuunaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/namuunaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/namuunaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/namuunaa/subscriptions",
            "organizations_url": "https://api.github.com/users/namuunaa/orgs",
            "repos_url": "https://api.github.com/users/namuunaa/repos",
            "events_url": "https://api.github.com/users/namuunaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/namuunaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "body": "switch to before 6pm",
        "created_at": "2017-05-02T22:07:33Z",
        "updated_at": "2017-05-02T22:44:13Z",
        "html_url": "https://github.com/namuunaa/tonite/pull/28#discussion_r114437114",
        "pull_request_url": "https://api.github.com/repos/namuunaa/tonite/pulls/28",
        "author_association": "OWNER",
        "_links": {
            "self": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114437114"
            },
            "html": {
                "href": "https://github.com/namuunaa/tonite/pull/28#discussion_r114437114"
            },
            "pull_request": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/28"
            }
        }
    },
    {
        "url": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114437300",
        "pull_request_review_id": 35903715,
        "id": 114437300,
        "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDQzNzMwMA==",
        "diff_hunk": "@@ -21,19 +21,49 @@\n   end\n \n   describe '#select_not_started' do\n-    let(:response) do\n+    let(:api_response) do\n       select_not_started(helper.call)\n     end\n \n+    let(:all_day_test_response) do\n+      events = [{'title' => 'All Day 0 Event', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"1\"},\n+      {'title' => 'All Day 1 Event', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"0\"},\n+      {'title' => 'Hamilton', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"1\"},\n+      {'title' => 'All Day 2 Event', 'venue_name' => 'DBC', 'start_time' => '2017-04-29 18:00', 'olson_path' => 'America/Los_Angeles', 'all_day' => \"2\"}]\n+\n+      select_not_started(events)\n+    end\n+\n+\n     it 'only selects events whose start time is after the current time' do\n-      response.each do |event|\n+      api_response.each do |event|\n         event_start = Time.parse(event[\"start_time\"])\n-        event_not_started = (event_start > Time.now || event['all_day'] != 0 )\n+        event_not_started = (event_start > Time.now || event['all_day'] != \"0\" )\n         expect(event_not_started).to be true\n       end\n     end\n \n+    it 'selects all-day events if the current time is after 6 pm' do\n+      current_time = Time.parse(Time.now.strftime('%F') + \" 17:59:00\")\n+\n+      allow(Time).to receive(:now).and_return(current_time)\n+\n+      all_day_test_response.each do |event|\n+\n+        expect(all_day_test_response.length).to be 3\n+      end\n+    end\n \n+    it 'does not select all-day events if the current time is 6pm or later' do",
        "path": "spec/helpers/alexa_interface_helper_spec.rb",
        "position": null,
        "original_position": 40,
        "commit_id": "1f2d41c7880921f742ce6f58aed3d949764b8bf2",
        "original_commit_id": "92f098249fc117dfc4373f0408ec16af634d7764",
        "user": {
            "login": "namuunaa",
            "id": 11289202,
            "node_id": "MDQ6VXNlcjExMjg5MjAy",
            "avatar_url": "https://avatars0.githubusercontent.com/u/11289202?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/namuunaa",
            "html_url": "https://github.com/namuunaa",
            "followers_url": "https://api.github.com/users/namuunaa/followers",
            "following_url": "https://api.github.com/users/namuunaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/namuunaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/namuunaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/namuunaa/subscriptions",
            "organizations_url": "https://api.github.com/users/namuunaa/orgs",
            "repos_url": "https://api.github.com/users/namuunaa/repos",
            "events_url": "https://api.github.com/users/namuunaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/namuunaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "body": "switch to before 6pm",
        "created_at": "2017-05-02T22:08:41Z",
        "updated_at": "2017-05-02T22:44:13Z",
        "html_url": "https://github.com/namuunaa/tonite/pull/28#discussion_r114437300",
        "pull_request_url": "https://api.github.com/repos/namuunaa/tonite/pulls/28",
        "author_association": "OWNER",
        "_links": {
            "self": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114437300"
            },
            "html": {
                "href": "https://github.com/namuunaa/tonite/pull/28#discussion_r114437300"
            },
            "pull_request": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/28"
            }
        }
    },
    {
        "url": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114437798",
        "pull_request_review_id": 35904271,
        "id": 114437798,
        "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDQzNzc5OA==",
        "diff_hunk": "@@ -31,16 +31,16 @@ def call(call_parameters={})\n     response[\"events\"][\"event\"]\n   end\n \n-  #limit the selection to events that have not yet started or are all-day events\n+  #limit the selection to events that have not yet started (OR all-day events if the current time is late in the day)",
        "path": "app/helpers/alexa_interface_helper.rb",
        "position": 5,
        "original_position": 5,
        "commit_id": "1f2d41c7880921f742ce6f58aed3d949764b8bf2",
        "original_commit_id": "92f098249fc117dfc4373f0408ec16af634d7764",
        "user": {
            "login": "namuunaa",
            "id": 11289202,
            "node_id": "MDQ6VXNlcjExMjg5MjAy",
            "avatar_url": "https://avatars0.githubusercontent.com/u/11289202?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/namuunaa",
            "html_url": "https://github.com/namuunaa",
            "followers_url": "https://api.github.com/users/namuunaa/followers",
            "following_url": "https://api.github.com/users/namuunaa/following{/other_user}",
            "gists_url": "https://api.github.com/users/namuunaa/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/namuunaa/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/namuunaa/subscriptions",
            "organizations_url": "https://api.github.com/users/namuunaa/orgs",
            "repos_url": "https://api.github.com/users/namuunaa/repos",
            "events_url": "https://api.github.com/users/namuunaa/events{/privacy}",
            "received_events_url": "https://api.github.com/users/namuunaa/received_events",
            "type": "User",
            "site_admin": false
        },
        "body": "in this comment, the all day events should be early in the day, right?",
        "created_at": "2017-05-02T22:12:05Z",
        "updated_at": "2017-05-02T22:44:13Z",
        "html_url": "https://github.com/namuunaa/tonite/pull/28#discussion_r114437798",
        "pull_request_url": "https://api.github.com/repos/namuunaa/tonite/pulls/28",
        "author_association": "OWNER",
        "_links": {
            "self": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114437798"
            },
            "html": {
                "href": "https://github.com/namuunaa/tonite/pull/28#discussion_r114437798"
            },
            "pull_request": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/28"
            }
        }
    },
    {
        "url": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114590662",
        "pull_request_review_id": 36070295,
        "id": 114590662,
        "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDU5MDY2Mg==",
        "diff_hunk": "@@ -16,6 +16,52 @@ def create_response(call_parameters)\n     response_for_alexa.build_response\n   end\n \n+  # this method and the one above could probably be re factored to be more similar or even joined into one method maybe? (search time is a concern...)\n+  def category_search_response\n+    given_category = params[\"request\"][\"intent\"][\"slots\"][\"category\"][\"value\"]\n+    category = @lookup_hash[given_category] # I think this is right?\n+    if category\n+      response_for_alexa = AlexaRubykit::Response.new\n+      response = category_call({location: get_location[:location], category: category})\n+      not_started = select_not_started(response)\n+      top_ten = pick10(not_started)\n+      top_one = pick1(top_ten)\n+      format_category_speech_for_alexa(response_for_alexa, top_one, given_category)\n+      format_text_for_alexa(response_for_alexa, top_ten)\n+      response_for_alexa.build_response\n+    else\n+      generate_bad_category_response(given_category)\n+    end\n+  end\n+\n+  def category_call(call_parameters = {})\n+    # page size is 10 for testing; should be ~500 for production\n+    if Rails.env.production?\n+      page_size = \"50\"\n+    else\n+      page_size = \"10\"\n+    end\n+\n+    parameters_hash = {category: call_parameters[:category], location: call_parameters[:location], date: \"Today\", sort_order: \"popularity\", mature: \"normal\", page_size: page_size, change_multi_day_start: \"true\" }\n+    client = EventfulApi::Client.new({})\n+    response = client.get('/events/search', parameters_hash)\n+    # hash > \"events\" > \"event\" > array of events\n+    response[\"events\"][\"event\"]\n+  end\n+\n+  def generate_bad_category_response(category)\n+    response_for_alexa = AlexaRubykit::Response.new\n+    response_for_alexa.add_speech(\"Sorry, #{category} is not a valid category\")",
        "path": "app/helpers/alexa_interface_helper.rb",
        "position": 39,
        "original_position": 39,
        "commit_id": "60e31c53fbb1b8f6e98de882ed6200eccb947853",
        "original_commit_id": "60e31c53fbb1b8f6e98de882ed6200eccb947853",
        "user": {
            "login": "rasnom",
            "id": 10056893,
            "node_id": "MDQ6VXNlcjEwMDU2ODkz",
            "avatar_url": "https://avatars0.githubusercontent.com/u/10056893?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rasnom",
            "html_url": "https://github.com/rasnom",
            "followers_url": "https://api.github.com/users/rasnom/followers",
            "following_url": "https://api.github.com/users/rasnom/following{/other_user}",
            "gists_url": "https://api.github.com/users/rasnom/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/rasnom/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/rasnom/subscriptions",
            "organizations_url": "https://api.github.com/users/rasnom/orgs",
            "repos_url": "https://api.github.com/users/rasnom/repos",
            "events_url": "https://api.github.com/users/rasnom/events{/privacy}",
            "received_events_url": "https://api.github.com/users/rasnom/received_events",
            "type": "User",
            "site_admin": false
        },
        "body": "direct them to help: categories list too, adding as a small trello card (does not have to block merge)",
        "created_at": "2017-05-03T16:26:20Z",
        "updated_at": "2017-05-03T16:33:23Z",
        "html_url": "https://github.com/namuunaa/tonite/pull/36#discussion_r114590662",
        "pull_request_url": "https://api.github.com/repos/namuunaa/tonite/pulls/36",
        "author_association": "COLLABORATOR",
        "_links": {
            "self": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/comments/114590662"
            },
            "html": {
                "href": "https://github.com/namuunaa/tonite/pull/36#discussion_r114590662"
            },
            "pull_request": {
                "href": "https://api.github.com/repos/namuunaa/tonite/pulls/36"
            }
        }
    }
]